import{g as oa,c as Di,a as re,e as kr,b as Zv,w as Rl,r as $l,f as vc,t as ca,d as Xv,h as e1,I as gi,A as t1,U as r1,N as Z,R as i1,i as ec,j as n1,_ as s1,P as a1,V as Th,k as o1,D as c1,C as u1,Z as Rh,$ as h1,p as l1,l as ia,q as f1,E as _c,m as Nl,o as $r,y as p1,n as d1,X as sn,s as Ft,u as er,v as di,x as or,z as g1,B as an,F as Fl,G as y1,H as v1,J as _1,K as Dl,L as m1,M as jl,Y as Ll,O as cn,Q as tc,S as ea,T as un,W as w1,a0 as ta,a1 as b1,a2 as E1,a3 as x1,a4 as I1,a5 as S1,a6 as qo,a7 as $h,a8 as P1,a9 as O1,aa as C1,ab as Nh,ac as A1,ad as T1,ae as R1,af as $1,ag as N1,ah as F1,ai as D1,aj as ra,ak as ql,al as Mo,am as j1,an as L1}from"./index-a2db3dd5.js";import{s as mc,i as Fh,c as q1,a as M1,b as Ml,f as wc,p as z1,J as vi,d as bc,e as Ec,g as xc,h as pi,j as ti,k as Ic,l as zl,H as ji}from"./http-622c5ed8.js";var ua={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var rc=function(o,i){return rc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)n.hasOwnProperty(a)&&(t[a]=n[a])},rc(o,i)};function U1(o,i){rc(o,i);function t(){this.constructor=o}o.prototype=i===null?Object.create(i):(t.prototype=i.prototype,new t)}var ic=function(){return ic=Object.assign||function(i){for(var t,n=1,a=arguments.length;n<a;n++){t=arguments[n];for(var u in t)Object.prototype.hasOwnProperty.call(t,u)&&(i[u]=t[u])}return i},ic.apply(this,arguments)};function k1(o,i){var t={};for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&i.indexOf(n)<0&&(t[n]=o[n]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(o);a<n.length;a++)i.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(o,n[a])&&(t[n[a]]=o[n[a]]);return t}function H1(o,i,t,n){var a=arguments.length,u=a<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(o,i,t,n);else for(var g=o.length-1;g>=0;g--)(f=o[g])&&(u=(a<3?f(u):a>3?f(i,t,u):f(i,t))||u);return a>3&&u&&Object.defineProperty(i,t,u),u}function K1(o,i){return function(t,n){i(t,n,o)}}function V1(o,i){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,i)}function B1(o,i,t,n){function a(u){return u instanceof t?u:new t(function(f){f(u)})}return new(t||(t=Promise))(function(u,f){function g(P){try{v(n.next(P))}catch(H){f(H)}}function m(P){try{v(n.throw(P))}catch(H){f(H)}}function v(P){P.done?u(P.value):a(P.value).then(g,m)}v((n=n.apply(o,i||[])).next())})}function G1(o,i){var t={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},n,a,u,f;return f={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function g(v){return function(P){return m([v,P])}}function m(v){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(u=v[0]&2?a.return:v[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,v[1])).done)return u;switch(a=0,u&&(v=[v[0]&2,u.value]),v[0]){case 0:case 1:u=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,a=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(u=t.trys,!(u=u.length>0&&u[u.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!u||v[1]>u[0]&&v[1]<u[3])){t.label=v[1];break}if(v[0]===6&&t.label<u[1]){t.label=u[1],u=v;break}if(u&&t.label<u[2]){t.label=u[2],t.ops.push(v);break}u[2]&&t.ops.pop(),t.trys.pop();continue}v=i.call(o,t)}catch(P){v=[6,P],a=0}finally{n=u=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}function W1(o,i,t,n){n===void 0&&(n=t),o[n]=i[t]}function J1(o,i){for(var t in o)t!=="default"&&!i.hasOwnProperty(t)&&(i[t]=o[t])}function nc(o){var i=typeof Symbol=="function"&&Symbol.iterator,t=i&&o[i],n=0;if(t)return t.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&n>=o.length&&(o=void 0),{value:o&&o[n++],done:!o}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ul(o,i){var t=typeof Symbol=="function"&&o[Symbol.iterator];if(!t)return o;var n=t.call(o),a,u=[],f;try{for(;(i===void 0||i-- >0)&&!(a=n.next()).done;)u.push(a.value)}catch(g){f={error:g}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(f)throw f.error}}return u}function Y1(){for(var o=[],i=0;i<arguments.length;i++)o=o.concat(Ul(arguments[i]));return o}function Q1(){for(var o=0,i=0,t=arguments.length;i<t;i++)o+=arguments[i].length;for(var n=Array(o),a=0,i=0;i<t;i++)for(var u=arguments[i],f=0,g=u.length;f<g;f++,a++)n[a]=u[f];return n}function kn(o){return this instanceof kn?(this.v=o,this):new kn(o)}function Z1(o,i,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(o,i||[]),a,u=[];return a={},f("next"),f("throw"),f("return"),a[Symbol.asyncIterator]=function(){return this},a;function f(N){n[N]&&(a[N]=function(U){return new Promise(function(z,K){u.push([N,U,z,K])>1||g(N,U)})})}function g(N,U){try{m(n[N](U))}catch(z){H(u[0][3],z)}}function m(N){N.value instanceof kn?Promise.resolve(N.value.v).then(v,P):H(u[0][2],N)}function v(N){g("next",N)}function P(N){g("throw",N)}function H(N,U){N(U),u.shift(),u.length&&g(u[0][0],u[0][1])}}function X1(o){var i,t;return i={},n("next"),n("throw",function(a){throw a}),n("return"),i[Symbol.iterator]=function(){return this},i;function n(a,u){i[a]=o[a]?function(f){return(t=!t)?{value:kn(o[a](f)),done:a==="return"}:u?u(f):f}:u}}function e_(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=o[Symbol.asyncIterator],t;return i?i.call(o):(o=typeof nc=="function"?nc(o):o[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(u){t[u]=o[u]&&function(f){return new Promise(function(g,m){f=o[u](f),a(g,m,f.done,f.value)})}}function a(u,f,g,m){Promise.resolve(m).then(function(v){u({value:v,done:g})},f)}}function t_(o,i){return Object.defineProperty?Object.defineProperty(o,"raw",{value:i}):o.raw=i,o}function r_(o){if(o&&o.__esModule)return o;var i={};if(o!=null)for(var t in o)Object.hasOwnProperty.call(o,t)&&(i[t]=o[t]);return i.default=o,i}function i_(o){return o&&o.__esModule?o:{default:o}}function n_(o,i){if(!i.has(o))throw new TypeError("attempted to get private field on non-instance");return i.get(o)}function s_(o,i,t){if(!i.has(o))throw new TypeError("attempted to set private field on non-instance");return i.set(o,t),t}const a_=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return ic},__asyncDelegator:X1,__asyncGenerator:Z1,__asyncValues:e_,__await:kn,__awaiter:B1,__classPrivateFieldGet:n_,__classPrivateFieldSet:s_,__createBinding:W1,__decorate:H1,__exportStar:J1,__extends:U1,__generator:G1,__importDefault:i_,__importStar:r_,__makeTemplateObject:t_,__metadata:V1,__param:K1,__read:Ul,__rest:k1,__spread:Y1,__spreadArrays:Q1,__values:nc},Symbol.toStringTag,{value:"Module"})),kl=oa(a_);var Vn={};Object.defineProperty(Vn,"__esModule",{value:!0});function o_(o){if(typeof o!="string")throw new Error(`Cannot safe json parse value of type ${typeof o}`);try{return JSON.parse(o)}catch{return o}}Vn.safeJsonParse=o_;function c_(o){return typeof o=="string"?o:JSON.stringify(o,(i,t)=>typeof t>"u"?null:t)}Vn.safeJsonStringify=c_;var Tn={exports:{}},Dh;function u_(){return Dh||(Dh=1,function(){let o;function i(){}o=i,o.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},o.prototype.setItem=function(t,n){this[t]=String(n)},o.prototype.removeItem=function(t){delete this[t]},o.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(n){t[n]=void 0,delete t[n]})},o.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},o.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Di<"u"&&Di.localStorage?Tn.exports=Di.localStorage:typeof window<"u"&&window.localStorage?Tn.exports=window.localStorage:Tn.exports=new i}()),Tn.exports}var zo={},Rn={},jh;function h_(){if(jh)return Rn;jh=1,Object.defineProperty(Rn,"__esModule",{value:!0}),Rn.IKeyValueStorage=void 0;class o{}return Rn.IKeyValueStorage=o,Rn}var $n={},Lh;function l_(){if(Lh)return $n;Lh=1,Object.defineProperty($n,"__esModule",{value:!0}),$n.parseEntry=void 0;const o=Vn;function i(t){var n;return[t[0],o.safeJsonParse((n=t[1])!==null&&n!==void 0?n:"")]}return $n.parseEntry=i,$n}var qh;function f_(){return qh||(qh=1,function(o){Object.defineProperty(o,"__esModule",{value:!0});const i=kl;i.__exportStar(h_(),o),i.__exportStar(l_(),o)}(zo)),zo}Object.defineProperty(ua,"__esModule",{value:!0});ua.KeyValueStorage=void 0;const on=kl,Mh=Vn,p_=on.__importDefault(u_()),d_=f_();class Hl{constructor(){this.localStorage=p_.default}getKeys(){return on.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return on.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(d_.parseEntry)})}getItem(i){return on.__awaiter(this,void 0,void 0,function*(){const t=this.localStorage.getItem(i);if(t!==null)return Mh.safeJsonParse(t)})}setItem(i,t){return on.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(i,Mh.safeJsonStringify(t))})}removeItem(i){return on.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(i)})}}ua.KeyValueStorage=Hl;var g_=ua.default=Hl,hn={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var sc=function(o,i){return sc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)n.hasOwnProperty(a)&&(t[a]=n[a])},sc(o,i)};function y_(o,i){sc(o,i);function t(){this.constructor=o}o.prototype=i===null?Object.create(i):(t.prototype=i.prototype,new t)}var ac=function(){return ac=Object.assign||function(i){for(var t,n=1,a=arguments.length;n<a;n++){t=arguments[n];for(var u in t)Object.prototype.hasOwnProperty.call(t,u)&&(i[u]=t[u])}return i},ac.apply(this,arguments)};function v_(o,i){var t={};for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&i.indexOf(n)<0&&(t[n]=o[n]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(o);a<n.length;a++)i.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(o,n[a])&&(t[n[a]]=o[n[a]]);return t}function __(o,i,t,n){var a=arguments.length,u=a<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(o,i,t,n);else for(var g=o.length-1;g>=0;g--)(f=o[g])&&(u=(a<3?f(u):a>3?f(i,t,u):f(i,t))||u);return a>3&&u&&Object.defineProperty(i,t,u),u}function m_(o,i){return function(t,n){i(t,n,o)}}function w_(o,i){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,i)}function b_(o,i,t,n){function a(u){return u instanceof t?u:new t(function(f){f(u)})}return new(t||(t=Promise))(function(u,f){function g(P){try{v(n.next(P))}catch(H){f(H)}}function m(P){try{v(n.throw(P))}catch(H){f(H)}}function v(P){P.done?u(P.value):a(P.value).then(g,m)}v((n=n.apply(o,i||[])).next())})}function E_(o,i){var t={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},n,a,u,f;return f={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function g(v){return function(P){return m([v,P])}}function m(v){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(u=v[0]&2?a.return:v[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,v[1])).done)return u;switch(a=0,u&&(v=[v[0]&2,u.value]),v[0]){case 0:case 1:u=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,a=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(u=t.trys,!(u=u.length>0&&u[u.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!u||v[1]>u[0]&&v[1]<u[3])){t.label=v[1];break}if(v[0]===6&&t.label<u[1]){t.label=u[1],u=v;break}if(u&&t.label<u[2]){t.label=u[2],t.ops.push(v);break}u[2]&&t.ops.pop(),t.trys.pop();continue}v=i.call(o,t)}catch(P){v=[6,P],a=0}finally{n=u=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}function x_(o,i,t,n){n===void 0&&(n=t),o[n]=i[t]}function I_(o,i){for(var t in o)t!=="default"&&!i.hasOwnProperty(t)&&(i[t]=o[t])}function oc(o){var i=typeof Symbol=="function"&&Symbol.iterator,t=i&&o[i],n=0;if(t)return t.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&n>=o.length&&(o=void 0),{value:o&&o[n++],done:!o}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")}function Kl(o,i){var t=typeof Symbol=="function"&&o[Symbol.iterator];if(!t)return o;var n=t.call(o),a,u=[],f;try{for(;(i===void 0||i-- >0)&&!(a=n.next()).done;)u.push(a.value)}catch(g){f={error:g}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(f)throw f.error}}return u}function S_(){for(var o=[],i=0;i<arguments.length;i++)o=o.concat(Kl(arguments[i]));return o}function P_(){for(var o=0,i=0,t=arguments.length;i<t;i++)o+=arguments[i].length;for(var n=Array(o),a=0,i=0;i<t;i++)for(var u=arguments[i],f=0,g=u.length;f<g;f++,a++)n[a]=u[f];return n}function Hn(o){return this instanceof Hn?(this.v=o,this):new Hn(o)}function O_(o,i,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(o,i||[]),a,u=[];return a={},f("next"),f("throw"),f("return"),a[Symbol.asyncIterator]=function(){return this},a;function f(N){n[N]&&(a[N]=function(U){return new Promise(function(z,K){u.push([N,U,z,K])>1||g(N,U)})})}function g(N,U){try{m(n[N](U))}catch(z){H(u[0][3],z)}}function m(N){N.value instanceof Hn?Promise.resolve(N.value.v).then(v,P):H(u[0][2],N)}function v(N){g("next",N)}function P(N){g("throw",N)}function H(N,U){N(U),u.shift(),u.length&&g(u[0][0],u[0][1])}}function C_(o){var i,t;return i={},n("next"),n("throw",function(a){throw a}),n("return"),i[Symbol.iterator]=function(){return this},i;function n(a,u){i[a]=o[a]?function(f){return(t=!t)?{value:Hn(o[a](f)),done:a==="return"}:u?u(f):f}:u}}function A_(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=o[Symbol.asyncIterator],t;return i?i.call(o):(o=typeof oc=="function"?oc(o):o[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(u){t[u]=o[u]&&function(f){return new Promise(function(g,m){f=o[u](f),a(g,m,f.done,f.value)})}}function a(u,f,g,m){Promise.resolve(m).then(function(v){u({value:v,done:g})},f)}}function T_(o,i){return Object.defineProperty?Object.defineProperty(o,"raw",{value:i}):o.raw=i,o}function R_(o){if(o&&o.__esModule)return o;var i={};if(o!=null)for(var t in o)Object.hasOwnProperty.call(o,t)&&(i[t]=o[t]);return i.default=o,i}function $_(o){return o&&o.__esModule?o:{default:o}}function N_(o,i){if(!i.has(o))throw new TypeError("attempted to get private field on non-instance");return i.get(o)}function F_(o,i,t){if(!i.has(o))throw new TypeError("attempted to set private field on non-instance");return i.set(o,t),t}const D_=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return ac},__asyncDelegator:C_,__asyncGenerator:O_,__asyncValues:A_,__await:Hn,__awaiter:b_,__classPrivateFieldGet:N_,__classPrivateFieldSet:F_,__createBinding:x_,__decorate:__,__exportStar:I_,__extends:y_,__generator:E_,__importDefault:$_,__importStar:R_,__makeTemplateObject:T_,__metadata:w_,__param:m_,__read:Kl,__rest:v_,__spread:S_,__spreadArrays:P_,__values:oc},Symbol.toStringTag,{value:"Module"})),ha=oa(D_);var Nn={},Uo={},Fn={};class Li{}const j_=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Li},Symbol.toStringTag,{value:"Module"})),L_=oa(j_);var zh;function q_(){if(zh)return Fn;zh=1,Object.defineProperty(Fn,"__esModule",{value:!0}),Fn.IHeartBeat=void 0;const o=L_;class i extends o.IEvents{constructor(n){super()}}return Fn.IHeartBeat=i,Fn}var Uh;function Vl(){return Uh||(Uh=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),ha.__exportStar(q_(),o)}(Uo)),Uo}var ko={},Ni={},kh;function M_(){if(kh)return Ni;kh=1,Object.defineProperty(Ni,"__esModule",{value:!0}),Ni.HEARTBEAT_EVENTS=Ni.HEARTBEAT_INTERVAL=void 0;const o=re;return Ni.HEARTBEAT_INTERVAL=o.FIVE_SECONDS,Ni.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Ni}var Hh;function Bl(){return Hh||(Hh=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),ha.__exportStar(M_(),o)}(ko)),ko}var Kh;function z_(){if(Kh)return Nn;Kh=1,Object.defineProperty(Nn,"__esModule",{value:!0}),Nn.HeartBeat=void 0;const o=ha,i=kr,t=re,n=Vl(),a=Bl();class u extends n.IHeartBeat{constructor(g){super(g),this.events=new i.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=(g==null?void 0:g.interval)||a.HEARTBEAT_INTERVAL}static init(g){return o.__awaiter(this,void 0,void 0,function*(){const m=new u(g);return yield m.init(),m})}init(){return o.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(g,m){this.events.on(g,m)}once(g,m){this.events.once(g,m)}off(g,m){this.events.off(g,m)}removeListener(g,m){this.events.removeListener(g,m)}initialize(){return o.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),t.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return Nn.HeartBeat=u,Nn}(function(o){Object.defineProperty(o,"__esModule",{value:!0});const i=ha;i.__exportStar(z_(),o),i.__exportStar(Vl(),o),i.__exportStar(Bl(),o)})(hn);var Ce={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var cc=function(o,i){return cc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)n.hasOwnProperty(a)&&(t[a]=n[a])},cc(o,i)};function U_(o,i){cc(o,i);function t(){this.constructor=o}o.prototype=i===null?Object.create(i):(t.prototype=i.prototype,new t)}var uc=function(){return uc=Object.assign||function(i){for(var t,n=1,a=arguments.length;n<a;n++){t=arguments[n];for(var u in t)Object.prototype.hasOwnProperty.call(t,u)&&(i[u]=t[u])}return i},uc.apply(this,arguments)};function k_(o,i){var t={};for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&i.indexOf(n)<0&&(t[n]=o[n]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(o);a<n.length;a++)i.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(o,n[a])&&(t[n[a]]=o[n[a]]);return t}function H_(o,i,t,n){var a=arguments.length,u=a<3?i:n===null?n=Object.getOwnPropertyDescriptor(i,t):n,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(o,i,t,n);else for(var g=o.length-1;g>=0;g--)(f=o[g])&&(u=(a<3?f(u):a>3?f(i,t,u):f(i,t))||u);return a>3&&u&&Object.defineProperty(i,t,u),u}function K_(o,i){return function(t,n){i(t,n,o)}}function V_(o,i){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,i)}function B_(o,i,t,n){function a(u){return u instanceof t?u:new t(function(f){f(u)})}return new(t||(t=Promise))(function(u,f){function g(P){try{v(n.next(P))}catch(H){f(H)}}function m(P){try{v(n.throw(P))}catch(H){f(H)}}function v(P){P.done?u(P.value):a(P.value).then(g,m)}v((n=n.apply(o,i||[])).next())})}function G_(o,i){var t={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},n,a,u,f;return f={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function g(v){return function(P){return m([v,P])}}function m(v){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(u=v[0]&2?a.return:v[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,v[1])).done)return u;switch(a=0,u&&(v=[v[0]&2,u.value]),v[0]){case 0:case 1:u=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,a=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(u=t.trys,!(u=u.length>0&&u[u.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!u||v[1]>u[0]&&v[1]<u[3])){t.label=v[1];break}if(v[0]===6&&t.label<u[1]){t.label=u[1],u=v;break}if(u&&t.label<u[2]){t.label=u[2],t.ops.push(v);break}u[2]&&t.ops.pop(),t.trys.pop();continue}v=i.call(o,t)}catch(P){v=[6,P],a=0}finally{n=u=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}function W_(o,i,t,n){n===void 0&&(n=t),o[n]=i[t]}function J_(o,i){for(var t in o)t!=="default"&&!i.hasOwnProperty(t)&&(i[t]=o[t])}function hc(o){var i=typeof Symbol=="function"&&Symbol.iterator,t=i&&o[i],n=0;if(t)return t.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&n>=o.length&&(o=void 0),{value:o&&o[n++],done:!o}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")}function Gl(o,i){var t=typeof Symbol=="function"&&o[Symbol.iterator];if(!t)return o;var n=t.call(o),a,u=[],f;try{for(;(i===void 0||i-- >0)&&!(a=n.next()).done;)u.push(a.value)}catch(g){f={error:g}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(f)throw f.error}}return u}function Y_(){for(var o=[],i=0;i<arguments.length;i++)o=o.concat(Gl(arguments[i]));return o}function Q_(){for(var o=0,i=0,t=arguments.length;i<t;i++)o+=arguments[i].length;for(var n=Array(o),a=0,i=0;i<t;i++)for(var u=arguments[i],f=0,g=u.length;f<g;f++,a++)n[a]=u[f];return n}function Kn(o){return this instanceof Kn?(this.v=o,this):new Kn(o)}function Z_(o,i,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(o,i||[]),a,u=[];return a={},f("next"),f("throw"),f("return"),a[Symbol.asyncIterator]=function(){return this},a;function f(N){n[N]&&(a[N]=function(U){return new Promise(function(z,K){u.push([N,U,z,K])>1||g(N,U)})})}function g(N,U){try{m(n[N](U))}catch(z){H(u[0][3],z)}}function m(N){N.value instanceof Kn?Promise.resolve(N.value.v).then(v,P):H(u[0][2],N)}function v(N){g("next",N)}function P(N){g("throw",N)}function H(N,U){N(U),u.shift(),u.length&&g(u[0][0],u[0][1])}}function X_(o){var i,t;return i={},n("next"),n("throw",function(a){throw a}),n("return"),i[Symbol.iterator]=function(){return this},i;function n(a,u){i[a]=o[a]?function(f){return(t=!t)?{value:Kn(o[a](f)),done:a==="return"}:u?u(f):f}:u}}function em(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=o[Symbol.asyncIterator],t;return i?i.call(o):(o=typeof hc=="function"?hc(o):o[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(u){t[u]=o[u]&&function(f){return new Promise(function(g,m){f=o[u](f),a(g,m,f.done,f.value)})}}function a(u,f,g,m){Promise.resolve(m).then(function(v){u({value:v,done:g})},f)}}function tm(o,i){return Object.defineProperty?Object.defineProperty(o,"raw",{value:i}):o.raw=i,o}function rm(o){if(o&&o.__esModule)return o;var i={};if(o!=null)for(var t in o)Object.hasOwnProperty.call(o,t)&&(i[t]=o[t]);return i.default=o,i}function im(o){return o&&o.__esModule?o:{default:o}}function nm(o,i){if(!i.has(o))throw new TypeError("attempted to get private field on non-instance");return i.get(o)}function sm(o,i,t){if(!i.has(o))throw new TypeError("attempted to set private field on non-instance");return i.set(o,t),t}const am=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return uc},__asyncDelegator:X_,__asyncGenerator:Z_,__asyncValues:em,__await:Kn,__awaiter:B_,__classPrivateFieldGet:nm,__classPrivateFieldSet:sm,__createBinding:W_,__decorate:H_,__exportStar:J_,__extends:U_,__generator:G_,__importDefault:im,__importStar:rm,__makeTemplateObject:tm,__metadata:V_,__param:K_,__read:Gl,__rest:k_,__spread:Y_,__spreadArrays:Q_,__values:hc},Symbol.toStringTag,{value:"Module"})),om=oa(am);var Ho,Vh;function cm(){if(Vh)return Ho;Vh=1;function o(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}Ho=i;function i(t,n,a){var u=a&&a.stringify||o,f=1;if(typeof t=="object"&&t!==null){var g=n.length+f;if(g===1)return t;var m=new Array(g);m[0]=u(t);for(var v=1;v<g;v++)m[v]=u(n[v]);return m.join(" ")}if(typeof t!="string")return t;var P=n.length;if(P===0)return t;for(var H="",N=1-f,U=-1,z=t&&t.length||0,K=0;K<z;){if(t.charCodeAt(K)===37&&K+1<z){switch(U=U>-1?U:0,t.charCodeAt(K+1)){case 100:case 102:if(N>=P||n[N]==null)break;U<K&&(H+=t.slice(U,K)),H+=Number(n[N]),U=K+2,K++;break;case 105:if(N>=P||n[N]==null)break;U<K&&(H+=t.slice(U,K)),H+=Math.floor(Number(n[N])),U=K+2,K++;break;case 79:case 111:case 106:if(N>=P||n[N]===void 0)break;U<K&&(H+=t.slice(U,K));var ae=typeof n[N];if(ae==="string"){H+="'"+n[N]+"'",U=K+2,K++;break}if(ae==="function"){H+=n[N].name||"<anonymous>",U=K+2,K++;break}H+=u(n[N]),U=K+2,K++;break;case 115:if(N>=P)break;U<K&&(H+=t.slice(U,K)),H+=String(n[N]),U=K+2,K++;break;case 37:U<K&&(H+=t.slice(U,K)),H+="%",U=K+2,K++,N--;break}++N}++K}return U===-1?t:(U<z&&(H+=t.slice(U)),H)}return Ho}var Ko,Bh;function um(){if(Bh)return Ko;Bh=1;const o=cm();Ko=a;const i=he().console||{},t={mapHttpRequest:z,mapHttpResponse:z,wrapRequestSerializer:K,wrapResponseSerializer:K,wrapErrorSerializer:K,req:z,res:z,err:N};function n(R,M){return Array.isArray(R)?R.filter(function(ge){return ge!=="!stdSerializers.err"}):R===!0?Object.keys(M):!1}function a(R){R=R||{},R.browser=R.browser||{};const M=R.browser.transmit;if(M&&typeof M.send!="function")throw Error("pino: transmit option must have a send function");const W=R.browser.write||i;R.browser.write&&(R.browser.asObject=!0);const ge=R.serializers||{},te=n(R.browser.serialize,ge);let Ee=R.browser.serialize;Array.isArray(R.browser.serialize)&&R.browser.serialize.indexOf("!stdSerializers.err")>-1&&(Ee=!1);const Ae=["error","fatal","warn","info","debug","trace"];typeof W=="function"&&(W.error=W.fatal=W.warn=W.info=W.debug=W.trace=W),R.enabled===!1&&(R.level="silent");const et=R.level||"info",C=Object.create(W);C.log||(C.log=ae),Object.defineProperty(C,"levelVal",{get:Me}),Object.defineProperty(C,"level",{get:Te,set:J});const j={transmit:M,serialize:te,asObject:R.browser.asObject,levels:Ae,timestamp:U(R)};C.levels=a.levels,C.level=et,C.setMaxListeners=C.getMaxListeners=C.emit=C.addListener=C.on=C.prependListener=C.once=C.prependOnceListener=C.removeListener=C.removeAllListeners=C.listeners=C.listenerCount=C.eventNames=C.write=C.flush=ae,C.serializers=ge,C._serialize=te,C._stdErrSerialize=Ee,C.child=V,M&&(C._logEvent=H());function Me(){return this.level==="silent"?1/0:this.levels.values[this.level]}function Te(){return this._level}function J(k){if(k!=="silent"&&!this.levels.values[k])throw Error("unknown level "+k);this._level=k,u(j,C,"error","log"),u(j,C,"fatal","error"),u(j,C,"warn","error"),u(j,C,"info","log"),u(j,C,"debug","log"),u(j,C,"trace","log")}function V(k,B){if(!k)throw new Error("missing bindings for child Pino");B=B||{},te&&k.serializers&&(B.serializers=k.serializers);const ct=B.serializers;if(te&&ct){var ke=Object.assign({},ge,ct),Nr=R.browser.serialize===!0?Object.keys(ke):te;delete k.serializers,m([k],Nr,ke,this._stdErrSerialize)}function me(It){this._childLevel=(It._childLevel|0)+1,this.error=v(It,k,"error"),this.fatal=v(It,k,"fatal"),this.warn=v(It,k,"warn"),this.info=v(It,k,"info"),this.debug=v(It,k,"debug"),this.trace=v(It,k,"trace"),ke&&(this.serializers=ke,this._serialize=Nr),M&&(this._logEvent=H([].concat(It._logEvent.bindings,k)))}return me.prototype=this,new me(this)}return C}a.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},a.stdSerializers=t,a.stdTimeFunctions=Object.assign({},{nullTime:be,epochTime:de,unixTime:pe,isoTime:ue});function u(R,M,W,ge){const te=Object.getPrototypeOf(M);M[W]=M.levelVal>M.levels.values[W]?ae:te[W]?te[W]:i[W]||i[ge]||ae,f(R,M,W)}function f(R,M,W){!R.transmit&&M[W]===ae||(M[W]=function(ge){return function(){const Ee=R.timestamp(),Ae=new Array(arguments.length),et=Object.getPrototypeOf&&Object.getPrototypeOf(this)===i?i:this;for(var C=0;C<Ae.length;C++)Ae[C]=arguments[C];if(R.serialize&&!R.asObject&&m(Ae,this._serialize,this.serializers,this._stdErrSerialize),R.asObject?ge.call(et,g(this,W,Ae,Ee)):ge.apply(et,Ae),R.transmit){const j=R.transmit.level||M.level,Me=a.levels.values[j],Te=a.levels.values[W];if(Te<Me)return;P(this,{ts:Ee,methodLevel:W,methodValue:Te,transmitLevel:j,transmitValue:a.levels.values[R.transmit.level||M.level],send:R.transmit.send,val:M.levelVal},Ae)}}}(M[W]))}function g(R,M,W,ge){R._serialize&&m(W,R._serialize,R.serializers,R._stdErrSerialize);const te=W.slice();let Ee=te[0];const Ae={};ge&&(Ae.time=ge),Ae.level=a.levels.values[M];let et=(R._childLevel|0)+1;if(et<1&&(et=1),Ee!==null&&typeof Ee=="object"){for(;et--&&typeof te[0]=="object";)Object.assign(Ae,te.shift());Ee=te.length?o(te.shift(),te):void 0}else typeof Ee=="string"&&(Ee=o(te.shift(),te));return Ee!==void 0&&(Ae.msg=Ee),Ae}function m(R,M,W,ge){for(const te in R)if(ge&&R[te]instanceof Error)R[te]=a.stdSerializers.err(R[te]);else if(typeof R[te]=="object"&&!Array.isArray(R[te]))for(const Ee in R[te])M&&M.indexOf(Ee)>-1&&Ee in W&&(R[te][Ee]=W[Ee](R[te][Ee]))}function v(R,M,W){return function(){const ge=new Array(1+arguments.length);ge[0]=M;for(var te=1;te<ge.length;te++)ge[te]=arguments[te-1];return R[W].apply(this,ge)}}function P(R,M,W){const ge=M.send,te=M.ts,Ee=M.methodLevel,Ae=M.methodValue,et=M.val,C=R._logEvent.bindings;m(W,R._serialize||Object.keys(R.serializers),R.serializers,R._stdErrSerialize===void 0?!0:R._stdErrSerialize),R._logEvent.ts=te,R._logEvent.messages=W.filter(function(j){return C.indexOf(j)===-1}),R._logEvent.level.label=Ee,R._logEvent.level.value=Ae,ge(Ee,R._logEvent,et),R._logEvent=H(C)}function H(R){return{ts:0,messages:[],bindings:R||[],level:{label:"",value:0}}}function N(R){const M={type:R.constructor.name,msg:R.message,stack:R.stack};for(const W in R)M[W]===void 0&&(M[W]=R[W]);return M}function U(R){return typeof R.timestamp=="function"?R.timestamp:R.timestamp===!1?be:de}function z(){return{}}function K(R){return R}function ae(){}function be(){return!1}function de(){return Date.now()}function pe(){return Math.round(Date.now()/1e3)}function ue(){return new Date(Date.now()).toISOString()}function he(){function R(M){return typeof M<"u"&&M}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return R(self)||R(window)||R(this)||{}}}return Ko}var Fi={},Gh;function Wl(){return Gh||(Gh=1,Object.defineProperty(Fi,"__esModule",{value:!0}),Fi.PINO_CUSTOM_CONTEXT_KEY=Fi.PINO_LOGGER_DEFAULTS=void 0,Fi.PINO_LOGGER_DEFAULTS={level:"info"},Fi.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Fi}var Xt={},Wh;function hm(){if(Wh)return Xt;Wh=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.generateChildLogger=Xt.formatChildLoggerContext=Xt.getLoggerContext=Xt.setBrowserLoggerContext=Xt.getBrowserLoggerContext=Xt.getDefaultLoggerOptions=void 0;const o=Wl();function i(g){return Object.assign(Object.assign({},g),{level:(g==null?void 0:g.level)||o.PINO_LOGGER_DEFAULTS.level})}Xt.getDefaultLoggerOptions=i;function t(g,m=o.PINO_CUSTOM_CONTEXT_KEY){return g[m]||""}Xt.getBrowserLoggerContext=t;function n(g,m,v=o.PINO_CUSTOM_CONTEXT_KEY){return g[v]=m,g}Xt.setBrowserLoggerContext=n;function a(g,m=o.PINO_CUSTOM_CONTEXT_KEY){let v="";return typeof g.bindings>"u"?v=t(g,m):v=g.bindings().context||"",v}Xt.getLoggerContext=a;function u(g,m,v=o.PINO_CUSTOM_CONTEXT_KEY){const P=a(g,v);return P.trim()?`${P}/${m}`:m}Xt.formatChildLoggerContext=u;function f(g,m,v=o.PINO_CUSTOM_CONTEXT_KEY){const P=u(g,m,v),H=g.child({context:P});return n(H,P,v)}return Xt.generateChildLogger=f,Xt}(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.pino=void 0;const i=om,t=i.__importDefault(um());Object.defineProperty(o,"pino",{enumerable:!0,get:function(){return t.default}}),i.__exportStar(Wl(),o),i.__exportStar(hm(),o)})(Ce);class lm extends Li{constructor(i){super(),this.opts=i,this.protocol="wc",this.version=2}}class fm extends Li{constructor(i,t){super(),this.core=i,this.logger=t,this.records=new Map}}class pm{constructor(i,t){this.logger=i,this.core=t}}let dm=class extends Li{constructor(i,t){super(),this.relayer=i,this.logger=t}},gm=class extends Li{constructor(i){super()}},ym=class{constructor(i,t,n,a){this.core=i,this.logger=t,this.name=n}};class vm extends Li{constructor(i,t){super(),this.relayer=i,this.logger=t}}let _m=class extends Li{constructor(i,t){super(),this.core=i,this.logger=t}},mm=class{constructor(i,t){this.projectId=i,this.logger=t}};class wm{constructor(i){this.opts=i,this.protocol="wc",this.version=2}}let bm=class{constructor(i){this.client=i}};var Sc={},Jl={};(function(o){Object.defineProperty(o,"__esModule",{value:!0});var i=Zv,t=Rl;o.DIGEST_LENGTH=64,o.BLOCK_SIZE=128;var n=function(){function g(){this.digestLength=o.DIGEST_LENGTH,this.blockSize=o.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return g.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},g.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},g.prototype.clean=function(){t.wipe(this._buffer),t.wipe(this._tempHi),t.wipe(this._tempLo),this.reset()},g.prototype.update=function(m,v){if(v===void 0&&(v=m.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var P=0;if(this._bytesHashed+=v,this._bufferLength>0){for(;this._bufferLength<o.BLOCK_SIZE&&v>0;)this._buffer[this._bufferLength++]=m[P++],v--;this._bufferLength===this.blockSize&&(u(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(v>=this.blockSize&&(P=u(this._tempHi,this._tempLo,this._stateHi,this._stateLo,m,P,v),v%=this.blockSize);v>0;)this._buffer[this._bufferLength++]=m[P++],v--;return this},g.prototype.finish=function(m){if(!this._finished){var v=this._bytesHashed,P=this._bufferLength,H=v/536870912|0,N=v<<3,U=v%128<112?128:256;this._buffer[P]=128;for(var z=P+1;z<U-8;z++)this._buffer[z]=0;i.writeUint32BE(H,this._buffer,U-8),i.writeUint32BE(N,this._buffer,U-4),u(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,U),this._finished=!0}for(var z=0;z<this.digestLength/8;z++)i.writeUint32BE(this._stateHi[z],m,z*8),i.writeUint32BE(this._stateLo[z],m,z*8+4);return this},g.prototype.digest=function(){var m=new Uint8Array(this.digestLength);return this.finish(m),m},g.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},g.prototype.restoreState=function(m){return this._stateHi.set(m.stateHi),this._stateLo.set(m.stateLo),this._bufferLength=m.bufferLength,m.buffer&&this._buffer.set(m.buffer),this._bytesHashed=m.bytesHashed,this._finished=!1,this},g.prototype.cleanSavedState=function(m){t.wipe(m.stateHi),t.wipe(m.stateLo),m.buffer&&t.wipe(m.buffer),m.bufferLength=0,m.bytesHashed=0},g}();o.SHA512=n;var a=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function u(g,m,v,P,H,N,U){for(var z=v[0],K=v[1],ae=v[2],be=v[3],de=v[4],pe=v[5],ue=v[6],he=v[7],R=P[0],M=P[1],W=P[2],ge=P[3],te=P[4],Ee=P[5],Ae=P[6],et=P[7],C,j,Me,Te,J,V,k,B;U>=128;){for(var ct=0;ct<16;ct++){var ke=8*ct+N;g[ct]=i.readUint32BE(H,ke),m[ct]=i.readUint32BE(H,ke+4)}for(var ct=0;ct<80;ct++){var Nr=z,me=K,It=ae,T=be,A=de,S=pe,h=ue,b=he,X=R,oe=M,ve=W,Re=ge,Ne=te,Ie=Ee,St=Ae,_t=et;if(C=he,j=et,J=j&65535,V=j>>>16,k=C&65535,B=C>>>16,C=(de>>>14|te<<32-14)^(de>>>18|te<<32-18)^(te>>>41-32|de<<32-(41-32)),j=(te>>>14|de<<32-14)^(te>>>18|de<<32-18)^(de>>>41-32|te<<32-(41-32)),J+=j&65535,V+=j>>>16,k+=C&65535,B+=C>>>16,C=de&pe^~de&ue,j=te&Ee^~te&Ae,J+=j&65535,V+=j>>>16,k+=C&65535,B+=C>>>16,C=a[ct*2],j=a[ct*2+1],J+=j&65535,V+=j>>>16,k+=C&65535,B+=C>>>16,C=g[ct%16],j=m[ct%16],J+=j&65535,V+=j>>>16,k+=C&65535,B+=C>>>16,V+=J>>>16,k+=V>>>16,B+=k>>>16,Me=k&65535|B<<16,Te=J&65535|V<<16,C=Me,j=Te,J=j&65535,V=j>>>16,k=C&65535,B=C>>>16,C=(z>>>28|R<<32-28)^(R>>>34-32|z<<32-(34-32))^(R>>>39-32|z<<32-(39-32)),j=(R>>>28|z<<32-28)^(z>>>34-32|R<<32-(34-32))^(z>>>39-32|R<<32-(39-32)),J+=j&65535,V+=j>>>16,k+=C&65535,B+=C>>>16,C=z&K^z&ae^K&ae,j=R&M^R&W^M&W,J+=j&65535,V+=j>>>16,k+=C&65535,B+=C>>>16,V+=J>>>16,k+=V>>>16,B+=k>>>16,b=k&65535|B<<16,_t=J&65535|V<<16,C=T,j=Re,J=j&65535,V=j>>>16,k=C&65535,B=C>>>16,C=Me,j=Te,J+=j&65535,V+=j>>>16,k+=C&65535,B+=C>>>16,V+=J>>>16,k+=V>>>16,B+=k>>>16,T=k&65535|B<<16,Re=J&65535|V<<16,K=Nr,ae=me,be=It,de=T,pe=A,ue=S,he=h,z=b,M=X,W=oe,ge=ve,te=Re,Ee=Ne,Ae=Ie,et=St,R=_t,ct%16===15)for(var ke=0;ke<16;ke++)C=g[ke],j=m[ke],J=j&65535,V=j>>>16,k=C&65535,B=C>>>16,C=g[(ke+9)%16],j=m[(ke+9)%16],J+=j&65535,V+=j>>>16,k+=C&65535,B+=C>>>16,Me=g[(ke+1)%16],Te=m[(ke+1)%16],C=(Me>>>1|Te<<32-1)^(Me>>>8|Te<<32-8)^Me>>>7,j=(Te>>>1|Me<<32-1)^(Te>>>8|Me<<32-8)^(Te>>>7|Me<<32-7),J+=j&65535,V+=j>>>16,k+=C&65535,B+=C>>>16,Me=g[(ke+14)%16],Te=m[(ke+14)%16],C=(Me>>>19|Te<<32-19)^(Te>>>61-32|Me<<32-(61-32))^Me>>>6,j=(Te>>>19|Me<<32-19)^(Me>>>61-32|Te<<32-(61-32))^(Te>>>6|Me<<32-6),J+=j&65535,V+=j>>>16,k+=C&65535,B+=C>>>16,V+=J>>>16,k+=V>>>16,B+=k>>>16,g[ke]=k&65535|B<<16,m[ke]=J&65535|V<<16}C=z,j=R,J=j&65535,V=j>>>16,k=C&65535,B=C>>>16,C=v[0],j=P[0],J+=j&65535,V+=j>>>16,k+=C&65535,B+=C>>>16,V+=J>>>16,k+=V>>>16,B+=k>>>16,v[0]=z=k&65535|B<<16,P[0]=R=J&65535|V<<16,C=K,j=M,J=j&65535,V=j>>>16,k=C&65535,B=C>>>16,C=v[1],j=P[1],J+=j&65535,V+=j>>>16,k+=C&65535,B+=C>>>16,V+=J>>>16,k+=V>>>16,B+=k>>>16,v[1]=K=k&65535|B<<16,P[1]=M=J&65535|V<<16,C=ae,j=W,J=j&65535,V=j>>>16,k=C&65535,B=C>>>16,C=v[2],j=P[2],J+=j&65535,V+=j>>>16,k+=C&65535,B+=C>>>16,V+=J>>>16,k+=V>>>16,B+=k>>>16,v[2]=ae=k&65535|B<<16,P[2]=W=J&65535|V<<16,C=be,j=ge,J=j&65535,V=j>>>16,k=C&65535,B=C>>>16,C=v[3],j=P[3],J+=j&65535,V+=j>>>16,k+=C&65535,B+=C>>>16,V+=J>>>16,k+=V>>>16,B+=k>>>16,v[3]=be=k&65535|B<<16,P[3]=ge=J&65535|V<<16,C=de,j=te,J=j&65535,V=j>>>16,k=C&65535,B=C>>>16,C=v[4],j=P[4],J+=j&65535,V+=j>>>16,k+=C&65535,B+=C>>>16,V+=J>>>16,k+=V>>>16,B+=k>>>16,v[4]=de=k&65535|B<<16,P[4]=te=J&65535|V<<16,C=pe,j=Ee,J=j&65535,V=j>>>16,k=C&65535,B=C>>>16,C=v[5],j=P[5],J+=j&65535,V+=j>>>16,k+=C&65535,B+=C>>>16,V+=J>>>16,k+=V>>>16,B+=k>>>16,v[5]=pe=k&65535|B<<16,P[5]=Ee=J&65535|V<<16,C=ue,j=Ae,J=j&65535,V=j>>>16,k=C&65535,B=C>>>16,C=v[6],j=P[6],J+=j&65535,V+=j>>>16,k+=C&65535,B+=C>>>16,V+=J>>>16,k+=V>>>16,B+=k>>>16,v[6]=ue=k&65535|B<<16,P[6]=Ae=J&65535|V<<16,C=he,j=et,J=j&65535,V=j>>>16,k=C&65535,B=C>>>16,C=v[7],j=P[7],J+=j&65535,V+=j>>>16,k+=C&65535,B+=C>>>16,V+=J>>>16,k+=V>>>16,B+=k>>>16,v[7]=he=k&65535|B<<16,P[7]=et=J&65535|V<<16,N+=128,U-=128}return N}function f(g){var m=new n;m.update(g);var v=m.digest();return m.clean(),v}o.hash=f})(Jl);(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.convertSecretKeyToX25519=o.convertPublicKeyToX25519=o.verify=o.sign=o.extractPublicKeyFromSecretKey=o.generateKeyPair=o.generateKeyPairFromSeed=o.SEED_LENGTH=o.SECRET_KEY_LENGTH=o.PUBLIC_KEY_LENGTH=o.SIGNATURE_LENGTH=void 0;const i=$l,t=Jl,n=Rl;o.SIGNATURE_LENGTH=64,o.PUBLIC_KEY_LENGTH=32,o.SECRET_KEY_LENGTH=64,o.SEED_LENGTH=32;function a(T){const A=new Float64Array(16);if(T)for(let S=0;S<T.length;S++)A[S]=T[S];return A}const u=new Uint8Array(32);u[0]=9;const f=a(),g=a([1]),m=a([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),v=a([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),P=a([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),H=a([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),N=a([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function U(T,A){for(let S=0;S<16;S++)T[S]=A[S]|0}function z(T){let A=1;for(let S=0;S<16;S++){let h=T[S]+A+65535;A=Math.floor(h/65536),T[S]=h-A*65536}T[0]+=A-1+37*(A-1)}function K(T,A,S){const h=~(S-1);for(let b=0;b<16;b++){const X=h&(T[b]^A[b]);T[b]^=X,A[b]^=X}}function ae(T,A){const S=a(),h=a();for(let b=0;b<16;b++)h[b]=A[b];z(h),z(h),z(h);for(let b=0;b<2;b++){S[0]=h[0]-65517;for(let oe=1;oe<15;oe++)S[oe]=h[oe]-65535-(S[oe-1]>>16&1),S[oe-1]&=65535;S[15]=h[15]-32767-(S[14]>>16&1);const X=S[15]>>16&1;S[14]&=65535,K(h,S,1-X)}for(let b=0;b<16;b++)T[2*b]=h[b]&255,T[2*b+1]=h[b]>>8}function be(T,A){let S=0;for(let h=0;h<32;h++)S|=T[h]^A[h];return(1&S-1>>>8)-1}function de(T,A){const S=new Uint8Array(32),h=new Uint8Array(32);return ae(S,T),ae(h,A),be(S,h)}function pe(T){const A=new Uint8Array(32);return ae(A,T),A[0]&1}function ue(T,A){for(let S=0;S<16;S++)T[S]=A[2*S]+(A[2*S+1]<<8);T[15]&=32767}function he(T,A,S){for(let h=0;h<16;h++)T[h]=A[h]+S[h]}function R(T,A,S){for(let h=0;h<16;h++)T[h]=A[h]-S[h]}function M(T,A,S){let h,b,X=0,oe=0,ve=0,Re=0,Ne=0,Ie=0,St=0,_t=0,nt=0,De=0,Je=0,Ye=0,st=0,ze=0,Qe=0,$e=0,He=0,ut=0,Le=0,Pt=0,Dt=0,Ut=0,kt=0,qt=0,Gt=0,tr=0,Fr=0,Wt=0,Hr=0,ri=0,mi=0,ht=S[0],tt=S[1],lt=S[2],ft=S[3],at=S[4],rt=S[5],Ot=S[6],Ct=S[7],pt=S[8],At=S[9],dt=S[10],mt=S[11],gt=S[12],We=S[13],Tt=S[14],Rt=S[15];h=A[0],X+=h*ht,oe+=h*tt,ve+=h*lt,Re+=h*ft,Ne+=h*at,Ie+=h*rt,St+=h*Ot,_t+=h*Ct,nt+=h*pt,De+=h*At,Je+=h*dt,Ye+=h*mt,st+=h*gt,ze+=h*We,Qe+=h*Tt,$e+=h*Rt,h=A[1],oe+=h*ht,ve+=h*tt,Re+=h*lt,Ne+=h*ft,Ie+=h*at,St+=h*rt,_t+=h*Ot,nt+=h*Ct,De+=h*pt,Je+=h*At,Ye+=h*dt,st+=h*mt,ze+=h*gt,Qe+=h*We,$e+=h*Tt,He+=h*Rt,h=A[2],ve+=h*ht,Re+=h*tt,Ne+=h*lt,Ie+=h*ft,St+=h*at,_t+=h*rt,nt+=h*Ot,De+=h*Ct,Je+=h*pt,Ye+=h*At,st+=h*dt,ze+=h*mt,Qe+=h*gt,$e+=h*We,He+=h*Tt,ut+=h*Rt,h=A[3],Re+=h*ht,Ne+=h*tt,Ie+=h*lt,St+=h*ft,_t+=h*at,nt+=h*rt,De+=h*Ot,Je+=h*Ct,Ye+=h*pt,st+=h*At,ze+=h*dt,Qe+=h*mt,$e+=h*gt,He+=h*We,ut+=h*Tt,Le+=h*Rt,h=A[4],Ne+=h*ht,Ie+=h*tt,St+=h*lt,_t+=h*ft,nt+=h*at,De+=h*rt,Je+=h*Ot,Ye+=h*Ct,st+=h*pt,ze+=h*At,Qe+=h*dt,$e+=h*mt,He+=h*gt,ut+=h*We,Le+=h*Tt,Pt+=h*Rt,h=A[5],Ie+=h*ht,St+=h*tt,_t+=h*lt,nt+=h*ft,De+=h*at,Je+=h*rt,Ye+=h*Ot,st+=h*Ct,ze+=h*pt,Qe+=h*At,$e+=h*dt,He+=h*mt,ut+=h*gt,Le+=h*We,Pt+=h*Tt,Dt+=h*Rt,h=A[6],St+=h*ht,_t+=h*tt,nt+=h*lt,De+=h*ft,Je+=h*at,Ye+=h*rt,st+=h*Ot,ze+=h*Ct,Qe+=h*pt,$e+=h*At,He+=h*dt,ut+=h*mt,Le+=h*gt,Pt+=h*We,Dt+=h*Tt,Ut+=h*Rt,h=A[7],_t+=h*ht,nt+=h*tt,De+=h*lt,Je+=h*ft,Ye+=h*at,st+=h*rt,ze+=h*Ot,Qe+=h*Ct,$e+=h*pt,He+=h*At,ut+=h*dt,Le+=h*mt,Pt+=h*gt,Dt+=h*We,Ut+=h*Tt,kt+=h*Rt,h=A[8],nt+=h*ht,De+=h*tt,Je+=h*lt,Ye+=h*ft,st+=h*at,ze+=h*rt,Qe+=h*Ot,$e+=h*Ct,He+=h*pt,ut+=h*At,Le+=h*dt,Pt+=h*mt,Dt+=h*gt,Ut+=h*We,kt+=h*Tt,qt+=h*Rt,h=A[9],De+=h*ht,Je+=h*tt,Ye+=h*lt,st+=h*ft,ze+=h*at,Qe+=h*rt,$e+=h*Ot,He+=h*Ct,ut+=h*pt,Le+=h*At,Pt+=h*dt,Dt+=h*mt,Ut+=h*gt,kt+=h*We,qt+=h*Tt,Gt+=h*Rt,h=A[10],Je+=h*ht,Ye+=h*tt,st+=h*lt,ze+=h*ft,Qe+=h*at,$e+=h*rt,He+=h*Ot,ut+=h*Ct,Le+=h*pt,Pt+=h*At,Dt+=h*dt,Ut+=h*mt,kt+=h*gt,qt+=h*We,Gt+=h*Tt,tr+=h*Rt,h=A[11],Ye+=h*ht,st+=h*tt,ze+=h*lt,Qe+=h*ft,$e+=h*at,He+=h*rt,ut+=h*Ot,Le+=h*Ct,Pt+=h*pt,Dt+=h*At,Ut+=h*dt,kt+=h*mt,qt+=h*gt,Gt+=h*We,tr+=h*Tt,Fr+=h*Rt,h=A[12],st+=h*ht,ze+=h*tt,Qe+=h*lt,$e+=h*ft,He+=h*at,ut+=h*rt,Le+=h*Ot,Pt+=h*Ct,Dt+=h*pt,Ut+=h*At,kt+=h*dt,qt+=h*mt,Gt+=h*gt,tr+=h*We,Fr+=h*Tt,Wt+=h*Rt,h=A[13],ze+=h*ht,Qe+=h*tt,$e+=h*lt,He+=h*ft,ut+=h*at,Le+=h*rt,Pt+=h*Ot,Dt+=h*Ct,Ut+=h*pt,kt+=h*At,qt+=h*dt,Gt+=h*mt,tr+=h*gt,Fr+=h*We,Wt+=h*Tt,Hr+=h*Rt,h=A[14],Qe+=h*ht,$e+=h*tt,He+=h*lt,ut+=h*ft,Le+=h*at,Pt+=h*rt,Dt+=h*Ot,Ut+=h*Ct,kt+=h*pt,qt+=h*At,Gt+=h*dt,tr+=h*mt,Fr+=h*gt,Wt+=h*We,Hr+=h*Tt,ri+=h*Rt,h=A[15],$e+=h*ht,He+=h*tt,ut+=h*lt,Le+=h*ft,Pt+=h*at,Dt+=h*rt,Ut+=h*Ot,kt+=h*Ct,qt+=h*pt,Gt+=h*At,tr+=h*dt,Fr+=h*mt,Wt+=h*gt,Hr+=h*We,ri+=h*Tt,mi+=h*Rt,X+=38*He,oe+=38*ut,ve+=38*Le,Re+=38*Pt,Ne+=38*Dt,Ie+=38*Ut,St+=38*kt,_t+=38*qt,nt+=38*Gt,De+=38*tr,Je+=38*Fr,Ye+=38*Wt,st+=38*Hr,ze+=38*ri,Qe+=38*mi,b=1,h=X+b+65535,b=Math.floor(h/65536),X=h-b*65536,h=oe+b+65535,b=Math.floor(h/65536),oe=h-b*65536,h=ve+b+65535,b=Math.floor(h/65536),ve=h-b*65536,h=Re+b+65535,b=Math.floor(h/65536),Re=h-b*65536,h=Ne+b+65535,b=Math.floor(h/65536),Ne=h-b*65536,h=Ie+b+65535,b=Math.floor(h/65536),Ie=h-b*65536,h=St+b+65535,b=Math.floor(h/65536),St=h-b*65536,h=_t+b+65535,b=Math.floor(h/65536),_t=h-b*65536,h=nt+b+65535,b=Math.floor(h/65536),nt=h-b*65536,h=De+b+65535,b=Math.floor(h/65536),De=h-b*65536,h=Je+b+65535,b=Math.floor(h/65536),Je=h-b*65536,h=Ye+b+65535,b=Math.floor(h/65536),Ye=h-b*65536,h=st+b+65535,b=Math.floor(h/65536),st=h-b*65536,h=ze+b+65535,b=Math.floor(h/65536),ze=h-b*65536,h=Qe+b+65535,b=Math.floor(h/65536),Qe=h-b*65536,h=$e+b+65535,b=Math.floor(h/65536),$e=h-b*65536,X+=b-1+37*(b-1),b=1,h=X+b+65535,b=Math.floor(h/65536),X=h-b*65536,h=oe+b+65535,b=Math.floor(h/65536),oe=h-b*65536,h=ve+b+65535,b=Math.floor(h/65536),ve=h-b*65536,h=Re+b+65535,b=Math.floor(h/65536),Re=h-b*65536,h=Ne+b+65535,b=Math.floor(h/65536),Ne=h-b*65536,h=Ie+b+65535,b=Math.floor(h/65536),Ie=h-b*65536,h=St+b+65535,b=Math.floor(h/65536),St=h-b*65536,h=_t+b+65535,b=Math.floor(h/65536),_t=h-b*65536,h=nt+b+65535,b=Math.floor(h/65536),nt=h-b*65536,h=De+b+65535,b=Math.floor(h/65536),De=h-b*65536,h=Je+b+65535,b=Math.floor(h/65536),Je=h-b*65536,h=Ye+b+65535,b=Math.floor(h/65536),Ye=h-b*65536,h=st+b+65535,b=Math.floor(h/65536),st=h-b*65536,h=ze+b+65535,b=Math.floor(h/65536),ze=h-b*65536,h=Qe+b+65535,b=Math.floor(h/65536),Qe=h-b*65536,h=$e+b+65535,b=Math.floor(h/65536),$e=h-b*65536,X+=b-1+37*(b-1),T[0]=X,T[1]=oe,T[2]=ve,T[3]=Re,T[4]=Ne,T[5]=Ie,T[6]=St,T[7]=_t,T[8]=nt,T[9]=De,T[10]=Je,T[11]=Ye,T[12]=st,T[13]=ze,T[14]=Qe,T[15]=$e}function W(T,A){M(T,A,A)}function ge(T,A){const S=a();let h;for(h=0;h<16;h++)S[h]=A[h];for(h=253;h>=0;h--)W(S,S),h!==2&&h!==4&&M(S,S,A);for(h=0;h<16;h++)T[h]=S[h]}function te(T,A){const S=a();let h;for(h=0;h<16;h++)S[h]=A[h];for(h=250;h>=0;h--)W(S,S),h!==1&&M(S,S,A);for(h=0;h<16;h++)T[h]=S[h]}function Ee(T,A){const S=a(),h=a(),b=a(),X=a(),oe=a(),ve=a(),Re=a(),Ne=a(),Ie=a();R(S,T[1],T[0]),R(Ie,A[1],A[0]),M(S,S,Ie),he(h,T[0],T[1]),he(Ie,A[0],A[1]),M(h,h,Ie),M(b,T[3],A[3]),M(b,b,v),M(X,T[2],A[2]),he(X,X,X),R(oe,h,S),R(ve,X,b),he(Re,X,b),he(Ne,h,S),M(T[0],oe,ve),M(T[1],Ne,Re),M(T[2],Re,ve),M(T[3],oe,Ne)}function Ae(T,A,S){for(let h=0;h<4;h++)K(T[h],A[h],S)}function et(T,A){const S=a(),h=a(),b=a();ge(b,A[2]),M(S,A[0],b),M(h,A[1],b),ae(T,h),T[31]^=pe(S)<<7}function C(T,A,S){U(T[0],f),U(T[1],g),U(T[2],g),U(T[3],f);for(let h=255;h>=0;--h){const b=S[h/8|0]>>(h&7)&1;Ae(T,A,b),Ee(A,T),Ee(T,T),Ae(T,A,b)}}function j(T,A){const S=[a(),a(),a(),a()];U(S[0],P),U(S[1],H),U(S[2],g),M(S[3],P,H),C(T,S,A)}function Me(T){if(T.length!==o.SEED_LENGTH)throw new Error(`ed25519: seed must be ${o.SEED_LENGTH} bytes`);const A=(0,t.hash)(T);A[0]&=248,A[31]&=127,A[31]|=64;const S=new Uint8Array(32),h=[a(),a(),a(),a()];j(h,A),et(S,h);const b=new Uint8Array(64);return b.set(T),b.set(S,32),{publicKey:S,secretKey:b}}o.generateKeyPairFromSeed=Me;function Te(T){const A=(0,i.randomBytes)(32,T),S=Me(A);return(0,n.wipe)(A),S}o.generateKeyPair=Te;function J(T){if(T.length!==o.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${o.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(T.subarray(32))}o.extractPublicKeyFromSecretKey=J;const V=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function k(T,A){let S,h,b,X;for(h=63;h>=32;--h){for(S=0,b=h-32,X=h-12;b<X;++b)A[b]+=S-16*A[h]*V[b-(h-32)],S=Math.floor((A[b]+128)/256),A[b]-=S*256;A[b]+=S,A[h]=0}for(S=0,b=0;b<32;b++)A[b]+=S-(A[31]>>4)*V[b],S=A[b]>>8,A[b]&=255;for(b=0;b<32;b++)A[b]-=S*V[b];for(h=0;h<32;h++)A[h+1]+=A[h]>>8,T[h]=A[h]&255}function B(T){const A=new Float64Array(64);for(let S=0;S<64;S++)A[S]=T[S];for(let S=0;S<64;S++)T[S]=0;k(T,A)}function ct(T,A){const S=new Float64Array(64),h=[a(),a(),a(),a()],b=(0,t.hash)(T.subarray(0,32));b[0]&=248,b[31]&=127,b[31]|=64;const X=new Uint8Array(64);X.set(b.subarray(32),32);const oe=new t.SHA512;oe.update(X.subarray(32)),oe.update(A);const ve=oe.digest();oe.clean(),B(ve),j(h,ve),et(X,h),oe.reset(),oe.update(X.subarray(0,32)),oe.update(T.subarray(32)),oe.update(A);const Re=oe.digest();B(Re);for(let Ne=0;Ne<32;Ne++)S[Ne]=ve[Ne];for(let Ne=0;Ne<32;Ne++)for(let Ie=0;Ie<32;Ie++)S[Ne+Ie]+=Re[Ne]*b[Ie];return k(X.subarray(32),S),X}o.sign=ct;function ke(T,A){const S=a(),h=a(),b=a(),X=a(),oe=a(),ve=a(),Re=a();return U(T[2],g),ue(T[1],A),W(b,T[1]),M(X,b,m),R(b,b,T[2]),he(X,T[2],X),W(oe,X),W(ve,oe),M(Re,ve,oe),M(S,Re,b),M(S,S,X),te(S,S),M(S,S,b),M(S,S,X),M(S,S,X),M(T[0],S,X),W(h,T[0]),M(h,h,X),de(h,b)&&M(T[0],T[0],N),W(h,T[0]),M(h,h,X),de(h,b)?-1:(pe(T[0])===A[31]>>7&&R(T[0],f,T[0]),M(T[3],T[0],T[1]),0)}function Nr(T,A,S){const h=new Uint8Array(32),b=[a(),a(),a(),a()],X=[a(),a(),a(),a()];if(S.length!==o.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${o.SIGNATURE_LENGTH} bytes`);if(ke(X,T))return!1;const oe=new t.SHA512;oe.update(S.subarray(0,32)),oe.update(T),oe.update(A);const ve=oe.digest();return B(ve),C(b,X,ve),j(X,S.subarray(32)),Ee(b,X),et(h,b),!be(S,h)}o.verify=Nr;function me(T){let A=[a(),a(),a(),a()];if(ke(A,T))throw new Error("Ed25519: invalid public key");let S=a(),h=a(),b=A[1];he(S,g,b),R(h,g,b),ge(h,h),M(S,S,h);let X=new Uint8Array(32);return ae(X,S),X}o.convertPublicKeyToX25519=me;function It(T){const A=(0,t.hash)(T.subarray(0,32));A[0]&=248,A[31]&=127,A[31]|=64;const S=new Uint8Array(A.subarray(0,32));return(0,n.wipe)(A),S}o.convertSecretKeyToX25519=It})(Sc);const Em="EdDSA",xm="JWT",Yl=".",Ql="base64url",Im="utf8",Sm="utf8",Pm=":",Om="did",Cm="key",Jh="base58btc",Am="z",Tm="K36",Rm=32;function na(o){return ca(vc(mc(o),Im),Ql)}function Zl(o){const i=vc(Tm,Jh),t=Am+ca(Xv([i,o]),Jh);return[Om,Cm,t].join(Pm)}function $m(o){return ca(o,Ql)}function Nm(o){return vc([na(o.header),na(o.payload)].join(Yl),Sm)}function Fm(o){return[na(o.header),na(o.payload),$m(o.signature)].join(Yl)}function Yh(o=$l.randomBytes(Rm)){return Sc.generateKeyPairFromSeed(o)}async function Dm(o,i,t,n,a=re.fromMiliseconds(Date.now())){const u={alg:Em,typ:xm},f=Zl(n.publicKey),g=a+t,m={iss:f,sub:o,aud:i,iat:a,exp:g},v=Nm({header:u,payload:m}),P=Sc.sign(n.secretKey,v);return Fm({header:u,payload:m,signature:P})}const jm=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),Lm=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Qh=o=>o.split("?")[0],Zh=10,qm=jm();class Mm{constructor(i){if(this.url=i,this.events=new kr.EventEmitter,this.registering=!1,!Fh(i))throw new Error(`Provided URL is not compatible with WebSocket connection: ${i}`);this.url=i}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(i,t){this.events.on(i,t)}once(i,t){this.events.once(i,t)}off(i,t){this.events.off(i,t)}removeListener(i,t){this.events.removeListener(i,t)}async open(i=this.url){await this.register(i)}async close(){return new Promise((i,t)=>{if(typeof this.socket>"u"){t(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),i()},this.socket.close()})}async send(i,t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(mc(i))}catch(n){this.onError(i.id,n)}}register(i=this.url){if(!Fh(i))throw new Error(`Provided URL is not compatible with WebSocket connection: ${i}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((n,a)=>{this.events.once("register_error",u=>{this.resetMaxListeners(),a(u)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return a(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=i,this.registering=!0,new Promise((t,n)=>{const a=q1.isReactNative()?void 0:{rejectUnauthorized:!M1(i)},u=new qm(i,[],a);Lm()?u.onerror=f=>{const g=f;n(this.emitError(g.error))}:u.on("error",f=>{n(this.emitError(f))}),u.onopen=()=>{this.onOpen(u),t(u)}})}onOpen(i){i.onmessage=t=>this.onPayload(t),i.onclose=t=>this.onClose(t),this.socket=i,this.registering=!1,this.events.emit("open")}onClose(i){this.socket=void 0,this.registering=!1,this.events.emit("close",i)}onPayload(i){if(typeof i.data>"u")return;const t=typeof i.data=="string"?Ml(i.data):i.data;this.events.emit("payload",t)}onError(i,t){const n=this.parseError(t),a=n.message||n.toString(),u=wc(i,a);this.events.emit("payload",u)}parseError(i,t=this.url){return z1(i,Qh(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Zh&&this.events.setMaxListeners(Zh)}emitError(i){const t=this.parseError(new Error((i==null?void 0:i.message)||`WebSocket connection failed for host: ${Qh(this.url)}`));return this.events.emit("register_error",t),t}}var sa={exports:{}};sa.exports;(function(o,i){var t=200,n="__lodash_hash_undefined__",a=1,u=2,f=9007199254740991,g="[object Arguments]",m="[object Array]",v="[object AsyncFunction]",P="[object Boolean]",H="[object Date]",N="[object Error]",U="[object Function]",z="[object GeneratorFunction]",K="[object Map]",ae="[object Number]",be="[object Null]",de="[object Object]",pe="[object Promise]",ue="[object Proxy]",he="[object RegExp]",R="[object Set]",M="[object String]",W="[object Symbol]",ge="[object Undefined]",te="[object WeakMap]",Ee="[object ArrayBuffer]",Ae="[object DataView]",et="[object Float32Array]",C="[object Float64Array]",j="[object Int8Array]",Me="[object Int16Array]",Te="[object Int32Array]",J="[object Uint8Array]",V="[object Uint8ClampedArray]",k="[object Uint16Array]",B="[object Uint32Array]",ct=/[\\^$.*+?()[\]{}|]/g,ke=/^\[object .+?Constructor\]$/,Nr=/^(?:0|[1-9]\d*)$/,me={};me[et]=me[C]=me[j]=me[Me]=me[Te]=me[J]=me[V]=me[k]=me[B]=!0,me[g]=me[m]=me[Ee]=me[P]=me[Ae]=me[H]=me[N]=me[U]=me[K]=me[ae]=me[de]=me[he]=me[R]=me[M]=me[te]=!1;var It=typeof Di=="object"&&Di&&Di.Object===Object&&Di,T=typeof self=="object"&&self&&self.Object===Object&&self,A=It||T||Function("return this")(),S=i&&!i.nodeType&&i,h=S&&!0&&o&&!o.nodeType&&o,b=h&&h.exports===S,X=b&&It.process,oe=function(){try{return X&&X.binding&&X.binding("util")}catch{}}(),ve=oe&&oe.isTypedArray;function Re(y,E){for(var L=-1,Y=y==null?0:y.length,Ve=0,le=[];++L<Y;){var Ze=y[L];E(Ze,L,y)&&(le[Ve++]=Ze)}return le}function Ne(y,E){for(var L=-1,Y=E.length,Ve=y.length;++L<Y;)y[Ve+L]=E[L];return y}function Ie(y,E){for(var L=-1,Y=y==null?0:y.length;++L<Y;)if(E(y[L],L,y))return!0;return!1}function St(y,E){for(var L=-1,Y=Array(y);++L<y;)Y[L]=E(L);return Y}function _t(y){return function(E){return y(E)}}function nt(y,E){return y.has(E)}function De(y,E){return y==null?void 0:y[E]}function Je(y){var E=-1,L=Array(y.size);return y.forEach(function(Y,Ve){L[++E]=[Ve,Y]}),L}function Ye(y,E){return function(L){return y(E(L))}}function st(y){var E=-1,L=Array(y.size);return y.forEach(function(Y){L[++E]=Y}),L}var ze=Array.prototype,Qe=Function.prototype,$e=Object.prototype,He=A["__core-js_shared__"],ut=Qe.toString,Le=$e.hasOwnProperty,Pt=function(){var y=/[^.]+$/.exec(He&&He.keys&&He.keys.IE_PROTO||"");return y?"Symbol(src)_1."+y:""}(),Dt=$e.toString,Ut=RegExp("^"+ut.call(Le).replace(ct,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),kt=b?A.Buffer:void 0,qt=A.Symbol,Gt=A.Uint8Array,tr=$e.propertyIsEnumerable,Fr=ze.splice,Wt=qt?qt.toStringTag:void 0,Hr=Object.getOwnPropertySymbols,ri=kt?kt.isBuffer:void 0,mi=Ye(Object.keys,Object),ht=cr(A,"DataView"),tt=cr(A,"Map"),lt=cr(A,"Promise"),ft=cr(A,"Set"),at=cr(A,"WeakMap"),rt=cr(Object,"create"),Ot=Vr(ht),Ct=Vr(tt),pt=Vr(lt),At=Vr(ft),dt=Vr(at),mt=qt?qt.prototype:void 0,gt=mt?mt.valueOf:void 0;function We(y){var E=-1,L=y==null?0:y.length;for(this.clear();++E<L;){var Y=y[E];this.set(Y[0],Y[1])}}function Tt(){this.__data__=rt?rt(null):{},this.size=0}function Rt(y){var E=this.has(y)&&delete this.__data__[y];return this.size-=E?1:0,E}function pa(y){var E=this.__data__;if(rt){var L=E[y];return L===n?void 0:L}return Le.call(E,y)?E[y]:void 0}function da(y){var E=this.__data__;return rt?E[y]!==void 0:Le.call(E,y)}function ga(y,E){var L=this.__data__;return this.size+=this.has(y)?0:1,L[y]=rt&&E===void 0?n:E,this}We.prototype.clear=Tt,We.prototype.delete=Rt,We.prototype.get=pa,We.prototype.has=da,We.prototype.set=ga;function dr(y){var E=-1,L=y==null?0:y.length;for(this.clear();++E<L;){var Y=y[E];this.set(Y[0],Y[1])}}function ya(){this.__data__=[],this.size=0}function va(y){var E=this.__data__,L=wi(E,y);if(L<0)return!1;var Y=E.length-1;return L==Y?E.pop():Fr.call(E,L,1),--this.size,!0}function _a(y){var E=this.__data__,L=wi(E,y);return L<0?void 0:E[L][1]}function ma(y){return wi(this.__data__,y)>-1}function wa(y,E){var L=this.__data__,Y=wi(L,y);return Y<0?(++this.size,L.push([y,E])):L[Y][1]=E,this}dr.prototype.clear=ya,dr.prototype.delete=va,dr.prototype.get=_a,dr.prototype.has=ma,dr.prototype.set=wa;function Kr(y){var E=-1,L=y==null?0:y.length;for(this.clear();++E<L;){var Y=y[E];this.set(Y[0],Y[1])}}function qi(){this.size=0,this.__data__={hash:new We,map:new(tt||dr),string:new We}}function ba(y){var E=ii(this,y).delete(y);return this.size-=E?1:0,E}function Mi(y){return ii(this,y).get(y)}function Ea(y){return ii(this,y).has(y)}function xa(y,E){var L=ii(this,y),Y=L.size;return L.set(y,E),this.size+=L.size==Y?0:1,this}Kr.prototype.clear=qi,Kr.prototype.delete=ba,Kr.prototype.get=Mi,Kr.prototype.has=Ea,Kr.prototype.set=xa;function zi(y){var E=-1,L=y==null?0:y.length;for(this.__data__=new Kr;++E<L;)this.add(y[E])}function Gn(y){return this.__data__.set(y,n),this}function Wn(y){return this.__data__.has(y)}zi.prototype.add=zi.prototype.push=Gn,zi.prototype.has=Wn;function Pr(y){var E=this.__data__=new dr(y);this.size=E.size}function Ia(){this.__data__=new dr,this.size=0}function Sa(y){var E=this.__data__,L=E.delete(y);return this.size=E.size,L}function Pa(y){return this.__data__.get(y)}function Oa(y){return this.__data__.has(y)}function Jn(y,E){var L=this.__data__;if(L instanceof dr){var Y=L.__data__;if(!tt||Y.length<t-1)return Y.push([y,E]),this.size=++L.size,this;L=this.__data__=new Kr(Y)}return L.set(y,E),this.size=L.size,this}Pr.prototype.clear=Ia,Pr.prototype.delete=Sa,Pr.prototype.get=Pa,Pr.prototype.has=Oa,Pr.prototype.set=Jn;function Yn(y,E){var L=Hi(y),Y=!L&&cs(y),Ve=!L&&!Y&&pn(y),le=!L&&!Y&&!Ve&&ls(y),Ze=L||Y||Ve||le,$t=Ze?St(y.length,String):[],Pe=$t.length;for(var Be in y)(E||Le.call(y,Be))&&!(Ze&&(Be=="length"||Ve&&(Be=="offset"||Be=="parent")||le&&(Be=="buffer"||Be=="byteLength"||Be=="byteOffset")||is(Be,Pe)))&&$t.push(Be);return $t}function wi(y,E){for(var L=y.length;L--;)if(os(y[L][0],E))return L;return-1}function ln(y,E,L){var Y=E(y);return Hi(y)?Y:Ne(Y,L(y))}function bi(y){return y==null?y===void 0?ge:be:Wt&&Wt in Object(y)?ts(y):Ta(y)}function fn(y){return xi(y)&&bi(y)==g}function Ei(y,E,L,Y,Ve){return y===E?!0:y==null||E==null||!xi(y)&&!xi(E)?y!==y&&E!==E:Qn(y,E,L,Y,Ei,Ve)}function Qn(y,E,L,Y,Ve,le){var Ze=Hi(y),$t=Hi(E),Pe=Ze?m:Dr(y),Be=$t?m:Dr(E);Pe=Pe==g?de:Pe,Be=Be==g?de:Be;var wt=Pe==de,rr=Be==de,Nt=Pe==Be;if(Nt&&pn(y)){if(!pn(E))return!1;Ze=!0,wt=!1}if(Nt&&!wt)return le||(le=new Pr),Ze||ls(y)?Ui(y,E,L,Y,Ve,le):Aa(y,E,Pe,L,Y,Ve,le);if(!(L&a)){var Xe=wt&&Le.call(y,"__wrapped__"),Jt=rr&&Le.call(E,"__wrapped__");if(Xe||Jt){var Or=Xe?y.value():y,gr=Jt?E.value():E;return le||(le=new Pr),Ve(Or,gr,L,Y,le)}}return Nt?(le||(le=new Pr),es(y,E,L,Y,Ve,le)):!1}function Ca(y){if(!hs(y)||ss(y))return!1;var E=Ki(y)?Ut:ke;return E.test(Vr(y))}function Zn(y){return xi(y)&&us(y.length)&&!!me[bi(y)]}function Xn(y){if(!as(y))return mi(y);var E=[];for(var L in Object(y))Le.call(y,L)&&L!="constructor"&&E.push(L);return E}function Ui(y,E,L,Y,Ve,le){var Ze=L&a,$t=y.length,Pe=E.length;if($t!=Pe&&!(Ze&&Pe>$t))return!1;var Be=le.get(y);if(Be&&le.get(E))return Be==E;var wt=-1,rr=!0,Nt=L&u?new zi:void 0;for(le.set(y,E),le.set(E,y);++wt<$t;){var Xe=y[wt],Jt=E[wt];if(Y)var Or=Ze?Y(Jt,Xe,wt,E,y,le):Y(Xe,Jt,wt,y,E,le);if(Or!==void 0){if(Or)continue;rr=!1;break}if(Nt){if(!Ie(E,function(gr,jr){if(!nt(Nt,jr)&&(Xe===gr||Ve(Xe,gr,L,Y,le)))return Nt.push(jr)})){rr=!1;break}}else if(!(Xe===Jt||Ve(Xe,Jt,L,Y,le))){rr=!1;break}}return le.delete(y),le.delete(E),rr}function Aa(y,E,L,Y,Ve,le,Ze){switch(L){case Ae:if(y.byteLength!=E.byteLength||y.byteOffset!=E.byteOffset)return!1;y=y.buffer,E=E.buffer;case Ee:return!(y.byteLength!=E.byteLength||!le(new Gt(y),new Gt(E)));case P:case H:case ae:return os(+y,+E);case N:return y.name==E.name&&y.message==E.message;case he:case M:return y==E+"";case K:var $t=Je;case R:var Pe=Y&a;if($t||($t=st),y.size!=E.size&&!Pe)return!1;var Be=Ze.get(y);if(Be)return Be==E;Y|=u,Ze.set(y,E);var wt=Ui($t(y),$t(E),Y,Ve,le,Ze);return Ze.delete(y),wt;case W:if(gt)return gt.call(y)==gt.call(E)}return!1}function es(y,E,L,Y,Ve,le){var Ze=L&a,$t=ki(y),Pe=$t.length,Be=ki(E),wt=Be.length;if(Pe!=wt&&!Ze)return!1;for(var rr=Pe;rr--;){var Nt=$t[rr];if(!(Ze?Nt in E:Le.call(E,Nt)))return!1}var Xe=le.get(y);if(Xe&&le.get(E))return Xe==E;var Jt=!0;le.set(y,E),le.set(E,y);for(var Or=Ze;++rr<Pe;){Nt=$t[rr];var gr=y[Nt],jr=E[Nt];if(Y)var dn=Ze?Y(jr,gr,Nt,E,y,le):Y(gr,jr,Nt,y,E,le);if(!(dn===void 0?gr===jr||Ve(gr,jr,L,Y,le):dn)){Jt=!1;break}Or||(Or=Nt=="constructor")}if(Jt&&!Or){var Ii=y.constructor,Mt=E.constructor;Ii!=Mt&&"constructor"in y&&"constructor"in E&&!(typeof Ii=="function"&&Ii instanceof Ii&&typeof Mt=="function"&&Mt instanceof Mt)&&(Jt=!1)}return le.delete(y),le.delete(E),Jt}function ki(y){return ln(y,Na,rs)}function ii(y,E){var L=y.__data__;return ns(E)?L[typeof E=="string"?"string":"hash"]:L.map}function cr(y,E){var L=De(y,E);return Ca(L)?L:void 0}function ts(y){var E=Le.call(y,Wt),L=y[Wt];try{y[Wt]=void 0;var Y=!0}catch{}var Ve=Dt.call(y);return Y&&(E?y[Wt]=L:delete y[Wt]),Ve}var rs=Hr?function(y){return y==null?[]:(y=Object(y),Re(Hr(y),function(E){return tr.call(y,E)}))}:Ke,Dr=bi;(ht&&Dr(new ht(new ArrayBuffer(1)))!=Ae||tt&&Dr(new tt)!=K||lt&&Dr(lt.resolve())!=pe||ft&&Dr(new ft)!=R||at&&Dr(new at)!=te)&&(Dr=function(y){var E=bi(y),L=E==de?y.constructor:void 0,Y=L?Vr(L):"";if(Y)switch(Y){case Ot:return Ae;case Ct:return K;case pt:return pe;case At:return R;case dt:return te}return E});function is(y,E){return E=E??f,!!E&&(typeof y=="number"||Nr.test(y))&&y>-1&&y%1==0&&y<E}function ns(y){var E=typeof y;return E=="string"||E=="number"||E=="symbol"||E=="boolean"?y!=="__proto__":y===null}function ss(y){return!!Pt&&Pt in y}function as(y){var E=y&&y.constructor,L=typeof E=="function"&&E.prototype||$e;return y===L}function Ta(y){return Dt.call(y)}function Vr(y){if(y!=null){try{return ut.call(y)}catch{}try{return y+""}catch{}}return""}function os(y,E){return y===E||y!==y&&E!==E}var cs=fn(function(){return arguments}())?fn:function(y){return xi(y)&&Le.call(y,"callee")&&!tr.call(y,"callee")},Hi=Array.isArray;function Ra(y){return y!=null&&us(y.length)&&!Ki(y)}var pn=ri||Ue;function $a(y,E){return Ei(y,E)}function Ki(y){if(!hs(y))return!1;var E=bi(y);return E==U||E==z||E==v||E==ue}function us(y){return typeof y=="number"&&y>-1&&y%1==0&&y<=f}function hs(y){var E=typeof y;return y!=null&&(E=="object"||E=="function")}function xi(y){return y!=null&&typeof y=="object"}var ls=ve?_t(ve):Zn;function Na(y){return Ra(y)?Yn(y):Xn(y)}function Ke(){return[]}function Ue(){return!1}o.exports=$a})(sa,sa.exports);var zm=sa.exports;const Um=e1(zm);function km(o,i){if(o.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var a=0;a<o.length;a++){var u=o.charAt(a),f=u.charCodeAt(0);if(t[f]!==255)throw new TypeError(u+" is ambiguous");t[f]=a}var g=o.length,m=o.charAt(0),v=Math.log(g)/Math.log(256),P=Math.log(256)/Math.log(g);function H(z){if(z instanceof Uint8Array||(ArrayBuffer.isView(z)?z=new Uint8Array(z.buffer,z.byteOffset,z.byteLength):Array.isArray(z)&&(z=Uint8Array.from(z))),!(z instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(z.length===0)return"";for(var K=0,ae=0,be=0,de=z.length;be!==de&&z[be]===0;)be++,K++;for(var pe=(de-be)*P+1>>>0,ue=new Uint8Array(pe);be!==de;){for(var he=z[be],R=0,M=pe-1;(he!==0||R<ae)&&M!==-1;M--,R++)he+=256*ue[M]>>>0,ue[M]=he%g>>>0,he=he/g>>>0;if(he!==0)throw new Error("Non-zero carry");ae=R,be++}for(var W=pe-ae;W!==pe&&ue[W]===0;)W++;for(var ge=m.repeat(K);W<pe;++W)ge+=o.charAt(ue[W]);return ge}function N(z){if(typeof z!="string")throw new TypeError("Expected String");if(z.length===0)return new Uint8Array;var K=0;if(z[K]!==" "){for(var ae=0,be=0;z[K]===m;)ae++,K++;for(var de=(z.length-K)*v+1>>>0,pe=new Uint8Array(de);z[K];){var ue=t[z.charCodeAt(K)];if(ue===255)return;for(var he=0,R=de-1;(ue!==0||he<be)&&R!==-1;R--,he++)ue+=g*pe[R]>>>0,pe[R]=ue%256>>>0,ue=ue/256>>>0;if(ue!==0)throw new Error("Non-zero carry");be=he,K++}if(z[K]!==" "){for(var M=de-be;M!==de&&pe[M]===0;)M++;for(var W=new Uint8Array(ae+(de-M)),ge=ae;M!==de;)W[ge++]=pe[M++];return W}}}function U(z){var K=N(z);if(K)return K;throw new Error(`Non-${i} character`)}return{encode:H,decodeUnsafe:N,decode:U}}var Hm=km,Km=Hm;const Xl=o=>{if(o instanceof Uint8Array&&o.constructor.name==="Uint8Array")return o;if(o instanceof ArrayBuffer)return new Uint8Array(o);if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer,o.byteOffset,o.byteLength);throw new Error("Unknown type, must be binary type")},Vm=o=>new TextEncoder().encode(o),Bm=o=>new TextDecoder().decode(o);class Gm{constructor(i,t,n){this.name=i,this.prefix=t,this.baseEncode=n}encode(i){if(i instanceof Uint8Array)return`${this.prefix}${this.baseEncode(i)}`;throw Error("Unknown type, must be binary type")}}class Wm{constructor(i,t,n){if(this.name=i,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(i){if(typeof i=="string"){if(i.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(i)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(i.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(i){return ef(this,i)}}class Jm{constructor(i){this.decoders=i}or(i){return ef(this,i)}decode(i){const t=i[0],n=this.decoders[t];if(n)return n.decode(i);throw RangeError(`Unable to decode multibase string ${JSON.stringify(i)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ef=(o,i)=>new Jm({...o.decoders||{[o.prefix]:o},...i.decoders||{[i.prefix]:i}});class Ym{constructor(i,t,n,a){this.name=i,this.prefix=t,this.baseEncode=n,this.baseDecode=a,this.encoder=new Gm(i,t,n),this.decoder=new Wm(i,t,a)}encode(i){return this.encoder.encode(i)}decode(i){return this.decoder.decode(i)}}const la=({name:o,prefix:i,encode:t,decode:n})=>new Ym(o,i,t,n),Bn=({prefix:o,name:i,alphabet:t})=>{const{encode:n,decode:a}=Km(t,i);return la({prefix:o,name:i,encode:n,decode:u=>Xl(a(u))})},Qm=(o,i,t,n)=>{const a={};for(let P=0;P<i.length;++P)a[i[P]]=P;let u=o.length;for(;o[u-1]==="=";)--u;const f=new Uint8Array(u*t/8|0);let g=0,m=0,v=0;for(let P=0;P<u;++P){const H=a[o[P]];if(H===void 0)throw new SyntaxError(`Non-${n} character`);m=m<<t|H,g+=t,g>=8&&(g-=8,f[v++]=255&m>>g)}if(g>=t||255&m<<8-g)throw new SyntaxError("Unexpected end of data");return f},Zm=(o,i,t)=>{const n=i[i.length-1]==="=",a=(1<<t)-1;let u="",f=0,g=0;for(let m=0;m<o.length;++m)for(g=g<<8|o[m],f+=8;f>t;)f-=t,u+=i[a&g>>f];if(f&&(u+=i[a&g<<t-f]),n)for(;u.length*t&7;)u+="=";return u},Kt=({name:o,prefix:i,bitsPerChar:t,alphabet:n})=>la({prefix:i,name:o,encode(a){return Zm(a,n,t)},decode(a){return Qm(a,n,t,o)}}),Xm=la({prefix:"\0",name:"identity",encode:o=>Bm(o),decode:o=>Vm(o)});var ew=Object.freeze({__proto__:null,identity:Xm});const tw=Kt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var rw=Object.freeze({__proto__:null,base2:tw});const iw=Kt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var nw=Object.freeze({__proto__:null,base8:iw});const sw=Bn({prefix:"9",name:"base10",alphabet:"0123456789"});var aw=Object.freeze({__proto__:null,base10:sw});const ow=Kt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),cw=Kt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var uw=Object.freeze({__proto__:null,base16:ow,base16upper:cw});const hw=Kt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),lw=Kt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),fw=Kt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),pw=Kt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),dw=Kt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),gw=Kt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),yw=Kt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),vw=Kt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),_w=Kt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var mw=Object.freeze({__proto__:null,base32:hw,base32upper:lw,base32pad:fw,base32padupper:pw,base32hex:dw,base32hexupper:gw,base32hexpad:yw,base32hexpadupper:vw,base32z:_w});const ww=Bn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),bw=Bn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Ew=Object.freeze({__proto__:null,base36:ww,base36upper:bw});const xw=Bn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Iw=Bn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Sw=Object.freeze({__proto__:null,base58btc:xw,base58flickr:Iw});const Pw=Kt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ow=Kt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Cw=Kt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Aw=Kt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Tw=Object.freeze({__proto__:null,base64:Pw,base64pad:Ow,base64url:Cw,base64urlpad:Aw});const tf=Array.from(""),Rw=tf.reduce((o,i,t)=>(o[t]=i,o),[]),$w=tf.reduce((o,i,t)=>(o[i.codePointAt(0)]=t,o),[]);function Nw(o){return o.reduce((i,t)=>(i+=Rw[t],i),"")}function Fw(o){const i=[];for(const t of o){const n=$w[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);i.push(n)}return new Uint8Array(i)}const Dw=la({prefix:"",name:"base256emoji",encode:Nw,decode:Fw});var jw=Object.freeze({__proto__:null,base256emoji:Dw}),Lw=rf,Xh=128,qw=127,Mw=~qw,zw=Math.pow(2,31);function rf(o,i,t){i=i||[],t=t||0;for(var n=t;o>=zw;)i[t++]=o&255|Xh,o/=128;for(;o&Mw;)i[t++]=o&255|Xh,o>>>=7;return i[t]=o|0,rf.bytes=t-n+1,i}var Uw=lc,kw=128,el=127;function lc(o,n){var t=0,n=n||0,a=0,u=n,f,g=o.length;do{if(u>=g)throw lc.bytes=0,new RangeError("Could not decode varint");f=o[u++],t+=a<28?(f&el)<<a:(f&el)*Math.pow(2,a),a+=7}while(f>=kw);return lc.bytes=u-n,t}var Hw=Math.pow(2,7),Kw=Math.pow(2,14),Vw=Math.pow(2,21),Bw=Math.pow(2,28),Gw=Math.pow(2,35),Ww=Math.pow(2,42),Jw=Math.pow(2,49),Yw=Math.pow(2,56),Qw=Math.pow(2,63),Zw=function(o){return o<Hw?1:o<Kw?2:o<Vw?3:o<Bw?4:o<Gw?5:o<Ww?6:o<Jw?7:o<Yw?8:o<Qw?9:10},Xw={encode:Lw,decode:Uw,encodingLength:Zw},nf=Xw;const tl=(o,i,t=0)=>(nf.encode(o,i,t),i),rl=o=>nf.encodingLength(o),fc=(o,i)=>{const t=i.byteLength,n=rl(o),a=n+rl(t),u=new Uint8Array(a+t);return tl(o,u,0),tl(t,u,n),u.set(i,a),new eb(o,t,i,u)};class eb{constructor(i,t,n,a){this.code=i,this.size=t,this.digest=n,this.bytes=a}}const sf=({name:o,code:i,encode:t})=>new tb(o,i,t);class tb{constructor(i,t,n){this.name=i,this.code=t,this.encode=n}digest(i){if(i instanceof Uint8Array){const t=this.encode(i);return t instanceof Uint8Array?fc(this.code,t):t.then(n=>fc(this.code,n))}else throw Error("Unknown type, must be binary type")}}const af=o=>async i=>new Uint8Array(await crypto.subtle.digest(o,i)),rb=sf({name:"sha2-256",code:18,encode:af("SHA-256")}),ib=sf({name:"sha2-512",code:19,encode:af("SHA-512")});var nb=Object.freeze({__proto__:null,sha256:rb,sha512:ib});const of=0,sb="identity",cf=Xl,ab=o=>fc(of,cf(o)),ob={code:of,name:sb,encode:cf,digest:ab};var cb=Object.freeze({__proto__:null,identity:ob});new TextEncoder,new TextDecoder;const il={...ew,...rw,...nw,...aw,...uw,...mw,...Ew,...Sw,...Tw,...jw};({...nb,...cb});function uf(o){return globalThis.Buffer!=null?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):o}function ub(o=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?uf(globalThis.Buffer.allocUnsafe(o)):new Uint8Array(o)}function hf(o,i,t,n){return{name:o,prefix:i,encoder:{name:o,prefix:i,encode:t},decoder:{decode:n}}}const nl=hf("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),Vo=hf("ascii","a",o=>{let i="a";for(let t=0;t<o.length;t++)i+=String.fromCharCode(o[t]);return i},o=>{o=o.substring(1);const i=ub(o.length);for(let t=0;t<o.length;t++)i[t]=o.charCodeAt(t);return i}),hb={utf8:nl,"utf-8":nl,hex:il.base16,latin1:Vo,ascii:Vo,binary:Vo,...il};function lb(o,i="utf8"){const t=hb[i];if(!t)throw new Error(`Unsupported encoding "${i}"`);return(i==="utf8"||i==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?uf(globalThis.Buffer.from(o,"utf-8")):t.decoder.decode(`${t.prefix}${o}`)}const lf="wc",fb=2,Pc="core",yi=`${lf}@2:${Pc}:`,pb={name:Pc,logger:"error"},db={database:":memory:"},gb="crypto",sl="client_ed25519_seed",yb=re.ONE_DAY,vb="keychain",_b="0.3",mb="messages",wb="0.3",bb=re.SIX_HOURS,Eb="publisher",ff="irn",xb="error",pf="wss://relay.walletconnect.com",al="wss://relay.walletconnect.org",Ib="relayer",vt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Sb="_subscription",Dn={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Pb=re.ONE_SECOND/2,Ob="2.9.2",Cb=1e4,Ab="0.3",Tb="WALLETCONNECT_CLIENT_ID",Ur={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Rb="subscription",$b="0.3",Nb=re.FIVE_SECONDS*1e3,Fb="pairing",Db="0.3",jn={wc_pairingDelete:{req:{ttl:re.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:re.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:re.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:re.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:re.ONE_DAY,prompt:!1,tag:0},res:{ttl:re.ONE_DAY,prompt:!1,tag:0}}},zr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},jb="history",Lb="0.3",qb="expirer",Ir={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Mb="0.3",Bo="verify-api",ol="https://verify.walletconnect.com";class zb{constructor(i,t){this.core=i,this.logger=t,this.keychain=new Map,this.name=vb,this.version=_b,this.initialized=!1,this.storagePrefix=yi,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,a)=>{this.isInitialized(),this.keychain.set(n,a),await this.persist()},this.get=n=>{this.isInitialized();const a=this.keychain.get(n);if(typeof a>"u"){const{message:u}=Z("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(u)}return a},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=i,this.logger=Ce.generateChildLogger(t,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(i){await this.core.storage.setItem(this.storageKey,jl(i))}async getKeyChain(){const i=await this.core.storage.getItem(this.storageKey);return typeof i<"u"?Ll(i):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}}class Ub{constructor(i,t,n){this.core=i,this.logger=t,this.name=gb,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),u=Yh(a);return Zl(u.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=i1();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const u=await this.getClientSeed(),f=Yh(u),g=ec();return await Dm(g,a,yb,f)},this.generateSharedKey=(a,u,f)=>{this.isInitialized();const g=this.getPrivateKey(a),m=n1(g,u);return this.setSymKey(m,f)},this.setSymKey=async(a,u)=>{this.isInitialized();const f=u||s1(a);return await this.keychain.set(f,a),f},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,u,f)=>{this.isInitialized();const g=a1(f),m=mc(u);if(Th(g)){const N=g.senderPublicKey,U=g.receiverPublicKey;a=await this.generateSharedKey(N,U)}const v=this.getSymKey(a),{type:P,senderPublicKey:H}=g;return o1({type:P,symKey:v,message:m,senderPublicKey:H})},this.decode=async(a,u,f)=>{this.isInitialized();const g=c1(u,f);if(Th(g)){const m=g.receiverPublicKey,v=g.senderPublicKey;a=await this.generateSharedKey(m,v)}try{const m=this.getSymKey(a),v=u1({symKey:m,encoded:u});return Ml(v)}catch(m){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(m)}},this.getPayloadType=a=>{const u=Rh(a);return h1(u.type)},this.getPayloadSenderPublicKey=a=>{const u=Rh(a);return u.senderPublicKey?ca(u.senderPublicKey,l1):void 0},this.core=i,this.logger=Ce.generateChildLogger(t,this.name),this.keychain=n||new zb(this.core,this.logger)}get context(){return Ce.getLoggerContext(this.logger)}async setPrivateKey(i,t){return await this.keychain.set(i,t),i}getPrivateKey(i){return this.keychain.get(i)}async getClientSeed(){let i="";try{i=this.keychain.get(sl)}catch{i=ec(),await this.keychain.set(sl,i)}return lb(i,"base16")}getSymKey(i){return this.keychain.get(i)}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}}class kb extends pm{constructor(i,t){super(i,t),this.logger=i,this.core=t,this.messages=new Map,this.name=mb,this.version=wb,this.initialized=!1,this.storagePrefix=yi,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,a)=>{this.isInitialized();const u=cn(a);let f=this.messages.get(n);return typeof f>"u"&&(f={}),typeof f[u]<"u"||(f[u]=a,this.messages.set(n,f),await this.persist()),u},this.get=n=>{this.isInitialized();let a=this.messages.get(n);return typeof a>"u"&&(a={}),a},this.has=(n,a)=>{this.isInitialized();const u=this.get(n),f=cn(a);return typeof u[f]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=Ce.generateChildLogger(i,this.name),this.core=t}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(i){await this.core.storage.setItem(this.storageKey,jl(i))}async getRelayerMessages(){const i=await this.core.storage.getItem(this.storageKey);return typeof i<"u"?Ll(i):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}}class Hb extends dm{constructor(i,t){super(i,t),this.relayer=i,this.logger=t,this.events=new kr.EventEmitter,this.name=Eb,this.queue=new Map,this.publishTimeout=re.toMiliseconds(re.TEN_SECONDS),this.queueTimeout=re.toMiliseconds(re.FIVE_SECONDS),this.needsTransportRestart=!1,this.publish=async(n,a,u)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:a,opts:u}});try{const f=(u==null?void 0:u.ttl)||bb,g=tc(u),m=(u==null?void 0:u.prompt)||!1,v=(u==null?void 0:u.tag)||0,P=(u==null?void 0:u.id)||zl().toString(),H={topic:n,message:a,opts:{ttl:f,relay:g,prompt:m,tag:v,id:P}},N=setTimeout(()=>this.queue.set(P,H),this.queueTimeout);try{await await ia(this.rpcPublish(n,a,f,g,m,v,P),this.publishTimeout),clearTimeout(N),this.relayer.events.emit(vt.publish,H)}catch{this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0;return}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:a,opts:u}})}catch(f){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(f),f}},this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.relayer=i,this.logger=Ce.generateChildLogger(t,this.name),this.registerEventListeners()}get context(){return Ce.getLoggerContext(this.logger)}rpcPublish(i,t,n,a,u,f,g){var m,v,P,H;const N={method:ea(a.protocol).publish,params:{topic:i,message:t,ttl:n,prompt:u,tag:f},id:g};return gi((m=N.params)==null?void 0:m.prompt)&&((v=N.params)==null||delete v.prompt),gi((P=N.params)==null?void 0:P.tag)&&((H=N.params)==null||delete H.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:N}),this.relayer.request(N)}onPublish(i){this.queue.delete(i)}checkQueue(){this.queue.forEach(async i=>{const{topic:t,message:n,opts:a}=i;await this.publish(t,n,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(hn.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(vt.connection_stalled);return}this.checkQueue()}),this.relayer.on(vt.message_ack,i=>{this.onPublish(i.id.toString())})}}class Kb{constructor(){this.map=new Map,this.set=(i,t)=>{const n=this.get(i);this.exists(i,t)||this.map.set(i,[...n,t])},this.get=i=>this.map.get(i)||[],this.exists=(i,t)=>this.get(i).includes(t),this.delete=(i,t)=>{if(typeof t>"u"){this.map.delete(i);return}if(!this.map.has(i))return;const n=this.get(i);if(!this.exists(i,t))return;const a=n.filter(u=>u!==t);if(!a.length){this.map.delete(i);return}this.map.set(i,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Vb=Object.defineProperty,Bb=Object.defineProperties,Gb=Object.getOwnPropertyDescriptors,cl=Object.getOwnPropertySymbols,Wb=Object.prototype.hasOwnProperty,Jb=Object.prototype.propertyIsEnumerable,ul=(o,i,t)=>i in o?Vb(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,Ln=(o,i)=>{for(var t in i||(i={}))Wb.call(i,t)&&ul(o,t,i[t]);if(cl)for(var t of cl(i))Jb.call(i,t)&&ul(o,t,i[t]);return o},Go=(o,i)=>Bb(o,Gb(i));class Yb extends vm{constructor(i,t){super(i,t),this.relayer=i,this.logger=t,this.subscriptions=new Map,this.topicMap=new Kb,this.events=new kr.EventEmitter,this.name=Rb,this.version=$b,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=yi,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:a}});try{const u=tc(a),f={topic:n,relay:u};this.pending.set(n,f);const g=await this.rpcSubscribe(n,u);return this.onSubscribe(g,f),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:a}}),g}catch(u){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(u),u}},this.unsubscribe=async(n,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(n,a.id,a):await this.unsubscribeByTopic(n,a)},this.isSubscribed=async n=>this.topics.includes(n)?!0:await new Promise((a,u)=>{const f=new re.Watch;f.start(this.pendingSubscriptionWatchLabel);const g=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(g),f.stop(this.pendingSubscriptionWatchLabel),a(!0)),f.elapsed(this.pendingSubscriptionWatchLabel)>=Nb&&(clearInterval(g),f.stop(this.pendingSubscriptionWatchLabel),u(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=i,this.logger=Ce.generateChildLogger(t,this.name),this.clientId=""}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(i,t){let n=!1;try{n=this.getSubscription(i).topic===t}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(i,t){const n=this.topicMap.get(i);await Promise.all(n.map(async a=>await this.unsubscribeById(i,a,t)))}async unsubscribeById(i,t,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:i,id:t,opts:n}});try{const a=tc(n);await this.rpcUnsubscribe(i,t,a);const u=er("USER_DISCONNECTED",`${this.name}, ${i}`);await this.onUnsubscribe(i,t,u),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:i,id:t,opts:n}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(i,t){const n={method:ea(t.protocol).subscribe,params:{topic:i}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await ia(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(vt.connection_stalled)}return cn(i+this.clientId)}async rpcBatchSubscribe(i){if(!i.length)return;const t=i[0].relay,n={method:ea(t.protocol).batchSubscribe,params:{topics:i.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await ia(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(vt.connection_stalled)}}rpcUnsubscribe(i,t,n){const a={method:ea(n.protocol).unsubscribe,params:{topic:i,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(i,t){this.setSubscription(i,Go(Ln({},t),{id:i})),this.pending.delete(t.topic)}onBatchSubscribe(i){i.length&&i.forEach(t=>{this.setSubscription(t.id,Ln({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(i,t,n){this.events.removeAllListeners(t),this.hasSubscription(t,i)&&this.deleteSubscription(t,n),await this.relayer.messages.del(i)}async setRelayerSubscriptions(i){await this.relayer.core.storage.setItem(this.storageKey,i)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(i,t){this.subscriptions.has(i)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:i,subscription:t}),this.addSubscription(i,t))}addSubscription(i,t){this.subscriptions.set(i,Ln({},t)),this.topicMap.set(t.topic,i),this.events.emit(Ur.created,t)}getSubscription(i){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:i});const t=this.subscriptions.get(i);if(!t){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return t}deleteSubscription(i,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:i,reason:t});const n=this.getSubscription(i);this.subscriptions.delete(i),this.topicMap.delete(n.topic,i),this.events.emit(Ur.deleted,Go(Ln({},n),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Ur.sync)}async reset(){if(this.cached.length){const i=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let t=0;t<i;t++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(Ur.resubscribed)}async restore(){try{const i=await this.getRelayerSubscriptions();if(typeof i>"u"||!i.length)return;if(this.subscriptions.size){const{message:t}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=i,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(i){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(i)}}async batchSubscribe(i){if(!i.length)return;const t=await this.rpcBatchSubscribe(i);un(t)&&this.onBatchSubscribe(t.map((n,a)=>Go(Ln({},i[a]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(this.relayer.transportExplicitlyClosed)return;const i=[];this.pending.forEach(t=>{i.push(t)}),await this.batchSubscribe(i)}registerEventListeners(){this.relayer.core.heartbeat.on(hn.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(vt.connect,async()=>{await this.onConnect()}),this.relayer.on(vt.disconnect,()=>{this.onDisconnect()}),this.events.on(Ur.created,async i=>{const t=Ur.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:i}),await this.persist()}),this.events.on(Ur.deleted,async i=>{const t=Ur.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:i}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}async restartToComplete(){this.restartInProgress&&await new Promise(i=>{const t=setInterval(()=>{this.restartInProgress||(clearInterval(t),i())},this.pollingInterval)})}}var Qb=Object.defineProperty,hl=Object.getOwnPropertySymbols,Zb=Object.prototype.hasOwnProperty,Xb=Object.prototype.propertyIsEnumerable,ll=(o,i,t)=>i in o?Qb(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,eE=(o,i)=>{for(var t in i||(i={}))Zb.call(i,t)&&ll(o,t,i[t]);if(hl)for(var t of hl(i))Xb.call(i,t)&&ll(o,t,i[t]);return o};class tE extends gm{constructor(i){super(i),this.protocol="wc",this.version=2,this.events=new kr.EventEmitter,this.name=Ib,this.transportExplicitlyClosed=!1,this.initialized=!1,this.reconnecting=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.request=async t=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(t)}catch(n){throw this.logger.debug("Failed to Publish Request"),this.logger.error(n),n}},this.core=i.core,this.logger=typeof i.logger<"u"&&typeof i.logger!="string"?Ce.generateChildLogger(i.logger,this.name):Ce.pino(Ce.getDefaultLoggerOptions({level:i.logger||xb})),this.messages=new kb(this.logger,i.core),this.subscriber=new Yb(this,this.logger),this.publisher=new Hb(this,this.logger),this.relayUrl=(i==null?void 0:i.relayUrl)||pf,this.projectId=i.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${al}...`),await this.restartTransport(al)}this.registerEventListeners(),this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},Cb)}get context(){return Ce.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(i,t,n){this.isInitialized(),await this.publisher.publish(i,t,n),await this.recordMessageEvent({topic:i,message:t,publishedAt:Date.now()})}async subscribe(i,t){var n;this.isInitialized();let a=((n=this.subscriber.topicMap.get(i))==null?void 0:n[0])||"";return a||(await Promise.all([new Promise(u=>{this.subscriber.once(Ur.created,f=>{f.topic===i&&u()})}),new Promise(async u=>{a=await this.subscriber.subscribe(i,t),u()})]),a)}async unsubscribe(i,t){this.isInitialized(),await this.subscriber.unsubscribe(i,t)}on(i,t){this.events.on(i,t)}once(i,t){this.events.once(i,t)}off(i,t){this.events.off(i,t)}removeListener(i,t){this.events.removeListener(i,t)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(vt.transport_closed))}async transportOpen(i){if(this.transportExplicitlyClosed=!1,!this.reconnecting){this.relayUrl=i||this.relayUrl,this.reconnecting=!0;try{await Promise.all([new Promise(t=>{this.initialized||t(),this.subscriber.once(Ur.resubscribed,()=>{t()})}),await Promise.race([new Promise(async(t,n)=>{await ia(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(a=>n(a)).then(()=>t()).finally(()=>this.removeListener(vt.transport_closed,this.rejectTransportOpen))}),new Promise(t=>this.once(vt.transport_closed,this.rejectTransportOpen))])])}catch(t){this.logger.error(t);const n=t;if(!this.isConnectionStalled(n.message))throw t;this.events.emit(vt.transport_closed)}finally{this.reconnecting=!1}}}async restartTransport(i){this.transportExplicitlyClosed||this.reconnecting||(this.relayUrl=i||this.relayUrl,this.connected&&await Promise.all([new Promise(t=>{this.provider.once(Dn.disconnect,()=>{t()})}),this.transportClose()]),await this.createProvider(),await this.transportOpen())}isConnectionStalled(i){return this.staleConnectionErrors.some(t=>i.includes(t))}rejectTransportOpen(){throw new Error("Attempt to connect to relay via `transportOpen` has stalled. Retrying...")}async createProvider(){const i=await this.core.crypto.signJWT(this.relayUrl);this.provider=new vi(new Mm(f1({sdkVersion:Ob,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:i,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(i){const{topic:t,message:n}=i;await this.messages.set(t,n)}async shouldIgnoreMessageEvent(i){const{topic:t,message:n}=i;if(!n||n.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(t))return this.logger.debug(`Ignoring message for non-subscribed topic ${t}`),!0;const a=this.messages.has(t,n);return a&&this.logger.debug(`Ignoring duplicate message: ${n}`),a}async onProviderPayload(i){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:i}),bc(i)){if(!i.method.endsWith(Sb))return;const t=i.params,{topic:n,message:a,publishedAt:u}=t.data,f={topic:n,message:a,publishedAt:u};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(eE({type:"event",event:t.id},f)),this.events.emit(t.id,f),await this.acknowledgePayload(i),await this.onMessageEvent(f)}else Ec(i)&&this.events.emit(vt.message_ack,i)}async onMessageEvent(i){await this.shouldIgnoreMessageEvent(i)||(this.events.emit(vt.message,i),await this.recordMessageEvent(i))}async acknowledgePayload(i){const t=xc(i.id,!0);await this.provider.connection.send(t)}registerProviderListeners(){this.provider.on(Dn.payload,i=>this.onProviderPayload(i)),this.provider.on(Dn.connect,()=>{this.events.emit(vt.connect)}),this.provider.on(Dn.disconnect,()=>{this.onProviderDisconnect()}),this.provider.on(Dn.error,i=>{this.logger.error(i),this.events.emit(vt.error,i)})}registerEventListeners(){this.events.on(vt.connection_stalled,async()=>{await this.restartTransport()})}onProviderDisconnect(){this.events.emit(vt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.restartTransport()},re.toMiliseconds(Pb))}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}async toEstablishConnection(){if(!this.connected){if(this.connecting)return await new Promise(i=>{const t=setInterval(()=>{this.connected&&(clearInterval(t),i())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var rE=Object.defineProperty,fl=Object.getOwnPropertySymbols,iE=Object.prototype.hasOwnProperty,nE=Object.prototype.propertyIsEnumerable,pl=(o,i,t)=>i in o?rE(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,dl=(o,i)=>{for(var t in i||(i={}))iE.call(i,t)&&pl(o,t,i[t]);if(fl)for(var t of fl(i))nE.call(i,t)&&pl(o,t,i[t]);return o};class fa extends ym{constructor(i,t,n,a=yi,u=void 0){super(i,t,n,a),this.core=i,this.logger=t,this.name=n,this.map=new Map,this.version=Ab,this.cached=[],this.initialized=!1,this.storagePrefix=yi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(f=>{this.getKey&&f!==null&&!gi(f)?this.map.set(this.getKey(f),f):t1(f)?this.map.set(f.id,f):r1(f)&&this.map.set(f.topic,f)}),this.cached=[],this.initialized=!0)},this.set=async(f,g)=>{this.isInitialized(),this.map.has(f)?await this.update(f,g):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:f,value:g}),this.map.set(f,g),await this.persist())},this.get=f=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:f}),this.getData(f)),this.getAll=f=>(this.isInitialized(),f?this.values.filter(g=>Object.keys(f).every(m=>Um(g[m],f[m]))):this.values),this.update=async(f,g)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:f,update:g});const m=dl(dl({},this.getData(f)),g);this.map.set(f,m),await this.persist()},this.delete=async(f,g)=>{this.isInitialized(),this.map.has(f)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:f,reason:g}),this.map.delete(f),await this.persist())},this.logger=Ce.generateChildLogger(t,this.name),this.storagePrefix=a,this.getKey=u}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(i){await this.core.storage.setItem(this.storageKey,i)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(i){const t=this.map.get(i);if(!t){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${i}`);throw this.logger.error(n),new Error(n)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const i=await this.getDataStore();if(typeof i>"u"||!i.length)return;if(this.map.size){const{message:t}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=i,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(i){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(i)}}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}}class sE{constructor(i,t){this.core=i,this.logger=t,this.name=Fb,this.version=Db,this.events=new _c,this.initialized=!1,this.storagePrefix=yi,this.ignoredPayloadTypes=[Nl],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=ec(),a=await this.core.crypto.setSymKey(n),u=$r(re.FIVE_MINUTES),f={protocol:ff},g={topic:a,expiry:u,relay:f,active:!1},m=p1({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:n,relay:f});return await this.pairings.set(a,g),await this.core.relayer.subscribe(a),this.core.expirer.set(a,u),{topic:a,uri:m}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:a,symKey:u,relay:f}=d1(n.uri);if(this.pairings.keys.includes(a))throw new Error(`Pairing already exists: ${a}`);if(this.core.crypto.hasKeys(a))throw new Error(`Keychain already exists: ${a}`);const g=$r(re.FIVE_MINUTES),m={topic:a,relay:f,expiry:g,active:!1};return await this.pairings.set(a,m),await this.core.crypto.setSymKey(u,a),await this.core.relayer.subscribe(a,{relay:f}),this.core.expirer.set(a,g),n.activatePairing&&await this.activate({topic:a}),m},this.activate=async({topic:n})=>{this.isInitialized();const a=$r(re.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:a}),this.core.expirer.set(n,a)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:a}=n;if(this.pairings.keys.includes(a)){const u=await this.sendRequest(a,"wc_pairingPing",{}),{done:f,resolve:g,reject:m}=sn();this.events.once(Ft("pairing_ping",u),({error:v})=>{v?m(v):g()}),await f()}},this.updateExpiry=async({topic:n,expiry:a})=>{this.isInitialized(),await this.pairings.update(n,{expiry:a})},this.updateMetadata=async({topic:n,metadata:a})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:a}=n;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",er("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(n,a,u)=>{const f=Ic(a,u),g=await this.core.crypto.encode(n,f),m=jn[a].req;return this.core.history.set(n,f),this.core.relayer.publish(n,g,m),f.id},this.sendResult=async(n,a,u)=>{const f=xc(n,u),g=await this.core.crypto.encode(a,f),m=await this.core.history.get(a,n),v=jn[m.request.method].res;await this.core.relayer.publish(a,g,v),await this.core.history.resolve(f)},this.sendError=async(n,a,u)=>{const f=wc(n,u),g=await this.core.crypto.encode(a,f),m=await this.core.history.get(a,n),v=jn[m.request.method]?jn[m.request.method].res:jn.unregistered_method.res;await this.core.relayer.publish(a,g,v),await this.core.history.resolve(f)},this.deletePairing=async(n,a)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,er("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),a?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(a=>di(a.expiry));await Promise.all(n.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=n=>{const{topic:a,payload:u}=n;switch(u.method){case"wc_pairingPing":return this.onPairingPingRequest(a,u);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,u);default:return this.onUnknownRpcMethodRequest(a,u)}},this.onRelayEventResponse=async n=>{const{topic:a,payload:u}=n,f=(await this.core.history.get(a,u.id)).request.method;switch(f){case"wc_pairingPing":return this.onPairingPingResponse(a,u);default:return this.onUnknownRpcMethodResponse(f)}},this.onPairingPingRequest=async(n,a)=>{const{id:u}=a;try{this.isValidPing({topic:n}),await this.sendResult(u,n,!0),this.events.emit("pairing_ping",{id:u,topic:n})}catch(f){await this.sendError(u,n,f),this.logger.error(f)}},this.onPairingPingResponse=(n,a)=>{const{id:u}=a;setTimeout(()=>{pi(a)?this.events.emit(Ft("pairing_ping",u),{}):ti(a)&&this.events.emit(Ft("pairing_ping",u),{error:a.error})},500)},this.onPairingDeleteRequest=async(n,a)=>{const{id:u}=a;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit("pairing_delete",{id:u,topic:n})}catch(f){await this.sendError(u,n,f),this.logger.error(f)}},this.onUnknownRpcMethodRequest=async(n,a)=>{const{id:u,method:f}=a;try{if(this.registeredMethods.includes(f))return;const g=er("WC_METHOD_UNSUPPORTED",f);await this.sendError(u,n,g),this.logger.error(g)}catch(g){await this.sendError(u,n,g),this.logger.error(g)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(er("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{if(!or(n)){const{message:a}=Z("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(a)}if(!g1(n.uri)){const{message:a}=Z("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(a)}},this.isValidPing=async n=>{if(!or(n)){const{message:u}=Z("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(u)}const{topic:a}=n;await this.isValidPairingTopic(a)},this.isValidDisconnect=async n=>{if(!or(n)){const{message:u}=Z("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(u)}const{topic:a}=n;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async n=>{if(!an(n,!1)){const{message:a}=Z("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(a)}if(!this.pairings.keys.includes(n)){const{message:a}=Z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(a)}if(di(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:a}=Z("EXPIRED",`pairing topic: ${n}`);throw new Error(a)}},this.core=i,this.logger=Ce.generateChildLogger(t,this.name),this.pairings=new fa(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ce.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}registerRelayerEvents(){this.core.relayer.on(vt.message,async i=>{const{topic:t,message:n}=i;if(!this.pairings.keys.includes(t)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const a=await this.core.crypto.decode(t,n);try{bc(a)?(this.core.history.set(t,a),this.onRelayEventRequest({topic:t,payload:a})):Ec(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:t,payload:a}),this.core.history.delete(t,a.id))}catch(u){this.logger.error(u)}})}registerExpirerEvents(){this.core.expirer.on(Ir.expired,async i=>{const{topic:t}=Fl(i.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit("pairing_expire",{topic:t}))})}}class aE extends fm{constructor(i,t){super(i,t),this.core=i,this.logger=t,this.records=new Map,this.events=new kr.EventEmitter,this.name=jb,this.version=Lb,this.cached=[],this.initialized=!1,this.storagePrefix=yi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,a,u)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:a,chainId:u}),this.records.has(a.id))return;const f={id:a.id,topic:n,request:{method:a.method,params:a.params||null},chainId:u,expiry:$r(re.THIRTY_DAYS)};this.records.set(f.id,f),this.events.emit(zr.created,f)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const a=await this.getRecord(n.id);typeof a.response>"u"&&(a.response=ti(n)?{error:n.error}:{result:n.result},this.records.set(a.id,a),this.events.emit(zr.updated,a))},this.get=async(n,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:a}),await this.getRecord(a)),this.delete=(n,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(u=>{if(u.topic===n){if(typeof a<"u"&&u.id!==a)return;this.records.delete(u.id),this.events.emit(zr.deleted,u)}})},this.exists=async(n,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===n:!1),this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.logger=Ce.generateChildLogger(t,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const i=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const n={topic:t.topic,request:Ic(t.request.method,t.request.params,t.id),chainId:t.chainId};return i.push(n)}),i}async setJsonRpcRecords(i){await this.core.storage.setItem(this.storageKey,i)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(i){this.isInitialized();const t=this.records.get(i);if(!t){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(zr.sync)}async restore(){try{const i=await this.getJsonRpcRecords();if(typeof i>"u"||!i.length)return;if(this.records.size){const{message:t}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=i,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}}registerEventListeners(){this.events.on(zr.created,i=>{const t=zr.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:i}),this.persist()}),this.events.on(zr.updated,i=>{const t=zr.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:i}),this.persist()}),this.events.on(zr.deleted,i=>{const t=zr.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:i}),this.persist()}),this.core.heartbeat.on(hn.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(i=>{re.toMiliseconds(i.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${i.id}`),this.delete(i.topic,i.id))})}catch(i){this.logger.warn(i)}}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}}class oE extends _m{constructor(i,t){super(i,t),this.core=i,this.logger=t,this.expirations=new Map,this.events=new kr.EventEmitter,this.name=qb,this.version=Mb,this.cached=[],this.initialized=!1,this.storagePrefix=yi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const a=this.formatTarget(n);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(n,a)=>{this.isInitialized();const u=this.formatTarget(n),f={target:u,expiry:a};this.expirations.set(u,f),this.checkExpiry(u,f),this.events.emit(Ir.created,{target:u,expiration:f})},this.get=n=>{this.isInitialized();const a=this.formatTarget(n);return this.getExpiration(a)},this.del=n=>{if(this.isInitialized(),this.has(n)){const a=this.formatTarget(n),u=this.getExpiration(a);this.expirations.delete(a),this.events.emit(Ir.deleted,{target:a,expiration:u})}},this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.logger=Ce.generateChildLogger(t,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(i){if(typeof i=="string")return y1(i);if(typeof i=="number")return v1(i);const{message:t}=Z("UNKNOWN_TYPE",`Target type: ${typeof i}`);throw new Error(t)}async setExpirations(i){await this.core.storage.setItem(this.storageKey,i)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Ir.sync)}async restore(){try{const i=await this.getExpirations();if(typeof i>"u"||!i.length)return;if(this.expirations.size){const{message:t}=Z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=i,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(i){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(i)}}getExpiration(i){const t=this.expirations.get(i);if(!t){const{message:n}=Z("NO_MATCHING_KEY",`${this.name}: ${i}`);throw this.logger.error(n),new Error(n)}return t}checkExpiry(i,t){const{expiry:n}=t;re.toMiliseconds(n)-Date.now()<=0&&this.expire(i,t)}expire(i,t){this.expirations.delete(i),this.events.emit(Ir.expired,{target:i,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((i,t)=>this.checkExpiry(t,i))}registerEventListeners(){this.core.heartbeat.on(hn.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Ir.created,i=>{const t=Ir.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:i}),this.persist()}),this.events.on(Ir.expired,i=>{const t=Ir.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:i}),this.persist()}),this.events.on(Ir.deleted,i=>{const t=Ir.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:i}),this.persist()})}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}}class cE extends mm{constructor(i,t){super(i,t),this.projectId=i,this.logger=t,this.name=Bo,this.initialized=!1,this.init=async n=>{_1()||!Dl()||(this.verifyUrl=(n==null?void 0:n.verifyUrl)||ol,await this.createIframe())},this.register=async n=>{var a;if(this.initialized||await this.init(),!!this.iframe)try{(a=this.iframe.contentWindow)==null||a.postMessage(n.attestationId,this.verifyUrl),this.logger.info(`postMessage sent: ${n.attestationId} ${this.verifyUrl}`)}catch{}},this.resolve=async n=>{var a;if(this.isDevEnv)return"";this.logger.info(`resolving attestation: ${n.attestationId}`);const u=this.startAbortTimer(re.FIVE_SECONDS),f=await fetch(`${this.verifyUrl}/attestation/${n.attestationId}`,{signal:this.abortController.signal});return clearTimeout(u),f.status===200?(a=await f.json())==null?void 0:a.origin:""},this.createIframe=async()=>{try{await Promise.race([new Promise((n,a)=>{if(document.getElementById(Bo))return n();const u=document.createElement("iframe");u.setAttribute("id",Bo),u.setAttribute("src",`${this.verifyUrl}/${this.projectId}`),u.style.display="none",u.addEventListener("load",()=>{this.initialized=!0,n()}),u.addEventListener("error",f=>{a(f)}),document.body.append(u),this.iframe=u}),new Promise(n=>{setTimeout(()=>n("iframe load timeout"),re.toMiliseconds(re.ONE_SECOND/2))})])}catch(n){this.logger.error(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.error(n)}},this.logger=Ce.generateChildLogger(t,this.name),this.verifyUrl=ol,this.abortController=new AbortController,this.isDevEnv=m1()&&{}.IS_VITEST}get context(){return Ce.getLoggerContext(this.logger)}startAbortTimer(i){return setTimeout(()=>this.abortController.abort(),re.toMiliseconds(i))}}var uE=Object.defineProperty,gl=Object.getOwnPropertySymbols,hE=Object.prototype.hasOwnProperty,lE=Object.prototype.propertyIsEnumerable,yl=(o,i,t)=>i in o?uE(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,vl=(o,i)=>{for(var t in i||(i={}))hE.call(i,t)&&yl(o,t,i[t]);if(gl)for(var t of gl(i))lE.call(i,t)&&yl(o,t,i[t]);return o};class Oc extends lm{constructor(i){super(i),this.protocol=lf,this.version=fb,this.name=Pc,this.events=new kr.EventEmitter,this.initialized=!1,this.on=(n,a)=>this.events.on(n,a),this.once=(n,a)=>this.events.once(n,a),this.off=(n,a)=>this.events.off(n,a),this.removeListener=(n,a)=>this.events.removeListener(n,a),this.projectId=i==null?void 0:i.projectId,this.relayUrl=(i==null?void 0:i.relayUrl)||pf;const t=typeof(i==null?void 0:i.logger)<"u"&&typeof(i==null?void 0:i.logger)!="string"?i.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:(i==null?void 0:i.logger)||pb.logger}));this.logger=Ce.generateChildLogger(t,this.name),this.heartbeat=new hn.HeartBeat,this.crypto=new Ub(this,this.logger,i==null?void 0:i.keychain),this.history=new aE(this,this.logger),this.expirer=new oE(this,this.logger),this.storage=i!=null&&i.storage?i.storage:new g_(vl(vl({},db),i==null?void 0:i.storageOptions)),this.relayer=new tE({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new sE(this,this.logger),this.verify=new cE(this.projectId||"",this.logger)}static async init(i){const t=new Oc(i);await t.initialize();const n=await t.crypto.getClientId();return await t.storage.setItem(Tb,n),t}get context(){return Ce.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(i){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,i),this.logger.error(i.message),i}}}const fE=Oc,df="wc",gf=2,yf="client",Cc=`${df}@${gf}:${yf}:`,Wo={name:yf,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},_l="WALLETCONNECT_DEEPLINK_CHOICE",pE="proposal",vf="Proposal expired",dE="session",Qs=re.SEVEN_DAYS,gE="engine",qn={wc_sessionPropose:{req:{ttl:re.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:re.ONE_DAY,prompt:!1,tag:1104},res:{ttl:re.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:re.ONE_DAY,prompt:!1,tag:1106},res:{ttl:re.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:re.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:re.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:re.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:re.ONE_DAY,prompt:!1,tag:1112},res:{ttl:re.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:re.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:re.THIRTY_SECONDS,prompt:!1,tag:1115}}},Jo={min:re.FIVE_MINUTES,max:re.SEVEN_DAYS},Mn={idle:"idle",active:"active"},yE="request",vE=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var _E=Object.defineProperty,mE=Object.defineProperties,wE=Object.getOwnPropertyDescriptors,ml=Object.getOwnPropertySymbols,bE=Object.prototype.hasOwnProperty,EE=Object.prototype.propertyIsEnumerable,wl=(o,i,t)=>i in o?_E(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,xr=(o,i)=>{for(var t in i||(i={}))bE.call(i,t)&&wl(o,t,i[t]);if(ml)for(var t of ml(i))EE.call(i,t)&&wl(o,t,i[t]);return o},Yo=(o,i)=>mE(o,wE(i));class xE extends bm{constructor(i){super(i),this.name=gE,this.events=new _c,this.initialized=!1,this.ignoredPayloadTypes=[Nl],this.requestQueue={state:Mn.idle,requests:[]},this.requestQueueDelay=re.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(qn)}),this.initialized=!0,setTimeout(()=>{this.requestQueue.requests=this.getPendingSessionRequests(),this.processRequestQueue()},re.toMiliseconds(this.requestQueueDelay)))},this.connect=async t=>{this.isInitialized();const n=Yo(xr({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:a,requiredNamespaces:u,optionalNamespaces:f,sessionProperties:g,relays:m}=n;let v=a,P,H=!1;if(v&&(H=this.client.core.pairing.pairings.get(v).active),!v||!H){const{topic:pe,uri:ue}=await this.client.core.pairing.create();v=pe,P=ue}const N=await this.client.core.crypto.generateKeyPair(),U=xr({requiredNamespaces:u,optionalNamespaces:f,relays:m??[{protocol:ff}],proposer:{publicKey:N,metadata:this.client.metadata}},g&&{sessionProperties:g}),{reject:z,resolve:K,done:ae}=sn(re.FIVE_MINUTES,vf);if(this.events.once(Ft("session_connect"),async({error:pe,session:ue})=>{if(pe)z(pe);else if(ue){ue.self.publicKey=N;const he=Yo(xr({},ue),{requiredNamespaces:ue.requiredNamespaces,optionalNamespaces:ue.optionalNamespaces});await this.client.session.set(ue.topic,he),await this.setExpiry(ue.topic,ue.expiry),v&&await this.client.core.pairing.updateMetadata({topic:v,metadata:ue.peer.metadata}),K(he)}}),!v){const{message:pe}=Z("NO_MATCHING_KEY",`connect() pairing topic: ${v}`);throw new Error(pe)}const be=await this.sendRequest(v,"wc_sessionPropose",U),de=$r(re.FIVE_MINUTES);return await this.setProposal(be,xr({id:be,expiry:de},U)),{uri:P,approval:ae}},this.pair=async t=>(this.isInitialized(),await this.client.core.pairing.pair(t)),this.approve=async t=>{this.isInitialized(),await this.isValidApprove(t);const{id:n,relayProtocol:a,namespaces:u,sessionProperties:f}=t,g=this.client.proposal.get(n);let{pairingTopic:m,proposer:v,requiredNamespaces:P,optionalNamespaces:H}=g;m=m||"",ta(P)||(P=b1(u,"approve()"));const N=await this.client.core.crypto.generateKeyPair(),U=v.publicKey,z=await this.client.core.crypto.generateSharedKey(N,U);m&&n&&(await this.client.core.pairing.updateMetadata({topic:m,metadata:v.metadata}),await this.sendResult(n,m,{relay:{protocol:a??"irn"},responderPublicKey:N}),await this.client.proposal.delete(n,er("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:m}));const K=xr({relay:{protocol:a??"irn"},namespaces:u,requiredNamespaces:P,optionalNamespaces:H,pairingTopic:m,controller:{publicKey:N,metadata:this.client.metadata},expiry:$r(Qs)},f&&{sessionProperties:f});await this.client.core.relayer.subscribe(z),await this.sendRequest(z,"wc_sessionSettle",K);const ae=Yo(xr({},K),{topic:z,pairingTopic:m,acknowledged:!1,self:K.controller,peer:{publicKey:v.publicKey,metadata:v.metadata},controller:N});return await this.client.session.set(z,ae),await this.setExpiry(z,$r(Qs)),{topic:z,acknowledged:()=>new Promise(be=>setTimeout(()=>be(this.client.session.get(z)),500))}},this.reject=async t=>{this.isInitialized(),await this.isValidReject(t);const{id:n,reason:a}=t,{pairingTopic:u}=this.client.proposal.get(n);u&&(await this.sendError(n,u,a),await this.client.proposal.delete(n,er("USER_DISCONNECTED")))},this.update=async t=>{this.isInitialized(),await this.isValidUpdate(t);const{topic:n,namespaces:a}=t,u=await this.sendRequest(n,"wc_sessionUpdate",{namespaces:a}),{done:f,resolve:g,reject:m}=sn();return this.events.once(Ft("session_update",u),({error:v})=>{v?m(v):g()}),await this.client.session.update(n,{namespaces:a}),{acknowledged:f}},this.extend=async t=>{this.isInitialized(),await this.isValidExtend(t);const{topic:n}=t,a=await this.sendRequest(n,"wc_sessionExtend",{}),{done:u,resolve:f,reject:g}=sn();return this.events.once(Ft("session_extend",a),({error:m})=>{m?g(m):f()}),await this.setExpiry(n,$r(Qs)),{acknowledged:u}},this.request=async t=>{this.isInitialized(),await this.isValidRequest(t);const{chainId:n,request:a,topic:u,expiry:f}=t,g=await this.sendRequest(u,"wc_sessionRequest",{request:a,chainId:n},f),{done:m,resolve:v,reject:P}=sn(f);this.events.once(Ft("session_request",g),({error:N,result:U})=>{N?P(N):v(U)}),this.client.events.emit("session_request_sent",{topic:u,request:a,chainId:n,id:g});const H=await this.client.core.storage.getItem(_l);return E1({id:g,topic:u,wcDeepLink:H}),await m()},this.respond=async t=>{this.isInitialized(),await this.isValidRespond(t);const{topic:n,response:a}=t,{id:u}=a;pi(a)?await this.sendResult(u,n,a.result):ti(a)&&await this.sendError(u,n,a.error),this.cleanupAfterResponse(t)},this.ping=async t=>{this.isInitialized(),await this.isValidPing(t);const{topic:n}=t;if(this.client.session.keys.includes(n)){const a=await this.sendRequest(n,"wc_sessionPing",{}),{done:u,resolve:f,reject:g}=sn();this.events.once(Ft("session_ping",a),({error:m})=>{m?g(m):f()}),await u()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async t=>{this.isInitialized(),await this.isValidEmit(t);const{topic:n,event:a,chainId:u}=t;await this.sendRequest(n,"wc_sessionEvent",{event:a,chainId:u})},this.disconnect=async t=>{this.isInitialized(),await this.isValidDisconnect(t);const{topic:n}=t;if(this.client.session.keys.includes(n)){const a=zl().toString();let u;const f=g=>{(g==null?void 0:g.id.toString())===a&&(this.client.core.relayer.events.removeListener(vt.message_ack,f),u())};await Promise.all([new Promise(g=>{u=g,this.client.core.relayer.on(vt.message_ack,f)}),this.sendRequest(n,"wc_sessionDelete",er("USER_DISCONNECTED"),void 0,a)]),await this.deleteSession(n)}else await this.client.core.pairing.disconnect({topic:n})},this.find=t=>(this.isInitialized(),this.client.session.getAll().filter(n=>x1(n,t))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async t=>{if(t.pairingTopic)try{const n=this.client.core.pairing.pairings.get(t.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(u=>{var f,g;return((f=u.peerMetadata)==null?void 0:f.url)&&((g=u.peerMetadata)==null?void 0:g.url)===t.peer.metadata.url&&u.topic&&u.topic!==n.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(u=>this.client.core.pairing.disconnect({topic:u.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async(t,n)=>{const{self:a}=this.client.session.get(t);await this.client.core.relayer.unsubscribe(t),this.client.session.delete(t,er("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(t)&&await this.client.core.crypto.deleteSymKey(t),n||this.client.core.expirer.del(t),this.client.core.storage.removeItem(_l).catch(u=>this.client.logger.warn(u))},this.deleteProposal=async(t,n)=>{await Promise.all([this.client.proposal.delete(t,er("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(t)])},this.deletePendingSessionRequest=async(t,n,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,n),a?Promise.resolve():this.client.core.expirer.del(t)]),this.requestQueue.requests=this.requestQueue.requests.filter(u=>u.id!==t),a&&(this.requestQueue.state=Mn.idle)},this.setExpiry=async(t,n)=>{this.client.session.keys.includes(t)&&await this.client.session.update(t,{expiry:n}),this.client.core.expirer.set(t,n)},this.setProposal=async(t,n)=>{await this.client.proposal.set(t,n),this.client.core.expirer.set(t,n.expiry)},this.setPendingSessionRequest=async t=>{const n=qn.wc_sessionRequest.req.ttl,{id:a,topic:u,params:f}=t;await this.client.pendingRequest.set(a,{id:a,topic:u,params:f}),n&&this.client.core.expirer.set(a,$r(n))},this.sendRequest=async(t,n,a,u,f)=>{const g=Ic(n,a);if(Dl()&&vE.includes(n)){const P=cn(JSON.stringify(g));await this.client.core.verify.register({attestationId:P})}const m=await this.client.core.crypto.encode(t,g),v=qn[n].req;return u&&(v.ttl=u),f&&(v.id=f),this.client.core.history.set(t,g),this.client.core.relayer.publish(t,m,v),g.id},this.sendResult=async(t,n,a)=>{const u=xc(t,a),f=await this.client.core.crypto.encode(n,u),g=await this.client.core.history.get(n,t),m=qn[g.request.method].res;this.client.core.relayer.publish(n,f,m),await this.client.core.history.resolve(u)},this.sendError=async(t,n,a)=>{const u=wc(t,a),f=await this.client.core.crypto.encode(n,u),g=await this.client.core.history.get(n,t),m=qn[g.request.method].res;this.client.core.relayer.publish(n,f,m),await this.client.core.history.resolve(u)},this.cleanup=async()=>{const t=[],n=[];this.client.session.getAll().forEach(a=>{di(a.expiry)&&t.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{di(a.expiry)&&n.push(a.id)}),await Promise.all([...t.map(a=>this.deleteSession(a)),...n.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=t=>{const{topic:n,payload:a}=t,u=a.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeRequest(n,a);case"wc_sessionSettle":return this.onSessionSettleRequest(n,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,a);case"wc_sessionExtend":return this.onSessionExtendRequest(n,a);case"wc_sessionPing":return this.onSessionPingRequest(n,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,a);case"wc_sessionRequest":return this.onSessionRequest(n,a);case"wc_sessionEvent":return this.onSessionEventRequest(n,a);default:return this.client.logger.info(`Unsupported request method ${u}`)}},this.onRelayEventResponse=async t=>{const{topic:n,payload:a}=t,u=(await this.client.core.history.get(n,a.id)).request.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeResponse(n,a);case"wc_sessionSettle":return this.onSessionSettleResponse(n,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,a);case"wc_sessionExtend":return this.onSessionExtendResponse(n,a);case"wc_sessionPing":return this.onSessionPingResponse(n,a);case"wc_sessionRequest":return this.onSessionRequestResponse(n,a);default:return this.client.logger.info(`Unsupported response method ${u}`)}},this.onRelayEventUnknownPayload=t=>{const{topic:n}=t,{message:a}=Z("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(t,n)=>{const{params:a,id:u}=n;try{this.isValidConnect(xr({},n.params));const f=$r(re.FIVE_MINUTES),g=xr({id:u,pairingTopic:t,expiry:f},a);await this.setProposal(u,g);const m=cn(JSON.stringify(n)),v=await this.getVerifyContext(m,g.proposer.metadata);this.client.events.emit("session_proposal",{id:u,params:g,verifyContext:v})}catch(f){await this.sendError(u,t,f),this.client.logger.error(f)}},this.onSessionProposeResponse=async(t,n)=>{const{id:a}=n;if(pi(n)){const{result:u}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:u});const f=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:f});const g=f.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});const m=u.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:m});const v=await this.client.core.crypto.generateSharedKey(g,m);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:v});const P=await this.client.core.relayer.subscribe(v);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:P}),await this.client.core.pairing.activate({topic:t})}else ti(n)&&(await this.client.proposal.delete(a,er("USER_DISCONNECTED")),this.events.emit(Ft("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(t,n)=>{const{id:a,params:u}=n;try{this.isValidSessionSettleRequest(u);const{relay:f,controller:g,expiry:m,namespaces:v,requiredNamespaces:P,optionalNamespaces:H,sessionProperties:N,pairingTopic:U}=n.params,z=xr({topic:t,relay:f,expiry:m,namespaces:v,acknowledged:!0,pairingTopic:U,requiredNamespaces:P,optionalNamespaces:H,controller:g.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:g.publicKey,metadata:g.metadata}},N&&{sessionProperties:N});await this.sendResult(n.id,t,!0),this.events.emit(Ft("session_connect"),{session:z}),this.cleanupDuplicatePairings(z)}catch(f){await this.sendError(a,t,f),this.client.logger.error(f)}},this.onSessionSettleResponse=async(t,n)=>{const{id:a}=n;pi(n)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(Ft("session_approve",a),{})):ti(n)&&(await this.client.session.delete(t,er("USER_DISCONNECTED")),this.events.emit(Ft("session_approve",a),{error:n.error}))},this.onSessionUpdateRequest=async(t,n)=>{const{params:a,id:u}=n;try{this.isValidUpdate(xr({topic:t},a)),await this.client.session.update(t,{namespaces:a.namespaces}),await this.sendResult(u,t,!0),this.client.events.emit("session_update",{id:u,topic:t,params:a})}catch(f){await this.sendError(u,t,f),this.client.logger.error(f)}},this.onSessionUpdateResponse=(t,n)=>{const{id:a}=n;pi(n)?this.events.emit(Ft("session_update",a),{}):ti(n)&&this.events.emit(Ft("session_update",a),{error:n.error})},this.onSessionExtendRequest=async(t,n)=>{const{id:a}=n;try{this.isValidExtend({topic:t}),await this.setExpiry(t,$r(Qs)),await this.sendResult(a,t,!0),this.client.events.emit("session_extend",{id:a,topic:t})}catch(u){await this.sendError(a,t,u),this.client.logger.error(u)}},this.onSessionExtendResponse=(t,n)=>{const{id:a}=n;pi(n)?this.events.emit(Ft("session_extend",a),{}):ti(n)&&this.events.emit(Ft("session_extend",a),{error:n.error})},this.onSessionPingRequest=async(t,n)=>{const{id:a}=n;try{this.isValidPing({topic:t}),await this.sendResult(a,t,!0),this.client.events.emit("session_ping",{id:a,topic:t})}catch(u){await this.sendError(a,t,u),this.client.logger.error(u)}},this.onSessionPingResponse=(t,n)=>{const{id:a}=n;setTimeout(()=>{pi(n)?this.events.emit(Ft("session_ping",a),{}):ti(n)&&this.events.emit(Ft("session_ping",a),{error:n.error})},500)},this.onSessionDeleteRequest=async(t,n)=>{const{id:a}=n;try{this.isValidDisconnect({topic:t,reason:n.params}),await Promise.all([new Promise(u=>{this.client.core.relayer.once(vt.publish,async()=>{u(await this.deleteSession(t))})}),this.sendResult(a,t,!0)]),this.client.events.emit("session_delete",{id:a,topic:t})}catch(u){this.client.logger.error(u)}},this.onSessionRequest=async(t,n)=>{const{id:a,params:u}=n;try{this.isValidRequest(xr({topic:t},u)),await this.setPendingSessionRequest({id:a,topic:t,params:u}),this.addRequestToQueue({id:a,topic:t,params:u}),await this.processRequestQueue()}catch(f){await this.sendError(a,t,f),this.client.logger.error(f)}},this.onSessionRequestResponse=(t,n)=>{const{id:a}=n;pi(n)?this.events.emit(Ft("session_request",a),{result:n.result}):ti(n)&&this.events.emit(Ft("session_request",a),{error:n.error})},this.onSessionEventRequest=async(t,n)=>{const{id:a,params:u}=n;try{this.isValidEmit(xr({topic:t},u)),this.client.events.emit("session_event",{id:a,topic:t,params:u})}catch(f){await this.sendError(a,t,f),this.client.logger.error(f)}},this.addRequestToQueue=t=>{this.requestQueue.requests.push(t)},this.cleanupAfterResponse=t=>{this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.requestQueue.state=Mn.idle,this.processRequestQueue()},re.toMiliseconds(this.requestQueueDelay))},this.processRequestQueue=async()=>{if(this.requestQueue.state===Mn.active){this.client.logger.info("session request queue is already active.");return}const t=this.requestQueue.requests[0];if(!t){this.client.logger.info("session request queue is empty.");return}try{const{id:n,topic:a,params:u}=t,f=cn(JSON.stringify({id:n,params:u})),g=this.client.session.get(a),m=await this.getVerifyContext(f,g.peer.metadata);this.requestQueue.state=Mn.active,this.client.events.emit("session_request",{id:n,topic:a,params:u,verifyContext:m})}catch(n){this.client.logger.error(n)}},this.isValidConnect=async t=>{if(!or(t)){const{message:m}=Z("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(m)}const{pairingTopic:n,requiredNamespaces:a,optionalNamespaces:u,sessionProperties:f,relays:g}=t;if(gi(n)||await this.isValidPairingTopic(n),!I1(g,!0)){const{message:m}=Z("MISSING_OR_INVALID",`connect() relays: ${g}`);throw new Error(m)}!gi(a)&&ta(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!gi(u)&&ta(u)!==0&&this.validateNamespaces(u,"optionalNamespaces"),gi(f)||this.validateSessionProps(f,"sessionProperties")},this.validateNamespaces=(t,n)=>{const a=S1(t,"connect()",n);if(a)throw new Error(a.message)},this.isValidApprove=async t=>{if(!or(t))throw new Error(Z("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:n,namespaces:a,relayProtocol:u,sessionProperties:f}=t;await this.isValidProposalId(n);const g=this.client.proposal.get(n),m=qo(a,"approve()");if(m)throw new Error(m.message);const v=$h(g.requiredNamespaces,a,"approve()");if(v)throw new Error(v.message);if(!an(u,!0)){const{message:P}=Z("MISSING_OR_INVALID",`approve() relayProtocol: ${u}`);throw new Error(P)}gi(f)||this.validateSessionProps(f,"sessionProperties")},this.isValidReject=async t=>{if(!or(t)){const{message:u}=Z("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(u)}const{id:n,reason:a}=t;if(await this.isValidProposalId(n),!P1(a)){const{message:u}=Z("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(u)}},this.isValidSessionSettleRequest=t=>{if(!or(t)){const{message:v}=Z("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(v)}const{relay:n,controller:a,namespaces:u,expiry:f}=t;if(!O1(n)){const{message:v}=Z("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(v)}const g=C1(a,"onSessionSettleRequest()");if(g)throw new Error(g.message);const m=qo(u,"onSessionSettleRequest()");if(m)throw new Error(m.message);if(di(f)){const{message:v}=Z("EXPIRED","onSessionSettleRequest()");throw new Error(v)}},this.isValidUpdate=async t=>{if(!or(t)){const{message:m}=Z("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(m)}const{topic:n,namespaces:a}=t;await this.isValidSessionTopic(n);const u=this.client.session.get(n),f=qo(a,"update()");if(f)throw new Error(f.message);const g=$h(u.requiredNamespaces,a,"update()");if(g)throw new Error(g.message)},this.isValidExtend=async t=>{if(!or(t)){const{message:a}=Z("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(a)}const{topic:n}=t;await this.isValidSessionTopic(n)},this.isValidRequest=async t=>{if(!or(t)){const{message:m}=Z("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(m)}const{topic:n,request:a,chainId:u,expiry:f}=t;await this.isValidSessionTopic(n);const{namespaces:g}=this.client.session.get(n);if(!Nh(g,u)){const{message:m}=Z("MISSING_OR_INVALID",`request() chainId: ${u}`);throw new Error(m)}if(!A1(a)){const{message:m}=Z("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(m)}if(!T1(g,u,a.method)){const{message:m}=Z("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(m)}if(f&&!R1(f,Jo)){const{message:m}=Z("MISSING_OR_INVALID",`request() expiry: ${f}. Expiry must be a number (in seconds) between ${Jo.min} and ${Jo.max}`);throw new Error(m)}},this.isValidRespond=async t=>{if(!or(t)){const{message:u}=Z("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(u)}const{topic:n,response:a}=t;if(await this.isValidSessionTopic(n),!$1(a)){const{message:u}=Z("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(a)}`);throw new Error(u)}},this.isValidPing=async t=>{if(!or(t)){const{message:a}=Z("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(a)}const{topic:n}=t;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async t=>{if(!or(t)){const{message:g}=Z("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(g)}const{topic:n,event:a,chainId:u}=t;await this.isValidSessionTopic(n);const{namespaces:f}=this.client.session.get(n);if(!Nh(f,u)){const{message:g}=Z("MISSING_OR_INVALID",`emit() chainId: ${u}`);throw new Error(g)}if(!N1(a)){const{message:g}=Z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(g)}if(!F1(f,u,a.name)){const{message:g}=Z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(g)}},this.isValidDisconnect=async t=>{if(!or(t)){const{message:a}=Z("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(a)}const{topic:n}=t;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(t,n)=>{const a={verified:{verifyUrl:n.verifyUrl||"",validation:"UNKNOWN",origin:n.url||""}};try{const u=await this.client.core.verify.resolve({attestationId:t,verifyUrl:n.verifyUrl});u&&(a.verified.origin=u,a.verified.validation=u===n.url?"VALID":"INVALID")}catch(u){this.client.logger.error(u)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(t,n)=>{Object.values(t).forEach(a=>{if(!an(a,!1)){const{message:u}=Z("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(u)}})}}isInitialized(){if(!this.initialized){const{message:i}=Z("NOT_INITIALIZED",this.name);throw new Error(i)}}registerRelayerEvents(){this.client.core.relayer.on(vt.message,async i=>{const{topic:t,message:n}=i;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const a=await this.client.core.crypto.decode(t,n);try{bc(a)?(this.client.core.history.set(t,a),this.onRelayEventRequest({topic:t,payload:a})):Ec(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:t,payload:a}),this.client.core.history.delete(t,a.id)):this.onRelayEventUnknownPayload({topic:t,payload:a})}catch(u){this.client.logger.error(u)}})}registerExpirerEvents(){this.client.core.expirer.on(Ir.expired,async i=>{const{topic:t,id:n}=Fl(i.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,Z("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession(t,!0),this.client.events.emit("session_expire",{topic:t})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}isValidPairingTopic(i){if(!an(i,!1)){const{message:t}=Z("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(i)){const{message:t}=Z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(t)}if(di(this.client.core.pairing.pairings.get(i).expiry)){const{message:t}=Z("EXPIRED",`pairing topic: ${i}`);throw new Error(t)}}async isValidSessionTopic(i){if(!an(i,!1)){const{message:t}=Z("MISSING_OR_INVALID",`session topic should be a string: ${i}`);throw new Error(t)}if(!this.client.session.keys.includes(i)){const{message:t}=Z("NO_MATCHING_KEY",`session topic doesn't exist: ${i}`);throw new Error(t)}if(di(this.client.session.get(i).expiry)){await this.deleteSession(i);const{message:t}=Z("EXPIRED",`session topic: ${i}`);throw new Error(t)}}async isValidSessionOrPairingTopic(i){if(this.client.session.keys.includes(i))await this.isValidSessionTopic(i);else if(this.client.core.pairing.pairings.keys.includes(i))this.isValidPairingTopic(i);else if(an(i,!1)){const{message:t}=Z("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${i}`);throw new Error(t)}else{const{message:t}=Z("MISSING_OR_INVALID",`session or pairing topic should be a string: ${i}`);throw new Error(t)}}async isValidProposalId(i){if(!D1(i)){const{message:t}=Z("MISSING_OR_INVALID",`proposal id should be a number: ${i}`);throw new Error(t)}if(!this.client.proposal.keys.includes(i)){const{message:t}=Z("NO_MATCHING_KEY",`proposal id doesn't exist: ${i}`);throw new Error(t)}if(di(this.client.proposal.get(i).expiry)){await this.deleteProposal(i);const{message:t}=Z("EXPIRED",`proposal id: ${i}`);throw new Error(t)}}}class IE extends fa{constructor(i,t){super(i,t,pE,Cc),this.core=i,this.logger=t}}class SE extends fa{constructor(i,t){super(i,t,dE,Cc),this.core=i,this.logger=t}}class PE extends fa{constructor(i,t){super(i,t,yE,Cc,n=>n.id),this.core=i,this.logger=t}}let OE=class _f extends wm{constructor(i){super(i),this.protocol=df,this.version=gf,this.name=Wo.name,this.events=new kr.EventEmitter,this.on=(n,a)=>this.events.on(n,a),this.once=(n,a)=>this.events.once(n,a),this.off=(n,a)=>this.events.off(n,a),this.removeListener=(n,a)=>this.events.removeListener(n,a),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(a){throw this.logger.error(a.message),a}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(a){throw this.logger.error(a.message),a}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(a){throw this.logger.error(a.message),a}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(a){throw this.logger.error(a.message),a}},this.update=async n=>{try{return await this.engine.update(n)}catch(a){throw this.logger.error(a.message),a}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(a){throw this.logger.error(a.message),a}},this.request=async n=>{try{return await this.engine.request(n)}catch(a){throw this.logger.error(a.message),a}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(a){throw this.logger.error(a.message),a}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(a){throw this.logger.error(a.message),a}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(a){throw this.logger.error(a.message),a}},this.find=n=>{try{return this.engine.find(n)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=(i==null?void 0:i.name)||Wo.name,this.metadata=(i==null?void 0:i.metadata)||w1();const t=typeof(i==null?void 0:i.logger)<"u"&&typeof(i==null?void 0:i.logger)!="string"?i.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:(i==null?void 0:i.logger)||Wo.logger}));this.core=(i==null?void 0:i.core)||new fE(i),this.logger=Ce.generateChildLogger(t,this.name),this.session=new SE(this.core,this.logger),this.proposal=new IE(this.core,this.logger),this.pendingRequest=new PE(this.core,this.logger),this.engine=new xE(this)}static async init(i){const t=new _f(i);return await t.initialize(),t}get context(){return Ce.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(i){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(i.message),i}}};const bl="error",CE="wss://relay.walletconnect.com",AE="wc",TE="universal_provider",El=`${AE}@2:${TE}:`,RE="https://rpc.walletconnect.com/v1",_i={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var zn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},pc={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(o,i){(function(){var t,n="4.17.21",a=200,u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",f="Expected a function",g="Invalid `variable` option passed into `_.template`",m="__lodash_hash_undefined__",v=500,P="__lodash_placeholder__",H=1,N=2,U=4,z=1,K=2,ae=1,be=2,de=4,pe=8,ue=16,he=32,R=64,M=128,W=256,ge=512,te=30,Ee="...",Ae=800,et=16,C=1,j=2,Me=3,Te=1/0,J=9007199254740991,V=17976931348623157e292,k=0/0,B=4294967295,ct=B-1,ke=B>>>1,Nr=[["ary",M],["bind",ae],["bindKey",be],["curry",pe],["curryRight",ue],["flip",ge],["partial",he],["partialRight",R],["rearg",W]],me="[object Arguments]",It="[object Array]",T="[object AsyncFunction]",A="[object Boolean]",S="[object Date]",h="[object DOMException]",b="[object Error]",X="[object Function]",oe="[object GeneratorFunction]",ve="[object Map]",Re="[object Number]",Ne="[object Null]",Ie="[object Object]",St="[object Promise]",_t="[object Proxy]",nt="[object RegExp]",De="[object Set]",Je="[object String]",Ye="[object Symbol]",st="[object Undefined]",ze="[object WeakMap]",Qe="[object WeakSet]",$e="[object ArrayBuffer]",He="[object DataView]",ut="[object Float32Array]",Le="[object Float64Array]",Pt="[object Int8Array]",Dt="[object Int16Array]",Ut="[object Int32Array]",kt="[object Uint8Array]",qt="[object Uint8ClampedArray]",Gt="[object Uint16Array]",tr="[object Uint32Array]",Fr=/\b__p \+= '';/g,Wt=/\b(__p \+=) '' \+/g,Hr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ri=/&(?:amp|lt|gt|quot|#39);/g,mi=/[&<>"']/g,ht=RegExp(ri.source),tt=RegExp(mi.source),lt=/<%-([\s\S]+?)%>/g,ft=/<%([\s\S]+?)%>/g,at=/<%=([\s\S]+?)%>/g,rt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ot=/^\w*$/,Ct=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,pt=/[\\^$.*+?()[\]{}|]/g,At=RegExp(pt.source),dt=/^\s+/,mt=/\s/,gt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,We=/\{\n\/\* \[wrapped with (.+)\] \*/,Tt=/,? & /,Rt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,pa=/[()=,{}\[\]\/\s]/,da=/\\(\\)?/g,ga=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,dr=/\w*$/,ya=/^[-+]0x[0-9a-f]+$/i,va=/^0b[01]+$/i,_a=/^\[object .+?Constructor\]$/,ma=/^0o[0-7]+$/i,wa=/^(?:0|[1-9]\d*)$/,Kr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,qi=/($^)/,ba=/['\n\r\u2028\u2029\\]/g,Mi="\\ud800-\\udfff",Ea="\\u0300-\\u036f",xa="\\ufe20-\\ufe2f",zi="\\u20d0-\\u20ff",Gn=Ea+xa+zi,Wn="\\u2700-\\u27bf",Pr="a-z\\xdf-\\xf6\\xf8-\\xff",Ia="\\xac\\xb1\\xd7\\xf7",Sa="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Pa="\\u2000-\\u206f",Oa=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Jn="A-Z\\xc0-\\xd6\\xd8-\\xde",Yn="\\ufe0e\\ufe0f",wi=Ia+Sa+Pa+Oa,ln="[']",bi="["+Mi+"]",fn="["+wi+"]",Ei="["+Gn+"]",Qn="\\d+",Ca="["+Wn+"]",Zn="["+Pr+"]",Xn="[^"+Mi+wi+Qn+Wn+Pr+Jn+"]",Ui="\\ud83c[\\udffb-\\udfff]",Aa="(?:"+Ei+"|"+Ui+")",es="[^"+Mi+"]",ki="(?:\\ud83c[\\udde6-\\uddff]){2}",ii="[\\ud800-\\udbff][\\udc00-\\udfff]",cr="["+Jn+"]",ts="\\u200d",rs="(?:"+Zn+"|"+Xn+")",Dr="(?:"+cr+"|"+Xn+")",is="(?:"+ln+"(?:d|ll|m|re|s|t|ve))?",ns="(?:"+ln+"(?:D|LL|M|RE|S|T|VE))?",ss=Aa+"?",as="["+Yn+"]?",Ta="(?:"+ts+"(?:"+[es,ki,ii].join("|")+")"+as+ss+")*",Vr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",os="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",cs=as+ss+Ta,Hi="(?:"+[Ca,ki,ii].join("|")+")"+cs,Ra="(?:"+[es+Ei+"?",Ei,ki,ii,bi].join("|")+")",pn=RegExp(ln,"g"),$a=RegExp(Ei,"g"),Ki=RegExp(Ui+"(?="+Ui+")|"+Ra+cs,"g"),us=RegExp([cr+"?"+Zn+"+"+is+"(?="+[fn,cr,"$"].join("|")+")",Dr+"+"+ns+"(?="+[fn,cr+rs,"$"].join("|")+")",cr+"?"+rs+"+"+is,cr+"+"+ns,os,Vr,Qn,Hi].join("|"),"g"),hs=RegExp("["+ts+Mi+Gn+Yn+"]"),xi=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ls=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Na=-1,Ke={};Ke[ut]=Ke[Le]=Ke[Pt]=Ke[Dt]=Ke[Ut]=Ke[kt]=Ke[qt]=Ke[Gt]=Ke[tr]=!0,Ke[me]=Ke[It]=Ke[$e]=Ke[A]=Ke[He]=Ke[S]=Ke[b]=Ke[X]=Ke[ve]=Ke[Re]=Ke[Ie]=Ke[nt]=Ke[De]=Ke[Je]=Ke[ze]=!1;var Ue={};Ue[me]=Ue[It]=Ue[$e]=Ue[He]=Ue[A]=Ue[S]=Ue[ut]=Ue[Le]=Ue[Pt]=Ue[Dt]=Ue[Ut]=Ue[ve]=Ue[Re]=Ue[Ie]=Ue[nt]=Ue[De]=Ue[Je]=Ue[Ye]=Ue[kt]=Ue[qt]=Ue[Gt]=Ue[tr]=!0,Ue[b]=Ue[X]=Ue[ze]=!1;var y={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},E={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},L={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Y={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ve=parseFloat,le=parseInt,Ze=typeof zn=="object"&&zn&&zn.Object===Object&&zn,$t=typeof self=="object"&&self&&self.Object===Object&&self,Pe=Ze||$t||Function("return this")(),Be=i&&!i.nodeType&&i,wt=Be&&!0&&o&&!o.nodeType&&o,rr=wt&&wt.exports===Be,Nt=rr&&Ze.process,Xe=function(){try{var x=wt&&wt.require&&wt.require("util").types;return x||Nt&&Nt.binding&&Nt.binding("util")}catch{}}(),Jt=Xe&&Xe.isArrayBuffer,Or=Xe&&Xe.isDate,gr=Xe&&Xe.isMap,jr=Xe&&Xe.isRegExp,dn=Xe&&Xe.isSet,Ii=Xe&&Xe.isTypedArray;function Mt(x,$,O){switch(O.length){case 0:return x.call($);case 1:return x.call($,O[0]);case 2:return x.call($,O[0],O[1]);case 3:return x.call($,O[0],O[1],O[2])}return x.apply($,O)}function bf(x,$,O,Q){for(var ce=-1,Fe=x==null?0:x.length;++ce<Fe;){var jt=x[ce];$(Q,jt,O(jt),x)}return Q}function yr(x,$){for(var O=-1,Q=x==null?0:x.length;++O<Q&&$(x[O],O,x)!==!1;);return x}function Ef(x,$){for(var O=x==null?0:x.length;O--&&$(x[O],O,x)!==!1;);return x}function Rc(x,$){for(var O=-1,Q=x==null?0:x.length;++O<Q;)if(!$(x[O],O,x))return!1;return!0}function ni(x,$){for(var O=-1,Q=x==null?0:x.length,ce=0,Fe=[];++O<Q;){var jt=x[O];$(jt,O,x)&&(Fe[ce++]=jt)}return Fe}function fs(x,$){var O=x==null?0:x.length;return!!O&&Vi(x,$,0)>-1}function Fa(x,$,O){for(var Q=-1,ce=x==null?0:x.length;++Q<ce;)if(O($,x[Q]))return!0;return!1}function it(x,$){for(var O=-1,Q=x==null?0:x.length,ce=Array(Q);++O<Q;)ce[O]=$(x[O],O,x);return ce}function si(x,$){for(var O=-1,Q=$.length,ce=x.length;++O<Q;)x[ce+O]=$[O];return x}function Da(x,$,O,Q){var ce=-1,Fe=x==null?0:x.length;for(Q&&Fe&&(O=x[++ce]);++ce<Fe;)O=$(O,x[ce],ce,x);return O}function xf(x,$,O,Q){var ce=x==null?0:x.length;for(Q&&ce&&(O=x[--ce]);ce--;)O=$(O,x[ce],ce,x);return O}function ja(x,$){for(var O=-1,Q=x==null?0:x.length;++O<Q;)if($(x[O],O,x))return!0;return!1}var If=La("length");function Sf(x){return x.split("")}function Pf(x){return x.match(Rt)||[]}function $c(x,$,O){var Q;return O(x,function(ce,Fe,jt){if($(ce,Fe,jt))return Q=Fe,!1}),Q}function ps(x,$,O,Q){for(var ce=x.length,Fe=O+(Q?1:-1);Q?Fe--:++Fe<ce;)if($(x[Fe],Fe,x))return Fe;return-1}function Vi(x,$,O){return $===$?qf(x,$,O):ps(x,Nc,O)}function Of(x,$,O,Q){for(var ce=O-1,Fe=x.length;++ce<Fe;)if(Q(x[ce],$))return ce;return-1}function Nc(x){return x!==x}function Fc(x,$){var O=x==null?0:x.length;return O?Ma(x,$)/O:k}function La(x){return function($){return $==null?t:$[x]}}function qa(x){return function($){return x==null?t:x[$]}}function Dc(x,$,O,Q,ce){return ce(x,function(Fe,jt,Ge){O=Q?(Q=!1,Fe):$(O,Fe,jt,Ge)}),O}function Cf(x,$){var O=x.length;for(x.sort($);O--;)x[O]=x[O].value;return x}function Ma(x,$){for(var O,Q=-1,ce=x.length;++Q<ce;){var Fe=$(x[Q]);Fe!==t&&(O=O===t?Fe:O+Fe)}return O}function za(x,$){for(var O=-1,Q=Array(x);++O<x;)Q[O]=$(O);return Q}function Af(x,$){return it($,function(O){return[O,x[O]]})}function jc(x){return x&&x.slice(0,zc(x)+1).replace(dt,"")}function ur(x){return function($){return x($)}}function Ua(x,$){return it($,function(O){return x[O]})}function gn(x,$){return x.has($)}function Lc(x,$){for(var O=-1,Q=x.length;++O<Q&&Vi($,x[O],0)>-1;);return O}function qc(x,$){for(var O=x.length;O--&&Vi($,x[O],0)>-1;);return O}function Tf(x,$){for(var O=x.length,Q=0;O--;)x[O]===$&&++Q;return Q}var Rf=qa(y),$f=qa(E);function Nf(x){return"\\"+Y[x]}function Ff(x,$){return x==null?t:x[$]}function Bi(x){return hs.test(x)}function Df(x){return xi.test(x)}function jf(x){for(var $,O=[];!($=x.next()).done;)O.push($.value);return O}function ka(x){var $=-1,O=Array(x.size);return x.forEach(function(Q,ce){O[++$]=[ce,Q]}),O}function Mc(x,$){return function(O){return x($(O))}}function ai(x,$){for(var O=-1,Q=x.length,ce=0,Fe=[];++O<Q;){var jt=x[O];(jt===$||jt===P)&&(x[O]=P,Fe[ce++]=O)}return Fe}function ds(x){var $=-1,O=Array(x.size);return x.forEach(function(Q){O[++$]=Q}),O}function Lf(x){var $=-1,O=Array(x.size);return x.forEach(function(Q){O[++$]=[Q,Q]}),O}function qf(x,$,O){for(var Q=O-1,ce=x.length;++Q<ce;)if(x[Q]===$)return Q;return-1}function Mf(x,$,O){for(var Q=O+1;Q--;)if(x[Q]===$)return Q;return Q}function Gi(x){return Bi(x)?Uf(x):If(x)}function Cr(x){return Bi(x)?kf(x):Sf(x)}function zc(x){for(var $=x.length;$--&&mt.test(x.charAt($)););return $}var zf=qa(L);function Uf(x){for(var $=Ki.lastIndex=0;Ki.test(x);)++$;return $}function kf(x){return x.match(Ki)||[]}function Hf(x){return x.match(us)||[]}var Kf=function x($){$=$==null?Pe:Wi.defaults(Pe.Object(),$,Wi.pick(Pe,ls));var O=$.Array,Q=$.Date,ce=$.Error,Fe=$.Function,jt=$.Math,Ge=$.Object,Ha=$.RegExp,Vf=$.String,vr=$.TypeError,gs=O.prototype,Bf=Fe.prototype,Ji=Ge.prototype,ys=$["__core-js_shared__"],vs=Bf.toString,qe=Ji.hasOwnProperty,Gf=0,Uc=function(){var e=/[^.]+$/.exec(ys&&ys.keys&&ys.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),_s=Ji.toString,Wf=vs.call(Ge),Jf=Pe._,Yf=Ha("^"+vs.call(qe).replace(pt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ms=rr?$.Buffer:t,oi=$.Symbol,ws=$.Uint8Array,kc=ms?ms.allocUnsafe:t,bs=Mc(Ge.getPrototypeOf,Ge),Hc=Ge.create,Kc=Ji.propertyIsEnumerable,Es=gs.splice,Vc=oi?oi.isConcatSpreadable:t,yn=oi?oi.iterator:t,Si=oi?oi.toStringTag:t,xs=function(){try{var e=Ti(Ge,"defineProperty");return e({},"",{}),e}catch{}}(),Qf=$.clearTimeout!==Pe.clearTimeout&&$.clearTimeout,Zf=Q&&Q.now!==Pe.Date.now&&Q.now,Xf=$.setTimeout!==Pe.setTimeout&&$.setTimeout,Is=jt.ceil,Ss=jt.floor,Ka=Ge.getOwnPropertySymbols,ep=ms?ms.isBuffer:t,Bc=$.isFinite,tp=gs.join,rp=Mc(Ge.keys,Ge),Lt=jt.max,Vt=jt.min,ip=Q.now,np=$.parseInt,Gc=jt.random,sp=gs.reverse,Va=Ti($,"DataView"),vn=Ti($,"Map"),Ba=Ti($,"Promise"),Yi=Ti($,"Set"),_n=Ti($,"WeakMap"),mn=Ti(Ge,"create"),Ps=_n&&new _n,Qi={},ap=Ri(Va),op=Ri(vn),cp=Ri(Ba),up=Ri(Yi),hp=Ri(_n),Os=oi?oi.prototype:t,wn=Os?Os.valueOf:t,Wc=Os?Os.toString:t;function p(e){if(yt(e)&&!fe(e)&&!(e instanceof Se)){if(e instanceof _r)return e;if(qe.call(e,"__wrapped__"))return Ju(e)}return new _r(e)}var Zi=function(){function e(){}return function(r){if(!ot(r))return{};if(Hc)return Hc(r);e.prototype=r;var s=new e;return e.prototype=t,s}}();function Cs(){}function _r(e,r){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!r,this.__index__=0,this.__values__=t}p.templateSettings={escape:lt,evaluate:ft,interpolate:at,variable:"",imports:{_:p}},p.prototype=Cs.prototype,p.prototype.constructor=p,_r.prototype=Zi(Cs.prototype),_r.prototype.constructor=_r;function Se(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=B,this.__views__=[]}function lp(){var e=new Se(this.__wrapped__);return e.__actions__=ir(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=ir(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=ir(this.__views__),e}function fp(){if(this.__filtered__){var e=new Se(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function pp(){var e=this.__wrapped__.value(),r=this.__dir__,s=fe(e),c=r<0,l=s?e.length:0,d=Sd(0,l,this.__views__),_=d.start,w=d.end,I=w-_,F=c?w:_-1,D=this.__iteratees__,q=D.length,G=0,ee=Vt(I,this.__takeCount__);if(!s||!c&&l==I&&ee==I)return _u(e,this.__actions__);var ne=[];e:for(;I--&&G<ee;){F+=r;for(var _e=-1,se=e[F];++_e<q;){var xe=D[_e],Oe=xe.iteratee,fr=xe.type,Zt=Oe(se);if(fr==j)se=Zt;else if(!Zt){if(fr==C)continue e;break e}}ne[G++]=se}return ne}Se.prototype=Zi(Cs.prototype),Se.prototype.constructor=Se;function Pi(e){var r=-1,s=e==null?0:e.length;for(this.clear();++r<s;){var c=e[r];this.set(c[0],c[1])}}function dp(){this.__data__=mn?mn(null):{},this.size=0}function gp(e){var r=this.has(e)&&delete this.__data__[e];return this.size-=r?1:0,r}function yp(e){var r=this.__data__;if(mn){var s=r[e];return s===m?t:s}return qe.call(r,e)?r[e]:t}function vp(e){var r=this.__data__;return mn?r[e]!==t:qe.call(r,e)}function _p(e,r){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=mn&&r===t?m:r,this}Pi.prototype.clear=dp,Pi.prototype.delete=gp,Pi.prototype.get=yp,Pi.prototype.has=vp,Pi.prototype.set=_p;function Br(e){var r=-1,s=e==null?0:e.length;for(this.clear();++r<s;){var c=e[r];this.set(c[0],c[1])}}function mp(){this.__data__=[],this.size=0}function wp(e){var r=this.__data__,s=As(r,e);if(s<0)return!1;var c=r.length-1;return s==c?r.pop():Es.call(r,s,1),--this.size,!0}function bp(e){var r=this.__data__,s=As(r,e);return s<0?t:r[s][1]}function Ep(e){return As(this.__data__,e)>-1}function xp(e,r){var s=this.__data__,c=As(s,e);return c<0?(++this.size,s.push([e,r])):s[c][1]=r,this}Br.prototype.clear=mp,Br.prototype.delete=wp,Br.prototype.get=bp,Br.prototype.has=Ep,Br.prototype.set=xp;function Gr(e){var r=-1,s=e==null?0:e.length;for(this.clear();++r<s;){var c=e[r];this.set(c[0],c[1])}}function Ip(){this.size=0,this.__data__={hash:new Pi,map:new(vn||Br),string:new Pi}}function Sp(e){var r=Us(this,e).delete(e);return this.size-=r?1:0,r}function Pp(e){return Us(this,e).get(e)}function Op(e){return Us(this,e).has(e)}function Cp(e,r){var s=Us(this,e),c=s.size;return s.set(e,r),this.size+=s.size==c?0:1,this}Gr.prototype.clear=Ip,Gr.prototype.delete=Sp,Gr.prototype.get=Pp,Gr.prototype.has=Op,Gr.prototype.set=Cp;function Oi(e){var r=-1,s=e==null?0:e.length;for(this.__data__=new Gr;++r<s;)this.add(e[r])}function Ap(e){return this.__data__.set(e,m),this}function Tp(e){return this.__data__.has(e)}Oi.prototype.add=Oi.prototype.push=Ap,Oi.prototype.has=Tp;function Ar(e){var r=this.__data__=new Br(e);this.size=r.size}function Rp(){this.__data__=new Br,this.size=0}function $p(e){var r=this.__data__,s=r.delete(e);return this.size=r.size,s}function Np(e){return this.__data__.get(e)}function Fp(e){return this.__data__.has(e)}function Dp(e,r){var s=this.__data__;if(s instanceof Br){var c=s.__data__;if(!vn||c.length<a-1)return c.push([e,r]),this.size=++s.size,this;s=this.__data__=new Gr(c)}return s.set(e,r),this.size=s.size,this}Ar.prototype.clear=Rp,Ar.prototype.delete=$p,Ar.prototype.get=Np,Ar.prototype.has=Fp,Ar.prototype.set=Dp;function Jc(e,r){var s=fe(e),c=!s&&$i(e),l=!s&&!c&&fi(e),d=!s&&!c&&!l&&rn(e),_=s||c||l||d,w=_?za(e.length,Vf):[],I=w.length;for(var F in e)(r||qe.call(e,F))&&!(_&&(F=="length"||l&&(F=="offset"||F=="parent")||d&&(F=="buffer"||F=="byteLength"||F=="byteOffset")||Qr(F,I)))&&w.push(F);return w}function Yc(e){var r=e.length;return r?e[io(0,r-1)]:t}function jp(e,r){return ks(ir(e),Ci(r,0,e.length))}function Lp(e){return ks(ir(e))}function Ga(e,r,s){(s!==t&&!Tr(e[r],s)||s===t&&!(r in e))&&Wr(e,r,s)}function bn(e,r,s){var c=e[r];(!(qe.call(e,r)&&Tr(c,s))||s===t&&!(r in e))&&Wr(e,r,s)}function As(e,r){for(var s=e.length;s--;)if(Tr(e[s][0],r))return s;return-1}function qp(e,r,s,c){return ci(e,function(l,d,_){r(c,l,s(l),_)}),c}function Qc(e,r){return e&&qr(r,zt(r),e)}function Mp(e,r){return e&&qr(r,sr(r),e)}function Wr(e,r,s){r=="__proto__"&&xs?xs(e,r,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[r]=s}function Wa(e,r){for(var s=-1,c=r.length,l=O(c),d=e==null;++s<c;)l[s]=d?t:Ao(e,r[s]);return l}function Ci(e,r,s){return e===e&&(s!==t&&(e=e<=s?e:s),r!==t&&(e=e>=r?e:r)),e}function mr(e,r,s,c,l,d){var _,w=r&H,I=r&N,F=r&U;if(s&&(_=l?s(e,c,l,d):s(e)),_!==t)return _;if(!ot(e))return e;var D=fe(e);if(D){if(_=Od(e),!w)return ir(e,_)}else{var q=Bt(e),G=q==X||q==oe;if(fi(e))return bu(e,w);if(q==Ie||q==me||G&&!l){if(_=I||G?{}:zu(e),!w)return I?yd(e,Mp(_,e)):gd(e,Qc(_,e))}else{if(!Ue[q])return l?e:{};_=Cd(e,q,w)}}d||(d=new Ar);var ee=d.get(e);if(ee)return ee;d.set(e,_),gh(e)?e.forEach(function(se){_.add(mr(se,r,s,se,e,d))}):ph(e)&&e.forEach(function(se,xe){_.set(xe,mr(se,r,s,xe,e,d))});var ne=F?I?go:po:I?sr:zt,_e=D?t:ne(e);return yr(_e||e,function(se,xe){_e&&(xe=se,se=e[xe]),bn(_,xe,mr(se,r,s,xe,e,d))}),_}function zp(e){var r=zt(e);return function(s){return Zc(s,e,r)}}function Zc(e,r,s){var c=s.length;if(e==null)return!c;for(e=Ge(e);c--;){var l=s[c],d=r[l],_=e[l];if(_===t&&!(l in e)||!d(_))return!1}return!0}function Xc(e,r,s){if(typeof e!="function")throw new vr(f);return Cn(function(){e.apply(t,s)},r)}function En(e,r,s,c){var l=-1,d=fs,_=!0,w=e.length,I=[],F=r.length;if(!w)return I;s&&(r=it(r,ur(s))),c?(d=Fa,_=!1):r.length>=a&&(d=gn,_=!1,r=new Oi(r));e:for(;++l<w;){var D=e[l],q=s==null?D:s(D);if(D=c||D!==0?D:0,_&&q===q){for(var G=F;G--;)if(r[G]===q)continue e;I.push(D)}else d(r,q,c)||I.push(D)}return I}var ci=Pu(Lr),eu=Pu(Ya,!0);function Up(e,r){var s=!0;return ci(e,function(c,l,d){return s=!!r(c,l,d),s}),s}function Ts(e,r,s){for(var c=-1,l=e.length;++c<l;){var d=e[c],_=r(d);if(_!=null&&(w===t?_===_&&!lr(_):s(_,w)))var w=_,I=d}return I}function kp(e,r,s,c){var l=e.length;for(s=ye(s),s<0&&(s=-s>l?0:l+s),c=c===t||c>l?l:ye(c),c<0&&(c+=l),c=s>c?0:vh(c);s<c;)e[s++]=r;return e}function tu(e,r){var s=[];return ci(e,function(c,l,d){r(c,l,d)&&s.push(c)}),s}function Ht(e,r,s,c,l){var d=-1,_=e.length;for(s||(s=Td),l||(l=[]);++d<_;){var w=e[d];r>0&&s(w)?r>1?Ht(w,r-1,s,c,l):si(l,w):c||(l[l.length]=w)}return l}var Ja=Ou(),ru=Ou(!0);function Lr(e,r){return e&&Ja(e,r,zt)}function Ya(e,r){return e&&ru(e,r,zt)}function Rs(e,r){return ni(r,function(s){return Zr(e[s])})}function Ai(e,r){r=hi(r,e);for(var s=0,c=r.length;e!=null&&s<c;)e=e[Mr(r[s++])];return s&&s==c?e:t}function iu(e,r,s){var c=r(e);return fe(e)?c:si(c,s(e))}function Yt(e){return e==null?e===t?st:Ne:Si&&Si in Ge(e)?Id(e):Ld(e)}function Qa(e,r){return e>r}function Hp(e,r){return e!=null&&qe.call(e,r)}function Kp(e,r){return e!=null&&r in Ge(e)}function Vp(e,r,s){return e>=Vt(r,s)&&e<Lt(r,s)}function Za(e,r,s){for(var c=s?Fa:fs,l=e[0].length,d=e.length,_=d,w=O(d),I=1/0,F=[];_--;){var D=e[_];_&&r&&(D=it(D,ur(r))),I=Vt(D.length,I),w[_]=!s&&(r||l>=120&&D.length>=120)?new Oi(_&&D):t}D=e[0];var q=-1,G=w[0];e:for(;++q<l&&F.length<I;){var ee=D[q],ne=r?r(ee):ee;if(ee=s||ee!==0?ee:0,!(G?gn(G,ne):c(F,ne,s))){for(_=d;--_;){var _e=w[_];if(!(_e?gn(_e,ne):c(e[_],ne,s)))continue e}G&&G.push(ne),F.push(ee)}}return F}function Bp(e,r,s,c){return Lr(e,function(l,d,_){r(c,s(l),d,_)}),c}function xn(e,r,s){r=hi(r,e),e=Ku(e,r);var c=e==null?e:e[Mr(br(r))];return c==null?t:Mt(c,e,s)}function nu(e){return yt(e)&&Yt(e)==me}function Gp(e){return yt(e)&&Yt(e)==$e}function Wp(e){return yt(e)&&Yt(e)==S}function In(e,r,s,c,l){return e===r?!0:e==null||r==null||!yt(e)&&!yt(r)?e!==e&&r!==r:Jp(e,r,s,c,In,l)}function Jp(e,r,s,c,l,d){var _=fe(e),w=fe(r),I=_?It:Bt(e),F=w?It:Bt(r);I=I==me?Ie:I,F=F==me?Ie:F;var D=I==Ie,q=F==Ie,G=I==F;if(G&&fi(e)){if(!fi(r))return!1;_=!0,D=!1}if(G&&!D)return d||(d=new Ar),_||rn(e)?Lu(e,r,s,c,l,d):Ed(e,r,I,s,c,l,d);if(!(s&z)){var ee=D&&qe.call(e,"__wrapped__"),ne=q&&qe.call(r,"__wrapped__");if(ee||ne){var _e=ee?e.value():e,se=ne?r.value():r;return d||(d=new Ar),l(_e,se,s,c,d)}}return G?(d||(d=new Ar),xd(e,r,s,c,l,d)):!1}function Yp(e){return yt(e)&&Bt(e)==ve}function Xa(e,r,s,c){var l=s.length,d=l,_=!c;if(e==null)return!d;for(e=Ge(e);l--;){var w=s[l];if(_&&w[2]?w[1]!==e[w[0]]:!(w[0]in e))return!1}for(;++l<d;){w=s[l];var I=w[0],F=e[I],D=w[1];if(_&&w[2]){if(F===t&&!(I in e))return!1}else{var q=new Ar;if(c)var G=c(F,D,I,e,r,q);if(!(G===t?In(D,F,z|K,c,q):G))return!1}}return!0}function su(e){if(!ot(e)||$d(e))return!1;var r=Zr(e)?Yf:_a;return r.test(Ri(e))}function Qp(e){return yt(e)&&Yt(e)==nt}function Zp(e){return yt(e)&&Bt(e)==De}function Xp(e){return yt(e)&&Ws(e.length)&&!!Ke[Yt(e)]}function au(e){return typeof e=="function"?e:e==null?ar:typeof e=="object"?fe(e)?uu(e[0],e[1]):cu(e):Ch(e)}function eo(e){if(!On(e))return rp(e);var r=[];for(var s in Ge(e))qe.call(e,s)&&s!="constructor"&&r.push(s);return r}function ed(e){if(!ot(e))return jd(e);var r=On(e),s=[];for(var c in e)c=="constructor"&&(r||!qe.call(e,c))||s.push(c);return s}function to(e,r){return e<r}function ou(e,r){var s=-1,c=nr(e)?O(e.length):[];return ci(e,function(l,d,_){c[++s]=r(l,d,_)}),c}function cu(e){var r=vo(e);return r.length==1&&r[0][2]?ku(r[0][0],r[0][1]):function(s){return s===e||Xa(s,e,r)}}function uu(e,r){return mo(e)&&Uu(r)?ku(Mr(e),r):function(s){var c=Ao(s,e);return c===t&&c===r?To(s,e):In(r,c,z|K)}}function $s(e,r,s,c,l){e!==r&&Ja(r,function(d,_){if(l||(l=new Ar),ot(d))td(e,r,_,s,$s,c,l);else{var w=c?c(bo(e,_),d,_+"",e,r,l):t;w===t&&(w=d),Ga(e,_,w)}},sr)}function td(e,r,s,c,l,d,_){var w=bo(e,s),I=bo(r,s),F=_.get(I);if(F){Ga(e,s,F);return}var D=d?d(w,I,s+"",e,r,_):t,q=D===t;if(q){var G=fe(I),ee=!G&&fi(I),ne=!G&&!ee&&rn(I);D=I,G||ee||ne?fe(w)?D=w:bt(w)?D=ir(w):ee?(q=!1,D=bu(I,!0)):ne?(q=!1,D=Eu(I,!0)):D=[]:An(I)||$i(I)?(D=w,$i(w)?D=_h(w):(!ot(w)||Zr(w))&&(D=zu(I))):q=!1}q&&(_.set(I,D),l(D,I,c,d,_),_.delete(I)),Ga(e,s,D)}function hu(e,r){var s=e.length;if(s)return r+=r<0?s:0,Qr(r,s)?e[r]:t}function lu(e,r,s){r.length?r=it(r,function(d){return fe(d)?function(_){return Ai(_,d.length===1?d[0]:d)}:d}):r=[ar];var c=-1;r=it(r,ur(ie()));var l=ou(e,function(d,_,w){var I=it(r,function(F){return F(d)});return{criteria:I,index:++c,value:d}});return Cf(l,function(d,_){return dd(d,_,s)})}function rd(e,r){return fu(e,r,function(s,c){return To(e,c)})}function fu(e,r,s){for(var c=-1,l=r.length,d={};++c<l;){var _=r[c],w=Ai(e,_);s(w,_)&&Sn(d,hi(_,e),w)}return d}function id(e){return function(r){return Ai(r,e)}}function ro(e,r,s,c){var l=c?Of:Vi,d=-1,_=r.length,w=e;for(e===r&&(r=ir(r)),s&&(w=it(e,ur(s)));++d<_;)for(var I=0,F=r[d],D=s?s(F):F;(I=l(w,D,I,c))>-1;)w!==e&&Es.call(w,I,1),Es.call(e,I,1);return e}function pu(e,r){for(var s=e?r.length:0,c=s-1;s--;){var l=r[s];if(s==c||l!==d){var d=l;Qr(l)?Es.call(e,l,1):ao(e,l)}}return e}function io(e,r){return e+Ss(Gc()*(r-e+1))}function nd(e,r,s,c){for(var l=-1,d=Lt(Is((r-e)/(s||1)),0),_=O(d);d--;)_[c?d:++l]=e,e+=s;return _}function no(e,r){var s="";if(!e||r<1||r>J)return s;do r%2&&(s+=e),r=Ss(r/2),r&&(e+=e);while(r);return s}function we(e,r){return Eo(Hu(e,r,ar),e+"")}function sd(e){return Yc(nn(e))}function ad(e,r){var s=nn(e);return ks(s,Ci(r,0,s.length))}function Sn(e,r,s,c){if(!ot(e))return e;r=hi(r,e);for(var l=-1,d=r.length,_=d-1,w=e;w!=null&&++l<d;){var I=Mr(r[l]),F=s;if(I==="__proto__"||I==="constructor"||I==="prototype")return e;if(l!=_){var D=w[I];F=c?c(D,I,w):t,F===t&&(F=ot(D)?D:Qr(r[l+1])?[]:{})}bn(w,I,F),w=w[I]}return e}var du=Ps?function(e,r){return Ps.set(e,r),e}:ar,od=xs?function(e,r){return xs(e,"toString",{configurable:!0,enumerable:!1,value:$o(r),writable:!0})}:ar;function cd(e){return ks(nn(e))}function wr(e,r,s){var c=-1,l=e.length;r<0&&(r=-r>l?0:l+r),s=s>l?l:s,s<0&&(s+=l),l=r>s?0:s-r>>>0,r>>>=0;for(var d=O(l);++c<l;)d[c]=e[c+r];return d}function ud(e,r){var s;return ci(e,function(c,l,d){return s=r(c,l,d),!s}),!!s}function Ns(e,r,s){var c=0,l=e==null?c:e.length;if(typeof r=="number"&&r===r&&l<=ke){for(;c<l;){var d=c+l>>>1,_=e[d];_!==null&&!lr(_)&&(s?_<=r:_<r)?c=d+1:l=d}return l}return so(e,r,ar,s)}function so(e,r,s,c){var l=0,d=e==null?0:e.length;if(d===0)return 0;r=s(r);for(var _=r!==r,w=r===null,I=lr(r),F=r===t;l<d;){var D=Ss((l+d)/2),q=s(e[D]),G=q!==t,ee=q===null,ne=q===q,_e=lr(q);if(_)var se=c||ne;else F?se=ne&&(c||G):w?se=ne&&G&&(c||!ee):I?se=ne&&G&&!ee&&(c||!_e):ee||_e?se=!1:se=c?q<=r:q<r;se?l=D+1:d=D}return Vt(d,ct)}function gu(e,r){for(var s=-1,c=e.length,l=0,d=[];++s<c;){var _=e[s],w=r?r(_):_;if(!s||!Tr(w,I)){var I=w;d[l++]=_===0?0:_}}return d}function yu(e){return typeof e=="number"?e:lr(e)?k:+e}function hr(e){if(typeof e=="string")return e;if(fe(e))return it(e,hr)+"";if(lr(e))return Wc?Wc.call(e):"";var r=e+"";return r=="0"&&1/e==-Te?"-0":r}function ui(e,r,s){var c=-1,l=fs,d=e.length,_=!0,w=[],I=w;if(s)_=!1,l=Fa;else if(d>=a){var F=r?null:wd(e);if(F)return ds(F);_=!1,l=gn,I=new Oi}else I=r?[]:w;e:for(;++c<d;){var D=e[c],q=r?r(D):D;if(D=s||D!==0?D:0,_&&q===q){for(var G=I.length;G--;)if(I[G]===q)continue e;r&&I.push(q),w.push(D)}else l(I,q,s)||(I!==w&&I.push(q),w.push(D))}return w}function ao(e,r){return r=hi(r,e),e=Ku(e,r),e==null||delete e[Mr(br(r))]}function vu(e,r,s,c){return Sn(e,r,s(Ai(e,r)),c)}function Fs(e,r,s,c){for(var l=e.length,d=c?l:-1;(c?d--:++d<l)&&r(e[d],d,e););return s?wr(e,c?0:d,c?d+1:l):wr(e,c?d+1:0,c?l:d)}function _u(e,r){var s=e;return s instanceof Se&&(s=s.value()),Da(r,function(c,l){return l.func.apply(l.thisArg,si([c],l.args))},s)}function oo(e,r,s){var c=e.length;if(c<2)return c?ui(e[0]):[];for(var l=-1,d=O(c);++l<c;)for(var _=e[l],w=-1;++w<c;)w!=l&&(d[l]=En(d[l]||_,e[w],r,s));return ui(Ht(d,1),r,s)}function mu(e,r,s){for(var c=-1,l=e.length,d=r.length,_={};++c<l;){var w=c<d?r[c]:t;s(_,e[c],w)}return _}function co(e){return bt(e)?e:[]}function uo(e){return typeof e=="function"?e:ar}function hi(e,r){return fe(e)?e:mo(e,r)?[e]:Wu(je(e))}var hd=we;function li(e,r,s){var c=e.length;return s=s===t?c:s,!r&&s>=c?e:wr(e,r,s)}var wu=Qf||function(e){return Pe.clearTimeout(e)};function bu(e,r){if(r)return e.slice();var s=e.length,c=kc?kc(s):new e.constructor(s);return e.copy(c),c}function ho(e){var r=new e.constructor(e.byteLength);return new ws(r).set(new ws(e)),r}function ld(e,r){var s=r?ho(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.byteLength)}function fd(e){var r=new e.constructor(e.source,dr.exec(e));return r.lastIndex=e.lastIndex,r}function pd(e){return wn?Ge(wn.call(e)):{}}function Eu(e,r){var s=r?ho(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.length)}function xu(e,r){if(e!==r){var s=e!==t,c=e===null,l=e===e,d=lr(e),_=r!==t,w=r===null,I=r===r,F=lr(r);if(!w&&!F&&!d&&e>r||d&&_&&I&&!w&&!F||c&&_&&I||!s&&I||!l)return 1;if(!c&&!d&&!F&&e<r||F&&s&&l&&!c&&!d||w&&s&&l||!_&&l||!I)return-1}return 0}function dd(e,r,s){for(var c=-1,l=e.criteria,d=r.criteria,_=l.length,w=s.length;++c<_;){var I=xu(l[c],d[c]);if(I){if(c>=w)return I;var F=s[c];return I*(F=="desc"?-1:1)}}return e.index-r.index}function Iu(e,r,s,c){for(var l=-1,d=e.length,_=s.length,w=-1,I=r.length,F=Lt(d-_,0),D=O(I+F),q=!c;++w<I;)D[w]=r[w];for(;++l<_;)(q||l<d)&&(D[s[l]]=e[l]);for(;F--;)D[w++]=e[l++];return D}function Su(e,r,s,c){for(var l=-1,d=e.length,_=-1,w=s.length,I=-1,F=r.length,D=Lt(d-w,0),q=O(D+F),G=!c;++l<D;)q[l]=e[l];for(var ee=l;++I<F;)q[ee+I]=r[I];for(;++_<w;)(G||l<d)&&(q[ee+s[_]]=e[l++]);return q}function ir(e,r){var s=-1,c=e.length;for(r||(r=O(c));++s<c;)r[s]=e[s];return r}function qr(e,r,s,c){var l=!s;s||(s={});for(var d=-1,_=r.length;++d<_;){var w=r[d],I=c?c(s[w],e[w],w,s,e):t;I===t&&(I=e[w]),l?Wr(s,w,I):bn(s,w,I)}return s}function gd(e,r){return qr(e,_o(e),r)}function yd(e,r){return qr(e,qu(e),r)}function Ds(e,r){return function(s,c){var l=fe(s)?bf:qp,d=r?r():{};return l(s,e,ie(c,2),d)}}function Xi(e){return we(function(r,s){var c=-1,l=s.length,d=l>1?s[l-1]:t,_=l>2?s[2]:t;for(d=e.length>3&&typeof d=="function"?(l--,d):t,_&&Qt(s[0],s[1],_)&&(d=l<3?t:d,l=1),r=Ge(r);++c<l;){var w=s[c];w&&e(r,w,c,d)}return r})}function Pu(e,r){return function(s,c){if(s==null)return s;if(!nr(s))return e(s,c);for(var l=s.length,d=r?l:-1,_=Ge(s);(r?d--:++d<l)&&c(_[d],d,_)!==!1;);return s}}function Ou(e){return function(r,s,c){for(var l=-1,d=Ge(r),_=c(r),w=_.length;w--;){var I=_[e?w:++l];if(s(d[I],I,d)===!1)break}return r}}function vd(e,r,s){var c=r&ae,l=Pn(e);function d(){var _=this&&this!==Pe&&this instanceof d?l:e;return _.apply(c?s:this,arguments)}return d}function Cu(e){return function(r){r=je(r);var s=Bi(r)?Cr(r):t,c=s?s[0]:r.charAt(0),l=s?li(s,1).join(""):r.slice(1);return c[e]()+l}}function en(e){return function(r){return Da(Ph(Sh(r).replace(pn,"")),e,"")}}function Pn(e){return function(){var r=arguments;switch(r.length){case 0:return new e;case 1:return new e(r[0]);case 2:return new e(r[0],r[1]);case 3:return new e(r[0],r[1],r[2]);case 4:return new e(r[0],r[1],r[2],r[3]);case 5:return new e(r[0],r[1],r[2],r[3],r[4]);case 6:return new e(r[0],r[1],r[2],r[3],r[4],r[5]);case 7:return new e(r[0],r[1],r[2],r[3],r[4],r[5],r[6])}var s=Zi(e.prototype),c=e.apply(s,r);return ot(c)?c:s}}function _d(e,r,s){var c=Pn(e);function l(){for(var d=arguments.length,_=O(d),w=d,I=tn(l);w--;)_[w]=arguments[w];var F=d<3&&_[0]!==I&&_[d-1]!==I?[]:ai(_,I);if(d-=F.length,d<s)return Nu(e,r,js,l.placeholder,t,_,F,t,t,s-d);var D=this&&this!==Pe&&this instanceof l?c:e;return Mt(D,this,_)}return l}function Au(e){return function(r,s,c){var l=Ge(r);if(!nr(r)){var d=ie(s,3);r=zt(r),s=function(w){return d(l[w],w,l)}}var _=e(r,s,c);return _>-1?l[d?r[_]:_]:t}}function Tu(e){return Yr(function(r){var s=r.length,c=s,l=_r.prototype.thru;for(e&&r.reverse();c--;){var d=r[c];if(typeof d!="function")throw new vr(f);if(l&&!_&&zs(d)=="wrapper")var _=new _r([],!0)}for(c=_?c:s;++c<s;){d=r[c];var w=zs(d),I=w=="wrapper"?yo(d):t;I&&wo(I[0])&&I[1]==(M|pe|he|W)&&!I[4].length&&I[9]==1?_=_[zs(I[0])].apply(_,I[3]):_=d.length==1&&wo(d)?_[w]():_.thru(d)}return function(){var F=arguments,D=F[0];if(_&&F.length==1&&fe(D))return _.plant(D).value();for(var q=0,G=s?r[q].apply(this,F):D;++q<s;)G=r[q].call(this,G);return G}})}function js(e,r,s,c,l,d,_,w,I,F){var D=r&M,q=r&ae,G=r&be,ee=r&(pe|ue),ne=r&ge,_e=G?t:Pn(e);function se(){for(var xe=arguments.length,Oe=O(xe),fr=xe;fr--;)Oe[fr]=arguments[fr];if(ee)var Zt=tn(se),pr=Tf(Oe,Zt);if(c&&(Oe=Iu(Oe,c,l,ee)),d&&(Oe=Su(Oe,d,_,ee)),xe-=pr,ee&&xe<F){var Et=ai(Oe,Zt);return Nu(e,r,js,se.placeholder,s,Oe,Et,w,I,F-xe)}var Rr=q?s:this,ei=G?Rr[e]:e;return xe=Oe.length,w?Oe=qd(Oe,w):ne&&xe>1&&Oe.reverse(),D&&I<xe&&(Oe.length=I),this&&this!==Pe&&this instanceof se&&(ei=_e||Pn(ei)),ei.apply(Rr,Oe)}return se}function Ru(e,r){return function(s,c){return Bp(s,e,r(c),{})}}function Ls(e,r){return function(s,c){var l;if(s===t&&c===t)return r;if(s!==t&&(l=s),c!==t){if(l===t)return c;typeof s=="string"||typeof c=="string"?(s=hr(s),c=hr(c)):(s=yu(s),c=yu(c)),l=e(s,c)}return l}}function lo(e){return Yr(function(r){return r=it(r,ur(ie())),we(function(s){var c=this;return e(r,function(l){return Mt(l,c,s)})})})}function qs(e,r){r=r===t?" ":hr(r);var s=r.length;if(s<2)return s?no(r,e):r;var c=no(r,Is(e/Gi(r)));return Bi(r)?li(Cr(c),0,e).join(""):c.slice(0,e)}function md(e,r,s,c){var l=r&ae,d=Pn(e);function _(){for(var w=-1,I=arguments.length,F=-1,D=c.length,q=O(D+I),G=this&&this!==Pe&&this instanceof _?d:e;++F<D;)q[F]=c[F];for(;I--;)q[F++]=arguments[++w];return Mt(G,l?s:this,q)}return _}function $u(e){return function(r,s,c){return c&&typeof c!="number"&&Qt(r,s,c)&&(s=c=t),r=Xr(r),s===t?(s=r,r=0):s=Xr(s),c=c===t?r<s?1:-1:Xr(c),nd(r,s,c,e)}}function Ms(e){return function(r,s){return typeof r=="string"&&typeof s=="string"||(r=Er(r),s=Er(s)),e(r,s)}}function Nu(e,r,s,c,l,d,_,w,I,F){var D=r&pe,q=D?_:t,G=D?t:_,ee=D?d:t,ne=D?t:d;r|=D?he:R,r&=~(D?R:he),r&de||(r&=~(ae|be));var _e=[e,r,l,ee,q,ne,G,w,I,F],se=s.apply(t,_e);return wo(e)&&Vu(se,_e),se.placeholder=c,Bu(se,e,r)}function fo(e){var r=jt[e];return function(s,c){if(s=Er(s),c=c==null?0:Vt(ye(c),292),c&&Bc(s)){var l=(je(s)+"e").split("e"),d=r(l[0]+"e"+(+l[1]+c));return l=(je(d)+"e").split("e"),+(l[0]+"e"+(+l[1]-c))}return r(s)}}var wd=Yi&&1/ds(new Yi([,-0]))[1]==Te?function(e){return new Yi(e)}:Do;function Fu(e){return function(r){var s=Bt(r);return s==ve?ka(r):s==De?Lf(r):Af(r,e(r))}}function Jr(e,r,s,c,l,d,_,w){var I=r&be;if(!I&&typeof e!="function")throw new vr(f);var F=c?c.length:0;if(F||(r&=~(he|R),c=l=t),_=_===t?_:Lt(ye(_),0),w=w===t?w:ye(w),F-=l?l.length:0,r&R){var D=c,q=l;c=l=t}var G=I?t:yo(e),ee=[e,r,s,c,l,D,q,d,_,w];if(G&&Dd(ee,G),e=ee[0],r=ee[1],s=ee[2],c=ee[3],l=ee[4],w=ee[9]=ee[9]===t?I?0:e.length:Lt(ee[9]-F,0),!w&&r&(pe|ue)&&(r&=~(pe|ue)),!r||r==ae)var ne=vd(e,r,s);else r==pe||r==ue?ne=_d(e,r,w):(r==he||r==(ae|he))&&!l.length?ne=md(e,r,s,c):ne=js.apply(t,ee);var _e=G?du:Vu;return Bu(_e(ne,ee),e,r)}function Du(e,r,s,c){return e===t||Tr(e,Ji[s])&&!qe.call(c,s)?r:e}function ju(e,r,s,c,l,d){return ot(e)&&ot(r)&&(d.set(r,e),$s(e,r,t,ju,d),d.delete(r)),e}function bd(e){return An(e)?t:e}function Lu(e,r,s,c,l,d){var _=s&z,w=e.length,I=r.length;if(w!=I&&!(_&&I>w))return!1;var F=d.get(e),D=d.get(r);if(F&&D)return F==r&&D==e;var q=-1,G=!0,ee=s&K?new Oi:t;for(d.set(e,r),d.set(r,e);++q<w;){var ne=e[q],_e=r[q];if(c)var se=_?c(_e,ne,q,r,e,d):c(ne,_e,q,e,r,d);if(se!==t){if(se)continue;G=!1;break}if(ee){if(!ja(r,function(xe,Oe){if(!gn(ee,Oe)&&(ne===xe||l(ne,xe,s,c,d)))return ee.push(Oe)})){G=!1;break}}else if(!(ne===_e||l(ne,_e,s,c,d))){G=!1;break}}return d.delete(e),d.delete(r),G}function Ed(e,r,s,c,l,d,_){switch(s){case He:if(e.byteLength!=r.byteLength||e.byteOffset!=r.byteOffset)return!1;e=e.buffer,r=r.buffer;case $e:return!(e.byteLength!=r.byteLength||!d(new ws(e),new ws(r)));case A:case S:case Re:return Tr(+e,+r);case b:return e.name==r.name&&e.message==r.message;case nt:case Je:return e==r+"";case ve:var w=ka;case De:var I=c&z;if(w||(w=ds),e.size!=r.size&&!I)return!1;var F=_.get(e);if(F)return F==r;c|=K,_.set(e,r);var D=Lu(w(e),w(r),c,l,d,_);return _.delete(e),D;case Ye:if(wn)return wn.call(e)==wn.call(r)}return!1}function xd(e,r,s,c,l,d){var _=s&z,w=po(e),I=w.length,F=po(r),D=F.length;if(I!=D&&!_)return!1;for(var q=I;q--;){var G=w[q];if(!(_?G in r:qe.call(r,G)))return!1}var ee=d.get(e),ne=d.get(r);if(ee&&ne)return ee==r&&ne==e;var _e=!0;d.set(e,r),d.set(r,e);for(var se=_;++q<I;){G=w[q];var xe=e[G],Oe=r[G];if(c)var fr=_?c(Oe,xe,G,r,e,d):c(xe,Oe,G,e,r,d);if(!(fr===t?xe===Oe||l(xe,Oe,s,c,d):fr)){_e=!1;break}se||(se=G=="constructor")}if(_e&&!se){var Zt=e.constructor,pr=r.constructor;Zt!=pr&&"constructor"in e&&"constructor"in r&&!(typeof Zt=="function"&&Zt instanceof Zt&&typeof pr=="function"&&pr instanceof pr)&&(_e=!1)}return d.delete(e),d.delete(r),_e}function Yr(e){return Eo(Hu(e,t,Zu),e+"")}function po(e){return iu(e,zt,_o)}function go(e){return iu(e,sr,qu)}var yo=Ps?function(e){return Ps.get(e)}:Do;function zs(e){for(var r=e.name+"",s=Qi[r],c=qe.call(Qi,r)?s.length:0;c--;){var l=s[c],d=l.func;if(d==null||d==e)return l.name}return r}function tn(e){var r=qe.call(p,"placeholder")?p:e;return r.placeholder}function ie(){var e=p.iteratee||No;return e=e===No?au:e,arguments.length?e(arguments[0],arguments[1]):e}function Us(e,r){var s=e.__data__;return Rd(r)?s[typeof r=="string"?"string":"hash"]:s.map}function vo(e){for(var r=zt(e),s=r.length;s--;){var c=r[s],l=e[c];r[s]=[c,l,Uu(l)]}return r}function Ti(e,r){var s=Ff(e,r);return su(s)?s:t}function Id(e){var r=qe.call(e,Si),s=e[Si];try{e[Si]=t;var c=!0}catch{}var l=_s.call(e);return c&&(r?e[Si]=s:delete e[Si]),l}var _o=Ka?function(e){return e==null?[]:(e=Ge(e),ni(Ka(e),function(r){return Kc.call(e,r)}))}:jo,qu=Ka?function(e){for(var r=[];e;)si(r,_o(e)),e=bs(e);return r}:jo,Bt=Yt;(Va&&Bt(new Va(new ArrayBuffer(1)))!=He||vn&&Bt(new vn)!=ve||Ba&&Bt(Ba.resolve())!=St||Yi&&Bt(new Yi)!=De||_n&&Bt(new _n)!=ze)&&(Bt=function(e){var r=Yt(e),s=r==Ie?e.constructor:t,c=s?Ri(s):"";if(c)switch(c){case ap:return He;case op:return ve;case cp:return St;case up:return De;case hp:return ze}return r});function Sd(e,r,s){for(var c=-1,l=s.length;++c<l;){var d=s[c],_=d.size;switch(d.type){case"drop":e+=_;break;case"dropRight":r-=_;break;case"take":r=Vt(r,e+_);break;case"takeRight":e=Lt(e,r-_);break}}return{start:e,end:r}}function Pd(e){var r=e.match(We);return r?r[1].split(Tt):[]}function Mu(e,r,s){r=hi(r,e);for(var c=-1,l=r.length,d=!1;++c<l;){var _=Mr(r[c]);if(!(d=e!=null&&s(e,_)))break;e=e[_]}return d||++c!=l?d:(l=e==null?0:e.length,!!l&&Ws(l)&&Qr(_,l)&&(fe(e)||$i(e)))}function Od(e){var r=e.length,s=new e.constructor(r);return r&&typeof e[0]=="string"&&qe.call(e,"index")&&(s.index=e.index,s.input=e.input),s}function zu(e){return typeof e.constructor=="function"&&!On(e)?Zi(bs(e)):{}}function Cd(e,r,s){var c=e.constructor;switch(r){case $e:return ho(e);case A:case S:return new c(+e);case He:return ld(e,s);case ut:case Le:case Pt:case Dt:case Ut:case kt:case qt:case Gt:case tr:return Eu(e,s);case ve:return new c;case Re:case Je:return new c(e);case nt:return fd(e);case De:return new c;case Ye:return pd(e)}}function Ad(e,r){var s=r.length;if(!s)return e;var c=s-1;return r[c]=(s>1?"& ":"")+r[c],r=r.join(s>2?", ":" "),e.replace(gt,`{
/* [wrapped with `+r+`] */
`)}function Td(e){return fe(e)||$i(e)||!!(Vc&&e&&e[Vc])}function Qr(e,r){var s=typeof e;return r=r??J,!!r&&(s=="number"||s!="symbol"&&wa.test(e))&&e>-1&&e%1==0&&e<r}function Qt(e,r,s){if(!ot(s))return!1;var c=typeof r;return(c=="number"?nr(s)&&Qr(r,s.length):c=="string"&&r in s)?Tr(s[r],e):!1}function mo(e,r){if(fe(e))return!1;var s=typeof e;return s=="number"||s=="symbol"||s=="boolean"||e==null||lr(e)?!0:Ot.test(e)||!rt.test(e)||r!=null&&e in Ge(r)}function Rd(e){var r=typeof e;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?e!=="__proto__":e===null}function wo(e){var r=zs(e),s=p[r];if(typeof s!="function"||!(r in Se.prototype))return!1;if(e===s)return!0;var c=yo(s);return!!c&&e===c[0]}function $d(e){return!!Uc&&Uc in e}var Nd=ys?Zr:Lo;function On(e){var r=e&&e.constructor,s=typeof r=="function"&&r.prototype||Ji;return e===s}function Uu(e){return e===e&&!ot(e)}function ku(e,r){return function(s){return s==null?!1:s[e]===r&&(r!==t||e in Ge(s))}}function Fd(e){var r=Bs(e,function(c){return s.size===v&&s.clear(),c}),s=r.cache;return r}function Dd(e,r){var s=e[1],c=r[1],l=s|c,d=l<(ae|be|M),_=c==M&&s==pe||c==M&&s==W&&e[7].length<=r[8]||c==(M|W)&&r[7].length<=r[8]&&s==pe;if(!(d||_))return e;c&ae&&(e[2]=r[2],l|=s&ae?0:de);var w=r[3];if(w){var I=e[3];e[3]=I?Iu(I,w,r[4]):w,e[4]=I?ai(e[3],P):r[4]}return w=r[5],w&&(I=e[5],e[5]=I?Su(I,w,r[6]):w,e[6]=I?ai(e[5],P):r[6]),w=r[7],w&&(e[7]=w),c&M&&(e[8]=e[8]==null?r[8]:Vt(e[8],r[8])),e[9]==null&&(e[9]=r[9]),e[0]=r[0],e[1]=l,e}function jd(e){var r=[];if(e!=null)for(var s in Ge(e))r.push(s);return r}function Ld(e){return _s.call(e)}function Hu(e,r,s){return r=Lt(r===t?e.length-1:r,0),function(){for(var c=arguments,l=-1,d=Lt(c.length-r,0),_=O(d);++l<d;)_[l]=c[r+l];l=-1;for(var w=O(r+1);++l<r;)w[l]=c[l];return w[r]=s(_),Mt(e,this,w)}}function Ku(e,r){return r.length<2?e:Ai(e,wr(r,0,-1))}function qd(e,r){for(var s=e.length,c=Vt(r.length,s),l=ir(e);c--;){var d=r[c];e[c]=Qr(d,s)?l[d]:t}return e}function bo(e,r){if(!(r==="constructor"&&typeof e[r]=="function")&&r!="__proto__")return e[r]}var Vu=Gu(du),Cn=Xf||function(e,r){return Pe.setTimeout(e,r)},Eo=Gu(od);function Bu(e,r,s){var c=r+"";return Eo(e,Ad(c,Md(Pd(c),s)))}function Gu(e){var r=0,s=0;return function(){var c=ip(),l=et-(c-s);if(s=c,l>0){if(++r>=Ae)return arguments[0]}else r=0;return e.apply(t,arguments)}}function ks(e,r){var s=-1,c=e.length,l=c-1;for(r=r===t?c:r;++s<r;){var d=io(s,l),_=e[d];e[d]=e[s],e[s]=_}return e.length=r,e}var Wu=Fd(function(e){var r=[];return e.charCodeAt(0)===46&&r.push(""),e.replace(Ct,function(s,c,l,d){r.push(l?d.replace(da,"$1"):c||s)}),r});function Mr(e){if(typeof e=="string"||lr(e))return e;var r=e+"";return r=="0"&&1/e==-Te?"-0":r}function Ri(e){if(e!=null){try{return vs.call(e)}catch{}try{return e+""}catch{}}return""}function Md(e,r){return yr(Nr,function(s){var c="_."+s[0];r&s[1]&&!fs(e,c)&&e.push(c)}),e.sort()}function Ju(e){if(e instanceof Se)return e.clone();var r=new _r(e.__wrapped__,e.__chain__);return r.__actions__=ir(e.__actions__),r.__index__=e.__index__,r.__values__=e.__values__,r}function zd(e,r,s){(s?Qt(e,r,s):r===t)?r=1:r=Lt(ye(r),0);var c=e==null?0:e.length;if(!c||r<1)return[];for(var l=0,d=0,_=O(Is(c/r));l<c;)_[d++]=wr(e,l,l+=r);return _}function Ud(e){for(var r=-1,s=e==null?0:e.length,c=0,l=[];++r<s;){var d=e[r];d&&(l[c++]=d)}return l}function kd(){var e=arguments.length;if(!e)return[];for(var r=O(e-1),s=arguments[0],c=e;c--;)r[c-1]=arguments[c];return si(fe(s)?ir(s):[s],Ht(r,1))}var Hd=we(function(e,r){return bt(e)?En(e,Ht(r,1,bt,!0)):[]}),Kd=we(function(e,r){var s=br(r);return bt(s)&&(s=t),bt(e)?En(e,Ht(r,1,bt,!0),ie(s,2)):[]}),Vd=we(function(e,r){var s=br(r);return bt(s)&&(s=t),bt(e)?En(e,Ht(r,1,bt,!0),t,s):[]});function Bd(e,r,s){var c=e==null?0:e.length;return c?(r=s||r===t?1:ye(r),wr(e,r<0?0:r,c)):[]}function Gd(e,r,s){var c=e==null?0:e.length;return c?(r=s||r===t?1:ye(r),r=c-r,wr(e,0,r<0?0:r)):[]}function Wd(e,r){return e&&e.length?Fs(e,ie(r,3),!0,!0):[]}function Jd(e,r){return e&&e.length?Fs(e,ie(r,3),!0):[]}function Yd(e,r,s,c){var l=e==null?0:e.length;return l?(s&&typeof s!="number"&&Qt(e,r,s)&&(s=0,c=l),kp(e,r,s,c)):[]}function Yu(e,r,s){var c=e==null?0:e.length;if(!c)return-1;var l=s==null?0:ye(s);return l<0&&(l=Lt(c+l,0)),ps(e,ie(r,3),l)}function Qu(e,r,s){var c=e==null?0:e.length;if(!c)return-1;var l=c-1;return s!==t&&(l=ye(s),l=s<0?Lt(c+l,0):Vt(l,c-1)),ps(e,ie(r,3),l,!0)}function Zu(e){var r=e==null?0:e.length;return r?Ht(e,1):[]}function Qd(e){var r=e==null?0:e.length;return r?Ht(e,Te):[]}function Zd(e,r){var s=e==null?0:e.length;return s?(r=r===t?1:ye(r),Ht(e,r)):[]}function Xd(e){for(var r=-1,s=e==null?0:e.length,c={};++r<s;){var l=e[r];c[l[0]]=l[1]}return c}function Xu(e){return e&&e.length?e[0]:t}function eg(e,r,s){var c=e==null?0:e.length;if(!c)return-1;var l=s==null?0:ye(s);return l<0&&(l=Lt(c+l,0)),Vi(e,r,l)}function tg(e){var r=e==null?0:e.length;return r?wr(e,0,-1):[]}var rg=we(function(e){var r=it(e,co);return r.length&&r[0]===e[0]?Za(r):[]}),ig=we(function(e){var r=br(e),s=it(e,co);return r===br(s)?r=t:s.pop(),s.length&&s[0]===e[0]?Za(s,ie(r,2)):[]}),ng=we(function(e){var r=br(e),s=it(e,co);return r=typeof r=="function"?r:t,r&&s.pop(),s.length&&s[0]===e[0]?Za(s,t,r):[]});function sg(e,r){return e==null?"":tp.call(e,r)}function br(e){var r=e==null?0:e.length;return r?e[r-1]:t}function ag(e,r,s){var c=e==null?0:e.length;if(!c)return-1;var l=c;return s!==t&&(l=ye(s),l=l<0?Lt(c+l,0):Vt(l,c-1)),r===r?Mf(e,r,l):ps(e,Nc,l,!0)}function og(e,r){return e&&e.length?hu(e,ye(r)):t}var cg=we(eh);function eh(e,r){return e&&e.length&&r&&r.length?ro(e,r):e}function ug(e,r,s){return e&&e.length&&r&&r.length?ro(e,r,ie(s,2)):e}function hg(e,r,s){return e&&e.length&&r&&r.length?ro(e,r,t,s):e}var lg=Yr(function(e,r){var s=e==null?0:e.length,c=Wa(e,r);return pu(e,it(r,function(l){return Qr(l,s)?+l:l}).sort(xu)),c});function fg(e,r){var s=[];if(!(e&&e.length))return s;var c=-1,l=[],d=e.length;for(r=ie(r,3);++c<d;){var _=e[c];r(_,c,e)&&(s.push(_),l.push(c))}return pu(e,l),s}function xo(e){return e==null?e:sp.call(e)}function pg(e,r,s){var c=e==null?0:e.length;return c?(s&&typeof s!="number"&&Qt(e,r,s)?(r=0,s=c):(r=r==null?0:ye(r),s=s===t?c:ye(s)),wr(e,r,s)):[]}function dg(e,r){return Ns(e,r)}function gg(e,r,s){return so(e,r,ie(s,2))}function yg(e,r){var s=e==null?0:e.length;if(s){var c=Ns(e,r);if(c<s&&Tr(e[c],r))return c}return-1}function vg(e,r){return Ns(e,r,!0)}function _g(e,r,s){return so(e,r,ie(s,2),!0)}function mg(e,r){var s=e==null?0:e.length;if(s){var c=Ns(e,r,!0)-1;if(Tr(e[c],r))return c}return-1}function wg(e){return e&&e.length?gu(e):[]}function bg(e,r){return e&&e.length?gu(e,ie(r,2)):[]}function Eg(e){var r=e==null?0:e.length;return r?wr(e,1,r):[]}function xg(e,r,s){return e&&e.length?(r=s||r===t?1:ye(r),wr(e,0,r<0?0:r)):[]}function Ig(e,r,s){var c=e==null?0:e.length;return c?(r=s||r===t?1:ye(r),r=c-r,wr(e,r<0?0:r,c)):[]}function Sg(e,r){return e&&e.length?Fs(e,ie(r,3),!1,!0):[]}function Pg(e,r){return e&&e.length?Fs(e,ie(r,3)):[]}var Og=we(function(e){return ui(Ht(e,1,bt,!0))}),Cg=we(function(e){var r=br(e);return bt(r)&&(r=t),ui(Ht(e,1,bt,!0),ie(r,2))}),Ag=we(function(e){var r=br(e);return r=typeof r=="function"?r:t,ui(Ht(e,1,bt,!0),t,r)});function Tg(e){return e&&e.length?ui(e):[]}function Rg(e,r){return e&&e.length?ui(e,ie(r,2)):[]}function $g(e,r){return r=typeof r=="function"?r:t,e&&e.length?ui(e,t,r):[]}function Io(e){if(!(e&&e.length))return[];var r=0;return e=ni(e,function(s){if(bt(s))return r=Lt(s.length,r),!0}),za(r,function(s){return it(e,La(s))})}function th(e,r){if(!(e&&e.length))return[];var s=Io(e);return r==null?s:it(s,function(c){return Mt(r,t,c)})}var Ng=we(function(e,r){return bt(e)?En(e,r):[]}),Fg=we(function(e){return oo(ni(e,bt))}),Dg=we(function(e){var r=br(e);return bt(r)&&(r=t),oo(ni(e,bt),ie(r,2))}),jg=we(function(e){var r=br(e);return r=typeof r=="function"?r:t,oo(ni(e,bt),t,r)}),Lg=we(Io);function qg(e,r){return mu(e||[],r||[],bn)}function Mg(e,r){return mu(e||[],r||[],Sn)}var zg=we(function(e){var r=e.length,s=r>1?e[r-1]:t;return s=typeof s=="function"?(e.pop(),s):t,th(e,s)});function rh(e){var r=p(e);return r.__chain__=!0,r}function Ug(e,r){return r(e),e}function Hs(e,r){return r(e)}var kg=Yr(function(e){var r=e.length,s=r?e[0]:0,c=this.__wrapped__,l=function(d){return Wa(d,e)};return r>1||this.__actions__.length||!(c instanceof Se)||!Qr(s)?this.thru(l):(c=c.slice(s,+s+(r?1:0)),c.__actions__.push({func:Hs,args:[l],thisArg:t}),new _r(c,this.__chain__).thru(function(d){return r&&!d.length&&d.push(t),d}))});function Hg(){return rh(this)}function Kg(){return new _r(this.value(),this.__chain__)}function Vg(){this.__values__===t&&(this.__values__=yh(this.value()));var e=this.__index__>=this.__values__.length,r=e?t:this.__values__[this.__index__++];return{done:e,value:r}}function Bg(){return this}function Gg(e){for(var r,s=this;s instanceof Cs;){var c=Ju(s);c.__index__=0,c.__values__=t,r?l.__wrapped__=c:r=c;var l=c;s=s.__wrapped__}return l.__wrapped__=e,r}function Wg(){var e=this.__wrapped__;if(e instanceof Se){var r=e;return this.__actions__.length&&(r=new Se(this)),r=r.reverse(),r.__actions__.push({func:Hs,args:[xo],thisArg:t}),new _r(r,this.__chain__)}return this.thru(xo)}function Jg(){return _u(this.__wrapped__,this.__actions__)}var Yg=Ds(function(e,r,s){qe.call(e,s)?++e[s]:Wr(e,s,1)});function Qg(e,r,s){var c=fe(e)?Rc:Up;return s&&Qt(e,r,s)&&(r=t),c(e,ie(r,3))}function Zg(e,r){var s=fe(e)?ni:tu;return s(e,ie(r,3))}var Xg=Au(Yu),ey=Au(Qu);function ty(e,r){return Ht(Ks(e,r),1)}function ry(e,r){return Ht(Ks(e,r),Te)}function iy(e,r,s){return s=s===t?1:ye(s),Ht(Ks(e,r),s)}function ih(e,r){var s=fe(e)?yr:ci;return s(e,ie(r,3))}function nh(e,r){var s=fe(e)?Ef:eu;return s(e,ie(r,3))}var ny=Ds(function(e,r,s){qe.call(e,s)?e[s].push(r):Wr(e,s,[r])});function sy(e,r,s,c){e=nr(e)?e:nn(e),s=s&&!c?ye(s):0;var l=e.length;return s<0&&(s=Lt(l+s,0)),Js(e)?s<=l&&e.indexOf(r,s)>-1:!!l&&Vi(e,r,s)>-1}var ay=we(function(e,r,s){var c=-1,l=typeof r=="function",d=nr(e)?O(e.length):[];return ci(e,function(_){d[++c]=l?Mt(r,_,s):xn(_,r,s)}),d}),oy=Ds(function(e,r,s){Wr(e,s,r)});function Ks(e,r){var s=fe(e)?it:ou;return s(e,ie(r,3))}function cy(e,r,s,c){return e==null?[]:(fe(r)||(r=r==null?[]:[r]),s=c?t:s,fe(s)||(s=s==null?[]:[s]),lu(e,r,s))}var uy=Ds(function(e,r,s){e[s?0:1].push(r)},function(){return[[],[]]});function hy(e,r,s){var c=fe(e)?Da:Dc,l=arguments.length<3;return c(e,ie(r,4),s,l,ci)}function ly(e,r,s){var c=fe(e)?xf:Dc,l=arguments.length<3;return c(e,ie(r,4),s,l,eu)}function fy(e,r){var s=fe(e)?ni:tu;return s(e,Gs(ie(r,3)))}function py(e){var r=fe(e)?Yc:sd;return r(e)}function dy(e,r,s){(s?Qt(e,r,s):r===t)?r=1:r=ye(r);var c=fe(e)?jp:ad;return c(e,r)}function gy(e){var r=fe(e)?Lp:cd;return r(e)}function yy(e){if(e==null)return 0;if(nr(e))return Js(e)?Gi(e):e.length;var r=Bt(e);return r==ve||r==De?e.size:eo(e).length}function vy(e,r,s){var c=fe(e)?ja:ud;return s&&Qt(e,r,s)&&(r=t),c(e,ie(r,3))}var _y=we(function(e,r){if(e==null)return[];var s=r.length;return s>1&&Qt(e,r[0],r[1])?r=[]:s>2&&Qt(r[0],r[1],r[2])&&(r=[r[0]]),lu(e,Ht(r,1),[])}),Vs=Zf||function(){return Pe.Date.now()};function my(e,r){if(typeof r!="function")throw new vr(f);return e=ye(e),function(){if(--e<1)return r.apply(this,arguments)}}function sh(e,r,s){return r=s?t:r,r=e&&r==null?e.length:r,Jr(e,M,t,t,t,t,r)}function ah(e,r){var s;if(typeof r!="function")throw new vr(f);return e=ye(e),function(){return--e>0&&(s=r.apply(this,arguments)),e<=1&&(r=t),s}}var So=we(function(e,r,s){var c=ae;if(s.length){var l=ai(s,tn(So));c|=he}return Jr(e,c,r,s,l)}),oh=we(function(e,r,s){var c=ae|be;if(s.length){var l=ai(s,tn(oh));c|=he}return Jr(r,c,e,s,l)});function ch(e,r,s){r=s?t:r;var c=Jr(e,pe,t,t,t,t,t,r);return c.placeholder=ch.placeholder,c}function uh(e,r,s){r=s?t:r;var c=Jr(e,ue,t,t,t,t,t,r);return c.placeholder=uh.placeholder,c}function hh(e,r,s){var c,l,d,_,w,I,F=0,D=!1,q=!1,G=!0;if(typeof e!="function")throw new vr(f);r=Er(r)||0,ot(s)&&(D=!!s.leading,q="maxWait"in s,d=q?Lt(Er(s.maxWait)||0,r):d,G="trailing"in s?!!s.trailing:G);function ee(Et){var Rr=c,ei=l;return c=l=t,F=Et,_=e.apply(ei,Rr),_}function ne(Et){return F=Et,w=Cn(xe,r),D?ee(Et):_}function _e(Et){var Rr=Et-I,ei=Et-F,Ah=r-Rr;return q?Vt(Ah,d-ei):Ah}function se(Et){var Rr=Et-I,ei=Et-F;return I===t||Rr>=r||Rr<0||q&&ei>=d}function xe(){var Et=Vs();if(se(Et))return Oe(Et);w=Cn(xe,_e(Et))}function Oe(Et){return w=t,G&&c?ee(Et):(c=l=t,_)}function fr(){w!==t&&wu(w),F=0,c=I=l=w=t}function Zt(){return w===t?_:Oe(Vs())}function pr(){var Et=Vs(),Rr=se(Et);if(c=arguments,l=this,I=Et,Rr){if(w===t)return ne(I);if(q)return wu(w),w=Cn(xe,r),ee(I)}return w===t&&(w=Cn(xe,r)),_}return pr.cancel=fr,pr.flush=Zt,pr}var wy=we(function(e,r){return Xc(e,1,r)}),by=we(function(e,r,s){return Xc(e,Er(r)||0,s)});function Ey(e){return Jr(e,ge)}function Bs(e,r){if(typeof e!="function"||r!=null&&typeof r!="function")throw new vr(f);var s=function(){var c=arguments,l=r?r.apply(this,c):c[0],d=s.cache;if(d.has(l))return d.get(l);var _=e.apply(this,c);return s.cache=d.set(l,_)||d,_};return s.cache=new(Bs.Cache||Gr),s}Bs.Cache=Gr;function Gs(e){if(typeof e!="function")throw new vr(f);return function(){var r=arguments;switch(r.length){case 0:return!e.call(this);case 1:return!e.call(this,r[0]);case 2:return!e.call(this,r[0],r[1]);case 3:return!e.call(this,r[0],r[1],r[2])}return!e.apply(this,r)}}function xy(e){return ah(2,e)}var Iy=hd(function(e,r){r=r.length==1&&fe(r[0])?it(r[0],ur(ie())):it(Ht(r,1),ur(ie()));var s=r.length;return we(function(c){for(var l=-1,d=Vt(c.length,s);++l<d;)c[l]=r[l].call(this,c[l]);return Mt(e,this,c)})}),Po=we(function(e,r){var s=ai(r,tn(Po));return Jr(e,he,t,r,s)}),lh=we(function(e,r){var s=ai(r,tn(lh));return Jr(e,R,t,r,s)}),Sy=Yr(function(e,r){return Jr(e,W,t,t,t,r)});function Py(e,r){if(typeof e!="function")throw new vr(f);return r=r===t?r:ye(r),we(e,r)}function Oy(e,r){if(typeof e!="function")throw new vr(f);return r=r==null?0:Lt(ye(r),0),we(function(s){var c=s[r],l=li(s,0,r);return c&&si(l,c),Mt(e,this,l)})}function Cy(e,r,s){var c=!0,l=!0;if(typeof e!="function")throw new vr(f);return ot(s)&&(c="leading"in s?!!s.leading:c,l="trailing"in s?!!s.trailing:l),hh(e,r,{leading:c,maxWait:r,trailing:l})}function Ay(e){return sh(e,1)}function Ty(e,r){return Po(uo(r),e)}function Ry(){if(!arguments.length)return[];var e=arguments[0];return fe(e)?e:[e]}function $y(e){return mr(e,U)}function Ny(e,r){return r=typeof r=="function"?r:t,mr(e,U,r)}function Fy(e){return mr(e,H|U)}function Dy(e,r){return r=typeof r=="function"?r:t,mr(e,H|U,r)}function jy(e,r){return r==null||Zc(e,r,zt(r))}function Tr(e,r){return e===r||e!==e&&r!==r}var Ly=Ms(Qa),qy=Ms(function(e,r){return e>=r}),$i=nu(function(){return arguments}())?nu:function(e){return yt(e)&&qe.call(e,"callee")&&!Kc.call(e,"callee")},fe=O.isArray,My=Jt?ur(Jt):Gp;function nr(e){return e!=null&&Ws(e.length)&&!Zr(e)}function bt(e){return yt(e)&&nr(e)}function zy(e){return e===!0||e===!1||yt(e)&&Yt(e)==A}var fi=ep||Lo,Uy=Or?ur(Or):Wp;function ky(e){return yt(e)&&e.nodeType===1&&!An(e)}function Hy(e){if(e==null)return!0;if(nr(e)&&(fe(e)||typeof e=="string"||typeof e.splice=="function"||fi(e)||rn(e)||$i(e)))return!e.length;var r=Bt(e);if(r==ve||r==De)return!e.size;if(On(e))return!eo(e).length;for(var s in e)if(qe.call(e,s))return!1;return!0}function Ky(e,r){return In(e,r)}function Vy(e,r,s){s=typeof s=="function"?s:t;var c=s?s(e,r):t;return c===t?In(e,r,t,s):!!c}function Oo(e){if(!yt(e))return!1;var r=Yt(e);return r==b||r==h||typeof e.message=="string"&&typeof e.name=="string"&&!An(e)}function By(e){return typeof e=="number"&&Bc(e)}function Zr(e){if(!ot(e))return!1;var r=Yt(e);return r==X||r==oe||r==T||r==_t}function fh(e){return typeof e=="number"&&e==ye(e)}function Ws(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=J}function ot(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}function yt(e){return e!=null&&typeof e=="object"}var ph=gr?ur(gr):Yp;function Gy(e,r){return e===r||Xa(e,r,vo(r))}function Wy(e,r,s){return s=typeof s=="function"?s:t,Xa(e,r,vo(r),s)}function Jy(e){return dh(e)&&e!=+e}function Yy(e){if(Nd(e))throw new ce(u);return su(e)}function Qy(e){return e===null}function Zy(e){return e==null}function dh(e){return typeof e=="number"||yt(e)&&Yt(e)==Re}function An(e){if(!yt(e)||Yt(e)!=Ie)return!1;var r=bs(e);if(r===null)return!0;var s=qe.call(r,"constructor")&&r.constructor;return typeof s=="function"&&s instanceof s&&vs.call(s)==Wf}var Co=jr?ur(jr):Qp;function Xy(e){return fh(e)&&e>=-J&&e<=J}var gh=dn?ur(dn):Zp;function Js(e){return typeof e=="string"||!fe(e)&&yt(e)&&Yt(e)==Je}function lr(e){return typeof e=="symbol"||yt(e)&&Yt(e)==Ye}var rn=Ii?ur(Ii):Xp;function e0(e){return e===t}function t0(e){return yt(e)&&Bt(e)==ze}function r0(e){return yt(e)&&Yt(e)==Qe}var i0=Ms(to),n0=Ms(function(e,r){return e<=r});function yh(e){if(!e)return[];if(nr(e))return Js(e)?Cr(e):ir(e);if(yn&&e[yn])return jf(e[yn]());var r=Bt(e),s=r==ve?ka:r==De?ds:nn;return s(e)}function Xr(e){if(!e)return e===0?e:0;if(e=Er(e),e===Te||e===-Te){var r=e<0?-1:1;return r*V}return e===e?e:0}function ye(e){var r=Xr(e),s=r%1;return r===r?s?r-s:r:0}function vh(e){return e?Ci(ye(e),0,B):0}function Er(e){if(typeof e=="number")return e;if(lr(e))return k;if(ot(e)){var r=typeof e.valueOf=="function"?e.valueOf():e;e=ot(r)?r+"":r}if(typeof e!="string")return e===0?e:+e;e=jc(e);var s=va.test(e);return s||ma.test(e)?le(e.slice(2),s?2:8):ya.test(e)?k:+e}function _h(e){return qr(e,sr(e))}function s0(e){return e?Ci(ye(e),-J,J):e===0?e:0}function je(e){return e==null?"":hr(e)}var a0=Xi(function(e,r){if(On(r)||nr(r)){qr(r,zt(r),e);return}for(var s in r)qe.call(r,s)&&bn(e,s,r[s])}),mh=Xi(function(e,r){qr(r,sr(r),e)}),Ys=Xi(function(e,r,s,c){qr(r,sr(r),e,c)}),o0=Xi(function(e,r,s,c){qr(r,zt(r),e,c)}),c0=Yr(Wa);function u0(e,r){var s=Zi(e);return r==null?s:Qc(s,r)}var h0=we(function(e,r){e=Ge(e);var s=-1,c=r.length,l=c>2?r[2]:t;for(l&&Qt(r[0],r[1],l)&&(c=1);++s<c;)for(var d=r[s],_=sr(d),w=-1,I=_.length;++w<I;){var F=_[w],D=e[F];(D===t||Tr(D,Ji[F])&&!qe.call(e,F))&&(e[F]=d[F])}return e}),l0=we(function(e){return e.push(t,ju),Mt(wh,t,e)});function f0(e,r){return $c(e,ie(r,3),Lr)}function p0(e,r){return $c(e,ie(r,3),Ya)}function d0(e,r){return e==null?e:Ja(e,ie(r,3),sr)}function g0(e,r){return e==null?e:ru(e,ie(r,3),sr)}function y0(e,r){return e&&Lr(e,ie(r,3))}function v0(e,r){return e&&Ya(e,ie(r,3))}function _0(e){return e==null?[]:Rs(e,zt(e))}function m0(e){return e==null?[]:Rs(e,sr(e))}function Ao(e,r,s){var c=e==null?t:Ai(e,r);return c===t?s:c}function w0(e,r){return e!=null&&Mu(e,r,Hp)}function To(e,r){return e!=null&&Mu(e,r,Kp)}var b0=Ru(function(e,r,s){r!=null&&typeof r.toString!="function"&&(r=_s.call(r)),e[r]=s},$o(ar)),E0=Ru(function(e,r,s){r!=null&&typeof r.toString!="function"&&(r=_s.call(r)),qe.call(e,r)?e[r].push(s):e[r]=[s]},ie),x0=we(xn);function zt(e){return nr(e)?Jc(e):eo(e)}function sr(e){return nr(e)?Jc(e,!0):ed(e)}function I0(e,r){var s={};return r=ie(r,3),Lr(e,function(c,l,d){Wr(s,r(c,l,d),c)}),s}function S0(e,r){var s={};return r=ie(r,3),Lr(e,function(c,l,d){Wr(s,l,r(c,l,d))}),s}var P0=Xi(function(e,r,s){$s(e,r,s)}),wh=Xi(function(e,r,s,c){$s(e,r,s,c)}),O0=Yr(function(e,r){var s={};if(e==null)return s;var c=!1;r=it(r,function(d){return d=hi(d,e),c||(c=d.length>1),d}),qr(e,go(e),s),c&&(s=mr(s,H|N|U,bd));for(var l=r.length;l--;)ao(s,r[l]);return s});function C0(e,r){return bh(e,Gs(ie(r)))}var A0=Yr(function(e,r){return e==null?{}:rd(e,r)});function bh(e,r){if(e==null)return{};var s=it(go(e),function(c){return[c]});return r=ie(r),fu(e,s,function(c,l){return r(c,l[0])})}function T0(e,r,s){r=hi(r,e);var c=-1,l=r.length;for(l||(l=1,e=t);++c<l;){var d=e==null?t:e[Mr(r[c])];d===t&&(c=l,d=s),e=Zr(d)?d.call(e):d}return e}function R0(e,r,s){return e==null?e:Sn(e,r,s)}function $0(e,r,s,c){return c=typeof c=="function"?c:t,e==null?e:Sn(e,r,s,c)}var Eh=Fu(zt),xh=Fu(sr);function N0(e,r,s){var c=fe(e),l=c||fi(e)||rn(e);if(r=ie(r,4),s==null){var d=e&&e.constructor;l?s=c?new d:[]:ot(e)?s=Zr(d)?Zi(bs(e)):{}:s={}}return(l?yr:Lr)(e,function(_,w,I){return r(s,_,w,I)}),s}function F0(e,r){return e==null?!0:ao(e,r)}function D0(e,r,s){return e==null?e:vu(e,r,uo(s))}function j0(e,r,s,c){return c=typeof c=="function"?c:t,e==null?e:vu(e,r,uo(s),c)}function nn(e){return e==null?[]:Ua(e,zt(e))}function L0(e){return e==null?[]:Ua(e,sr(e))}function q0(e,r,s){return s===t&&(s=r,r=t),s!==t&&(s=Er(s),s=s===s?s:0),r!==t&&(r=Er(r),r=r===r?r:0),Ci(Er(e),r,s)}function M0(e,r,s){return r=Xr(r),s===t?(s=r,r=0):s=Xr(s),e=Er(e),Vp(e,r,s)}function z0(e,r,s){if(s&&typeof s!="boolean"&&Qt(e,r,s)&&(r=s=t),s===t&&(typeof r=="boolean"?(s=r,r=t):typeof e=="boolean"&&(s=e,e=t)),e===t&&r===t?(e=0,r=1):(e=Xr(e),r===t?(r=e,e=0):r=Xr(r)),e>r){var c=e;e=r,r=c}if(s||e%1||r%1){var l=Gc();return Vt(e+l*(r-e+Ve("1e-"+((l+"").length-1))),r)}return io(e,r)}var U0=en(function(e,r,s){return r=r.toLowerCase(),e+(s?Ih(r):r)});function Ih(e){return Ro(je(e).toLowerCase())}function Sh(e){return e=je(e),e&&e.replace(Kr,Rf).replace($a,"")}function k0(e,r,s){e=je(e),r=hr(r);var c=e.length;s=s===t?c:Ci(ye(s),0,c);var l=s;return s-=r.length,s>=0&&e.slice(s,l)==r}function H0(e){return e=je(e),e&&tt.test(e)?e.replace(mi,$f):e}function K0(e){return e=je(e),e&&At.test(e)?e.replace(pt,"\\$&"):e}var V0=en(function(e,r,s){return e+(s?"-":"")+r.toLowerCase()}),B0=en(function(e,r,s){return e+(s?" ":"")+r.toLowerCase()}),G0=Cu("toLowerCase");function W0(e,r,s){e=je(e),r=ye(r);var c=r?Gi(e):0;if(!r||c>=r)return e;var l=(r-c)/2;return qs(Ss(l),s)+e+qs(Is(l),s)}function J0(e,r,s){e=je(e),r=ye(r);var c=r?Gi(e):0;return r&&c<r?e+qs(r-c,s):e}function Y0(e,r,s){e=je(e),r=ye(r);var c=r?Gi(e):0;return r&&c<r?qs(r-c,s)+e:e}function Q0(e,r,s){return s||r==null?r=0:r&&(r=+r),np(je(e).replace(dt,""),r||0)}function Z0(e,r,s){return(s?Qt(e,r,s):r===t)?r=1:r=ye(r),no(je(e),r)}function X0(){var e=arguments,r=je(e[0]);return e.length<3?r:r.replace(e[1],e[2])}var ev=en(function(e,r,s){return e+(s?"_":"")+r.toLowerCase()});function tv(e,r,s){return s&&typeof s!="number"&&Qt(e,r,s)&&(r=s=t),s=s===t?B:s>>>0,s?(e=je(e),e&&(typeof r=="string"||r!=null&&!Co(r))&&(r=hr(r),!r&&Bi(e))?li(Cr(e),0,s):e.split(r,s)):[]}var rv=en(function(e,r,s){return e+(s?" ":"")+Ro(r)});function iv(e,r,s){return e=je(e),s=s==null?0:Ci(ye(s),0,e.length),r=hr(r),e.slice(s,s+r.length)==r}function nv(e,r,s){var c=p.templateSettings;s&&Qt(e,r,s)&&(r=t),e=je(e),r=Ys({},r,c,Du);var l=Ys({},r.imports,c.imports,Du),d=zt(l),_=Ua(l,d),w,I,F=0,D=r.interpolate||qi,q="__p += '",G=Ha((r.escape||qi).source+"|"+D.source+"|"+(D===at?ga:qi).source+"|"+(r.evaluate||qi).source+"|$","g"),ee="//# sourceURL="+(qe.call(r,"sourceURL")?(r.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Na+"]")+`
`;e.replace(G,function(se,xe,Oe,fr,Zt,pr){return Oe||(Oe=fr),q+=e.slice(F,pr).replace(ba,Nf),xe&&(w=!0,q+=`' +
__e(`+xe+`) +
'`),Zt&&(I=!0,q+=`';
`+Zt+`;
__p += '`),Oe&&(q+=`' +
((__t = (`+Oe+`)) == null ? '' : __t) +
'`),F=pr+se.length,se}),q+=`';
`;var ne=qe.call(r,"variable")&&r.variable;if(!ne)q=`with (obj) {
`+q+`
}
`;else if(pa.test(ne))throw new ce(g);q=(I?q.replace(Fr,""):q).replace(Wt,"$1").replace(Hr,"$1;"),q="function("+(ne||"obj")+`) {
`+(ne?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(w?", __e = _.escape":"")+(I?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+q+`return __p
}`;var _e=Oh(function(){return Fe(d,ee+"return "+q).apply(t,_)});if(_e.source=q,Oo(_e))throw _e;return _e}function sv(e){return je(e).toLowerCase()}function av(e){return je(e).toUpperCase()}function ov(e,r,s){if(e=je(e),e&&(s||r===t))return jc(e);if(!e||!(r=hr(r)))return e;var c=Cr(e),l=Cr(r),d=Lc(c,l),_=qc(c,l)+1;return li(c,d,_).join("")}function cv(e,r,s){if(e=je(e),e&&(s||r===t))return e.slice(0,zc(e)+1);if(!e||!(r=hr(r)))return e;var c=Cr(e),l=qc(c,Cr(r))+1;return li(c,0,l).join("")}function uv(e,r,s){if(e=je(e),e&&(s||r===t))return e.replace(dt,"");if(!e||!(r=hr(r)))return e;var c=Cr(e),l=Lc(c,Cr(r));return li(c,l).join("")}function hv(e,r){var s=te,c=Ee;if(ot(r)){var l="separator"in r?r.separator:l;s="length"in r?ye(r.length):s,c="omission"in r?hr(r.omission):c}e=je(e);var d=e.length;if(Bi(e)){var _=Cr(e);d=_.length}if(s>=d)return e;var w=s-Gi(c);if(w<1)return c;var I=_?li(_,0,w).join(""):e.slice(0,w);if(l===t)return I+c;if(_&&(w+=I.length-w),Co(l)){if(e.slice(w).search(l)){var F,D=I;for(l.global||(l=Ha(l.source,je(dr.exec(l))+"g")),l.lastIndex=0;F=l.exec(D);)var q=F.index;I=I.slice(0,q===t?w:q)}}else if(e.indexOf(hr(l),w)!=w){var G=I.lastIndexOf(l);G>-1&&(I=I.slice(0,G))}return I+c}function lv(e){return e=je(e),e&&ht.test(e)?e.replace(ri,zf):e}var fv=en(function(e,r,s){return e+(s?" ":"")+r.toUpperCase()}),Ro=Cu("toUpperCase");function Ph(e,r,s){return e=je(e),r=s?t:r,r===t?Df(e)?Hf(e):Pf(e):e.match(r)||[]}var Oh=we(function(e,r){try{return Mt(e,t,r)}catch(s){return Oo(s)?s:new ce(s)}}),pv=Yr(function(e,r){return yr(r,function(s){s=Mr(s),Wr(e,s,So(e[s],e))}),e});function dv(e){var r=e==null?0:e.length,s=ie();return e=r?it(e,function(c){if(typeof c[1]!="function")throw new vr(f);return[s(c[0]),c[1]]}):[],we(function(c){for(var l=-1;++l<r;){var d=e[l];if(Mt(d[0],this,c))return Mt(d[1],this,c)}})}function gv(e){return zp(mr(e,H))}function $o(e){return function(){return e}}function yv(e,r){return e==null||e!==e?r:e}var vv=Tu(),_v=Tu(!0);function ar(e){return e}function No(e){return au(typeof e=="function"?e:mr(e,H))}function mv(e){return cu(mr(e,H))}function wv(e,r){return uu(e,mr(r,H))}var bv=we(function(e,r){return function(s){return xn(s,e,r)}}),Ev=we(function(e,r){return function(s){return xn(e,s,r)}});function Fo(e,r,s){var c=zt(r),l=Rs(r,c);s==null&&!(ot(r)&&(l.length||!c.length))&&(s=r,r=e,e=this,l=Rs(r,zt(r)));var d=!(ot(s)&&"chain"in s)||!!s.chain,_=Zr(e);return yr(l,function(w){var I=r[w];e[w]=I,_&&(e.prototype[w]=function(){var F=this.__chain__;if(d||F){var D=e(this.__wrapped__),q=D.__actions__=ir(this.__actions__);return q.push({func:I,args:arguments,thisArg:e}),D.__chain__=F,D}return I.apply(e,si([this.value()],arguments))})}),e}function xv(){return Pe._===this&&(Pe._=Jf),this}function Do(){}function Iv(e){return e=ye(e),we(function(r){return hu(r,e)})}var Sv=lo(it),Pv=lo(Rc),Ov=lo(ja);function Ch(e){return mo(e)?La(Mr(e)):id(e)}function Cv(e){return function(r){return e==null?t:Ai(e,r)}}var Av=$u(),Tv=$u(!0);function jo(){return[]}function Lo(){return!1}function Rv(){return{}}function $v(){return""}function Nv(){return!0}function Fv(e,r){if(e=ye(e),e<1||e>J)return[];var s=B,c=Vt(e,B);r=ie(r),e-=B;for(var l=za(c,r);++s<e;)r(s);return l}function Dv(e){return fe(e)?it(e,Mr):lr(e)?[e]:ir(Wu(je(e)))}function jv(e){var r=++Gf;return je(e)+r}var Lv=Ls(function(e,r){return e+r},0),qv=fo("ceil"),Mv=Ls(function(e,r){return e/r},1),zv=fo("floor");function Uv(e){return e&&e.length?Ts(e,ar,Qa):t}function kv(e,r){return e&&e.length?Ts(e,ie(r,2),Qa):t}function Hv(e){return Fc(e,ar)}function Kv(e,r){return Fc(e,ie(r,2))}function Vv(e){return e&&e.length?Ts(e,ar,to):t}function Bv(e,r){return e&&e.length?Ts(e,ie(r,2),to):t}var Gv=Ls(function(e,r){return e*r},1),Wv=fo("round"),Jv=Ls(function(e,r){return e-r},0);function Yv(e){return e&&e.length?Ma(e,ar):0}function Qv(e,r){return e&&e.length?Ma(e,ie(r,2)):0}return p.after=my,p.ary=sh,p.assign=a0,p.assignIn=mh,p.assignInWith=Ys,p.assignWith=o0,p.at=c0,p.before=ah,p.bind=So,p.bindAll=pv,p.bindKey=oh,p.castArray=Ry,p.chain=rh,p.chunk=zd,p.compact=Ud,p.concat=kd,p.cond=dv,p.conforms=gv,p.constant=$o,p.countBy=Yg,p.create=u0,p.curry=ch,p.curryRight=uh,p.debounce=hh,p.defaults=h0,p.defaultsDeep=l0,p.defer=wy,p.delay=by,p.difference=Hd,p.differenceBy=Kd,p.differenceWith=Vd,p.drop=Bd,p.dropRight=Gd,p.dropRightWhile=Wd,p.dropWhile=Jd,p.fill=Yd,p.filter=Zg,p.flatMap=ty,p.flatMapDeep=ry,p.flatMapDepth=iy,p.flatten=Zu,p.flattenDeep=Qd,p.flattenDepth=Zd,p.flip=Ey,p.flow=vv,p.flowRight=_v,p.fromPairs=Xd,p.functions=_0,p.functionsIn=m0,p.groupBy=ny,p.initial=tg,p.intersection=rg,p.intersectionBy=ig,p.intersectionWith=ng,p.invert=b0,p.invertBy=E0,p.invokeMap=ay,p.iteratee=No,p.keyBy=oy,p.keys=zt,p.keysIn=sr,p.map=Ks,p.mapKeys=I0,p.mapValues=S0,p.matches=mv,p.matchesProperty=wv,p.memoize=Bs,p.merge=P0,p.mergeWith=wh,p.method=bv,p.methodOf=Ev,p.mixin=Fo,p.negate=Gs,p.nthArg=Iv,p.omit=O0,p.omitBy=C0,p.once=xy,p.orderBy=cy,p.over=Sv,p.overArgs=Iy,p.overEvery=Pv,p.overSome=Ov,p.partial=Po,p.partialRight=lh,p.partition=uy,p.pick=A0,p.pickBy=bh,p.property=Ch,p.propertyOf=Cv,p.pull=cg,p.pullAll=eh,p.pullAllBy=ug,p.pullAllWith=hg,p.pullAt=lg,p.range=Av,p.rangeRight=Tv,p.rearg=Sy,p.reject=fy,p.remove=fg,p.rest=Py,p.reverse=xo,p.sampleSize=dy,p.set=R0,p.setWith=$0,p.shuffle=gy,p.slice=pg,p.sortBy=_y,p.sortedUniq=wg,p.sortedUniqBy=bg,p.split=tv,p.spread=Oy,p.tail=Eg,p.take=xg,p.takeRight=Ig,p.takeRightWhile=Sg,p.takeWhile=Pg,p.tap=Ug,p.throttle=Cy,p.thru=Hs,p.toArray=yh,p.toPairs=Eh,p.toPairsIn=xh,p.toPath=Dv,p.toPlainObject=_h,p.transform=N0,p.unary=Ay,p.union=Og,p.unionBy=Cg,p.unionWith=Ag,p.uniq=Tg,p.uniqBy=Rg,p.uniqWith=$g,p.unset=F0,p.unzip=Io,p.unzipWith=th,p.update=D0,p.updateWith=j0,p.values=nn,p.valuesIn=L0,p.without=Ng,p.words=Ph,p.wrap=Ty,p.xor=Fg,p.xorBy=Dg,p.xorWith=jg,p.zip=Lg,p.zipObject=qg,p.zipObjectDeep=Mg,p.zipWith=zg,p.entries=Eh,p.entriesIn=xh,p.extend=mh,p.extendWith=Ys,Fo(p,p),p.add=Lv,p.attempt=Oh,p.camelCase=U0,p.capitalize=Ih,p.ceil=qv,p.clamp=q0,p.clone=$y,p.cloneDeep=Fy,p.cloneDeepWith=Dy,p.cloneWith=Ny,p.conformsTo=jy,p.deburr=Sh,p.defaultTo=yv,p.divide=Mv,p.endsWith=k0,p.eq=Tr,p.escape=H0,p.escapeRegExp=K0,p.every=Qg,p.find=Xg,p.findIndex=Yu,p.findKey=f0,p.findLast=ey,p.findLastIndex=Qu,p.findLastKey=p0,p.floor=zv,p.forEach=ih,p.forEachRight=nh,p.forIn=d0,p.forInRight=g0,p.forOwn=y0,p.forOwnRight=v0,p.get=Ao,p.gt=Ly,p.gte=qy,p.has=w0,p.hasIn=To,p.head=Xu,p.identity=ar,p.includes=sy,p.indexOf=eg,p.inRange=M0,p.invoke=x0,p.isArguments=$i,p.isArray=fe,p.isArrayBuffer=My,p.isArrayLike=nr,p.isArrayLikeObject=bt,p.isBoolean=zy,p.isBuffer=fi,p.isDate=Uy,p.isElement=ky,p.isEmpty=Hy,p.isEqual=Ky,p.isEqualWith=Vy,p.isError=Oo,p.isFinite=By,p.isFunction=Zr,p.isInteger=fh,p.isLength=Ws,p.isMap=ph,p.isMatch=Gy,p.isMatchWith=Wy,p.isNaN=Jy,p.isNative=Yy,p.isNil=Zy,p.isNull=Qy,p.isNumber=dh,p.isObject=ot,p.isObjectLike=yt,p.isPlainObject=An,p.isRegExp=Co,p.isSafeInteger=Xy,p.isSet=gh,p.isString=Js,p.isSymbol=lr,p.isTypedArray=rn,p.isUndefined=e0,p.isWeakMap=t0,p.isWeakSet=r0,p.join=sg,p.kebabCase=V0,p.last=br,p.lastIndexOf=ag,p.lowerCase=B0,p.lowerFirst=G0,p.lt=i0,p.lte=n0,p.max=Uv,p.maxBy=kv,p.mean=Hv,p.meanBy=Kv,p.min=Vv,p.minBy=Bv,p.stubArray=jo,p.stubFalse=Lo,p.stubObject=Rv,p.stubString=$v,p.stubTrue=Nv,p.multiply=Gv,p.nth=og,p.noConflict=xv,p.noop=Do,p.now=Vs,p.pad=W0,p.padEnd=J0,p.padStart=Y0,p.parseInt=Q0,p.random=z0,p.reduce=hy,p.reduceRight=ly,p.repeat=Z0,p.replace=X0,p.result=T0,p.round=Wv,p.runInContext=x,p.sample=py,p.size=yy,p.snakeCase=ev,p.some=vy,p.sortedIndex=dg,p.sortedIndexBy=gg,p.sortedIndexOf=yg,p.sortedLastIndex=vg,p.sortedLastIndexBy=_g,p.sortedLastIndexOf=mg,p.startCase=rv,p.startsWith=iv,p.subtract=Jv,p.sum=Yv,p.sumBy=Qv,p.template=nv,p.times=Fv,p.toFinite=Xr,p.toInteger=ye,p.toLength=vh,p.toLower=sv,p.toNumber=Er,p.toSafeInteger=s0,p.toString=je,p.toUpper=av,p.trim=ov,p.trimEnd=cv,p.trimStart=uv,p.truncate=hv,p.unescape=lv,p.uniqueId=jv,p.upperCase=fv,p.upperFirst=Ro,p.each=ih,p.eachRight=nh,p.first=Xu,Fo(p,function(){var e={};return Lr(p,function(r,s){qe.call(p.prototype,s)||(e[s]=r)}),e}(),{chain:!1}),p.VERSION=n,yr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){p[e].placeholder=p}),yr(["drop","take"],function(e,r){Se.prototype[e]=function(s){s=s===t?1:Lt(ye(s),0);var c=this.__filtered__&&!r?new Se(this):this.clone();return c.__filtered__?c.__takeCount__=Vt(s,c.__takeCount__):c.__views__.push({size:Vt(s,B),type:e+(c.__dir__<0?"Right":"")}),c},Se.prototype[e+"Right"]=function(s){return this.reverse()[e](s).reverse()}}),yr(["filter","map","takeWhile"],function(e,r){var s=r+1,c=s==C||s==Me;Se.prototype[e]=function(l){var d=this.clone();return d.__iteratees__.push({iteratee:ie(l,3),type:s}),d.__filtered__=d.__filtered__||c,d}}),yr(["head","last"],function(e,r){var s="take"+(r?"Right":"");Se.prototype[e]=function(){return this[s](1).value()[0]}}),yr(["initial","tail"],function(e,r){var s="drop"+(r?"":"Right");Se.prototype[e]=function(){return this.__filtered__?new Se(this):this[s](1)}}),Se.prototype.compact=function(){return this.filter(ar)},Se.prototype.find=function(e){return this.filter(e).head()},Se.prototype.findLast=function(e){return this.reverse().find(e)},Se.prototype.invokeMap=we(function(e,r){return typeof e=="function"?new Se(this):this.map(function(s){return xn(s,e,r)})}),Se.prototype.reject=function(e){return this.filter(Gs(ie(e)))},Se.prototype.slice=function(e,r){e=ye(e);var s=this;return s.__filtered__&&(e>0||r<0)?new Se(s):(e<0?s=s.takeRight(-e):e&&(s=s.drop(e)),r!==t&&(r=ye(r),s=r<0?s.dropRight(-r):s.take(r-e)),s)},Se.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Se.prototype.toArray=function(){return this.take(B)},Lr(Se.prototype,function(e,r){var s=/^(?:filter|find|map|reject)|While$/.test(r),c=/^(?:head|last)$/.test(r),l=p[c?"take"+(r=="last"?"Right":""):r],d=c||/^find/.test(r);l&&(p.prototype[r]=function(){var _=this.__wrapped__,w=c?[1]:arguments,I=_ instanceof Se,F=w[0],D=I||fe(_),q=function(xe){var Oe=l.apply(p,si([xe],w));return c&&G?Oe[0]:Oe};D&&s&&typeof F=="function"&&F.length!=1&&(I=D=!1);var G=this.__chain__,ee=!!this.__actions__.length,ne=d&&!G,_e=I&&!ee;if(!d&&D){_=_e?_:new Se(this);var se=e.apply(_,w);return se.__actions__.push({func:Hs,args:[q],thisArg:t}),new _r(se,G)}return ne&&_e?e.apply(this,w):(se=this.thru(q),ne?c?se.value()[0]:se.value():se)})}),yr(["pop","push","shift","sort","splice","unshift"],function(e){var r=gs[e],s=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",c=/^(?:pop|shift)$/.test(e);p.prototype[e]=function(){var l=arguments;if(c&&!this.__chain__){var d=this.value();return r.apply(fe(d)?d:[],l)}return this[s](function(_){return r.apply(fe(_)?_:[],l)})}}),Lr(Se.prototype,function(e,r){var s=p[r];if(s){var c=s.name+"";qe.call(Qi,c)||(Qi[c]=[]),Qi[c].push({name:r,func:s})}}),Qi[js(t,be).name]=[{name:"wrapper",func:t}],Se.prototype.clone=lp,Se.prototype.reverse=fp,Se.prototype.value=pp,p.prototype.at=kg,p.prototype.chain=Hg,p.prototype.commit=Kg,p.prototype.next=Vg,p.prototype.plant=Gg,p.prototype.reverse=Wg,p.prototype.toJSON=p.prototype.valueOf=p.prototype.value=Jg,p.prototype.first=p.prototype.head,yn&&(p.prototype[yn]=Bg),p},Wi=Kf();wt?((wt.exports=Wi)._=Wi,Be._=Wi):Pe._=Wi}).call(zn)})(pc,pc.exports);var $E=Object.defineProperty,NE=Object.defineProperties,FE=Object.getOwnPropertyDescriptors,xl=Object.getOwnPropertySymbols,DE=Object.prototype.hasOwnProperty,jE=Object.prototype.propertyIsEnumerable,Il=(o,i,t)=>i in o?$E(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,Zs=(o,i)=>{for(var t in i||(i={}))DE.call(i,t)&&Il(o,t,i[t]);if(xl)for(var t of xl(i))jE.call(i,t)&&Il(o,t,i[t]);return o},LE=(o,i)=>NE(o,FE(i));function Sr(o,i,t){let n;const a=dc(o);return i.rpcMap&&(n=i.rpcMap[a]),n||(n=`${RE}?chainId=eip155:${a}&projectId=${t}`),n}function dc(o){return o.includes("eip155")?Number(o.split(":")[1]):Number(o)}function mf(o){return o.map(i=>`${i.split(":")[0]}:${i.split(":")[1]}`)}function qE(o,i){const t=Object.keys(i.namespaces).filter(a=>a.includes(o));if(!t.length)return[];const n=[];return t.forEach(a=>{const u=i.namespaces[a].accounts;n.push(...u)}),n}function ME(o={},i={}){const t=Sl(o),n=Sl(i);return pc.exports.merge(t,n)}function Sl(o){var i,t,n,a;const u={};if(!ta(o))return u;for(const[f,g]of Object.entries(o)){const m=ql(f)?[f]:g.chains,v=g.methods||[],P=g.events||[],H=g.rpcMap||{},N=ra(f);u[N]=LE(Zs(Zs({},u[N]),g),{chains:Mo(m,(i=u[N])==null?void 0:i.chains),methods:Mo(v,(t=u[N])==null?void 0:t.methods),events:Mo(P,(n=u[N])==null?void 0:n.events),rpcMap:Zs(Zs({},H),(a=u[N])==null?void 0:a.rpcMap)})}return u}function zE(o){return o.includes(":")?o.split(":")[2]:o}function UE(o){const i={};for(const[t,n]of Object.entries(o)){const a=n.methods||[],u=n.events||[],f=n.accounts||[],g=ql(t)?[t]:n.chains?n.chains:mf(n.accounts);i[t]={chains:g,methods:a,events:u,accounts:f}}return i}const wf={},xt=o=>wf[o],Qo=(o,i)=>{wf[o]=i};class kE{constructor(i){this.name="polkadot",this.namespace=i.namespace,this.events=xt("events"),this.client=xt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,t){if(this.chainId=i,!this.httpProviders[i]){const n=t||Sr(`${this.name}:${i}`,this.namespace);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,n)}this.events.emit(_i.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?i.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(t=>{var n;i[t]=this.createHttpProvider(t,(n=this.namespace.rpcMap)==null?void 0:n[t])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,t=this.httpProviders[i];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return t}setHttpProvider(i,t){const n=this.createHttpProvider(i,t);n&&(this.httpProviders[i]=n)}createHttpProvider(i,t){const n=t||Sr(i,this.namespace);return typeof n>"u"?void 0:new vi(new ji(n,xt("disableProviderPing")))}}class HE{constructor(i){this.name="eip155",this.namespace=i.namespace,this.events=xt("events"),this.client=xt("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(i){switch(i.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(i);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(i.request.method)?await this.client.request(i):this.getHttpProvider().request(i.request)}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}setDefaultChain(i,t){const n=dc(i);if(!this.httpProviders[n]){const a=t||Sr(`${this.name}:${n}`,this.namespace,this.client.core.projectId);if(!a)throw new Error(`No RPC url provided for chainId: ${n}`);this.setHttpProvider(n,a)}this.chainId=n,this.events.emit(_i.DEFAULT_CHAIN_CHANGED,`${this.name}:${n}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}createHttpProvider(i,t){const n=t||Sr(`${this.name}:${i}`,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new vi(new ji(n,xt("disableProviderPing")))}setHttpProvider(i,t){const n=this.createHttpProvider(i,t);n&&(this.httpProviders[i]=n)}createHttpProviders(){const i={};return this.namespace.chains.forEach(t=>{var n;const a=dc(t);i[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[t])}),i}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(){const i=this.chainId,t=this.httpProviders[i];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return t}async handleSwitchChain(i){var t,n;let a=i.request.params?(t=i.request.params[0])==null?void 0:t.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const u=parseInt(a,16);if(this.isChainApproved(u))this.setDefaultChain(`${u}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:i.topic,request:{method:i.request.method,params:[{chainId:a}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${u}`);else throw new Error(`Failed to switch to chain 'eip155:${u}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(i){return this.namespace.chains.includes(`${this.name}:${i}`)}}class KE{constructor(i){this.name="solana",this.namespace=i.namespace,this.events=xt("events"),this.client=xt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,t){if(!this.httpProviders[i]){const n=t||Sr(`${this.name}:${i}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,n)}this.chainId=i,this.events.emit(_i.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(t=>{var n;i[t]=this.createHttpProvider(t,(n=this.namespace.rpcMap)==null?void 0:n[t])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,t=this.httpProviders[i];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return t}setHttpProvider(i,t){const n=this.createHttpProvider(i,t);n&&(this.httpProviders[i]=n)}createHttpProvider(i,t){const n=t||Sr(i,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new vi(new ji(n,xt("disableProviderPing")))}}class VE{constructor(i){this.name="cosmos",this.namespace=i.namespace,this.events=xt("events"),this.client=xt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,t){if(this.chainId=i,!this.httpProviders[i]){const n=t||Sr(`${this.name}:${i}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,n)}this.events.emit(_i.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(t=>{var n;i[t]=this.createHttpProvider(t,(n=this.namespace.rpcMap)==null?void 0:n[t])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,t=this.httpProviders[i];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return t}setHttpProvider(i,t){const n=this.createHttpProvider(i,t);n&&(this.httpProviders[i]=n)}createHttpProvider(i,t){const n=t||Sr(i,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new vi(new ji(n,xt("disableProviderPing")))}}class BE{constructor(i){this.name="cip34",this.namespace=i.namespace,this.events=xt("events"),this.client=xt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,t){if(this.chainId=i,!this.httpProviders[i]){const n=t||this.getCardanoRPCUrl(i);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,n)}this.events.emit(_i.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(t=>{const n=this.getCardanoRPCUrl(t);i[t]=this.createHttpProvider(t,n)}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,t=this.httpProviders[i];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return t}getCardanoRPCUrl(i){const t=this.namespace.rpcMap;if(t)return t[i]}setHttpProvider(i,t){const n=this.createHttpProvider(i,t);n&&(this.httpProviders[i]=n)}createHttpProvider(i,t){const n=t||this.getCardanoRPCUrl(i);return typeof n>"u"?void 0:new vi(new ji(n,xt("disableProviderPing")))}}class GE{constructor(i){this.name="elrond",this.namespace=i.namespace,this.events=xt("events"),this.client=xt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,t){if(!this.httpProviders[i]){const n=t||Sr(`${this.name}:${i}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,n)}this.chainId=i,this.events.emit(_i.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(t=>{var n;i[t]=this.createHttpProvider(t,(n=this.namespace.rpcMap)==null?void 0:n[t])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,t=this.httpProviders[i];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return t}setHttpProvider(i,t){const n=this.createHttpProvider(i,t);n&&(this.httpProviders[i]=n)}createHttpProvider(i,t){const n=t||Sr(i,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new vi(new ji(n,xt("disableProviderPing")))}}class WE{constructor(i){this.name="multiversx",this.namespace=i.namespace,this.events=xt("events"),this.client=xt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,t){if(!this.httpProviders[i]){const n=t||Sr(`${this.name}:${i}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,n)}this.chainId=i,this.events.emit(_i.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(t=>{var n;i[t]=this.createHttpProvider(t,(n=this.namespace.rpcMap)==null?void 0:n[t])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,t=this.httpProviders[i];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return t}setHttpProvider(i,t){const n=this.createHttpProvider(i,t);n&&(this.httpProviders[i]=n)}createHttpProvider(i,t){const n=t||Sr(i,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new vi(new ji(n,xt("disableProviderPing")))}}var JE=Object.defineProperty,YE=Object.defineProperties,QE=Object.getOwnPropertyDescriptors,Pl=Object.getOwnPropertySymbols,ZE=Object.prototype.hasOwnProperty,XE=Object.prototype.propertyIsEnumerable,Ol=(o,i,t)=>i in o?JE(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,Xs=(o,i)=>{for(var t in i||(i={}))ZE.call(i,t)&&Ol(o,t,i[t]);if(Pl)for(var t of Pl(i))XE.call(i,t)&&Ol(o,t,i[t]);return o},Zo=(o,i)=>YE(o,QE(i));class Ac{constructor(i){this.events=new _c,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=i,this.logger=typeof(i==null?void 0:i.logger)<"u"&&typeof(i==null?void 0:i.logger)!="string"?i.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:(i==null?void 0:i.logger)||bl})),this.disableProviderPing=(i==null?void 0:i.disableProviderPing)||!1}static async init(i){const t=new Ac(i);return await t.initialize(),t}async request(i,t){const[n,a]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:Xs({},i),chainId:`${n}:${a}`,topic:this.session.topic})}sendAsync(i,t,n){this.request(i,n).then(a=>t(null,a)).catch(a=>t(a,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var i;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(i=this.session)==null?void 0:i.topic,reason:er("USER_DISCONNECTED")}),await this.cleanup()}async connect(i){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(i),await this.cleanupPendingPairings(),!i.skipPairing)return await this.pair(i.pairingTopic)}on(i,t){this.events.on(i,t)}once(i,t){this.events.once(i,t)}removeListener(i,t){this.events.removeListener(i,t)}off(i,t){this.events.off(i,t)}get isWalletConnect(){return!0}async pair(i){this.shouldAbortPairingAttempt=!1;let t=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(t>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:a}=await this.client.connect({pairingTopic:i,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await a().then(u=>{this.session=u,this.namespaces||(this.namespaces=UE(u.namespaces),this.persist("namespaces",this.namespaces))}).catch(u=>{if(u.message!==vf)throw u;t++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(i,t){try{if(!this.session)return;const[n,a]=this.validateChain(i);this.getProvider(n).setDefaultChain(a,t)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(i={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(un(t)){for(const n of t)i.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const i=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[i]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await OE.init({logger:this.providerOpts.logger||bl,relayUrl:this.providerOpts.relayUrl||CE,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const i=[...new Set(Object.keys(this.session.namespaces).map(t=>ra(t)))];Qo("client",this.client),Qo("events",this.events),Qo("disableProviderPing",this.disableProviderPing),i.forEach(t=>{if(!this.session)return;const n=qE(t,this.session),a=mf(n),u=ME(this.namespaces,this.optionalNamespaces),f=Zo(Xs({},u[t]),{accounts:n,chains:a});switch(t){case"eip155":this.rpcProviders[t]=new HE({namespace:f});break;case"solana":this.rpcProviders[t]=new KE({namespace:f});break;case"cosmos":this.rpcProviders[t]=new VE({namespace:f});break;case"polkadot":this.rpcProviders[t]=new kE({namespace:f});break;case"cip34":this.rpcProviders[t]=new BE({namespace:f});break;case"elrond":this.rpcProviders[t]=new GE({namespace:f});break;case"multiversx":this.rpcProviders[t]=new WE({namespace:f});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",i=>{this.events.emit("session_ping",i)}),this.client.on("session_event",i=>{const{params:t}=i,{event:n}=t;if(n.name==="accountsChanged"){const a=n.data;a&&un(a)&&this.events.emit("accountsChanged",a.map(zE))}else n.name==="chainChanged"?this.onChainChanged(t.chainId):this.events.emit(n.name,n.data);this.events.emit("session_event",i)}),this.client.on("session_update",({topic:i,params:t})=>{var n;const{namespaces:a}=t,u=(n=this.client)==null?void 0:n.session.get(i);this.session=Zo(Xs({},u),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:i,params:t})}),this.client.on("session_delete",async i=>{await this.cleanup(),this.events.emit("session_delete",i),this.events.emit("disconnect",Zo(Xs({},er("USER_DISCONNECTED")),{data:i.topic}))}),this.on(_i.DEFAULT_CHAIN_CHANGED,i=>{this.onChainChanged(i,!0)})}getProvider(i){if(!this.rpcProviders[i])throw new Error(`Provider not found: ${i}`);return this.rpcProviders[i]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(i=>{var t;this.getProvider(i).updateNamespace((t=this.session)==null?void 0:t.namespaces[i])})}setNamespaces(i){const{namespaces:t,optionalNamespaces:n,sessionProperties:a}=i;t&&Object.keys(t).length&&(this.namespaces=t),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=a,this.persist("namespaces",t),this.persist("optionalNamespaces",n)}validateChain(i){const[t,n]=(i==null?void 0:i.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,n];if(t&&!Object.keys(this.namespaces||{}).map(f=>ra(f)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&n)return[t,n];const a=ra(Object.keys(this.namespaces)[0]),u=this.rpcProviders[a].getDefaultChain();return[a,u]}async requestAccounts(){const[i]=this.validateChain();return await this.getProvider(i).requestAccounts()}onChainChanged(i,t=!1){var n;if(!this.namespaces)return;const[a,u]=this.validateChain(i);t||this.getProvider(a).setDefaultChain(u),((n=this.namespaces[a])!=null?n:this.namespaces[`${a}:${u}`]).defaultChain=u,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",u)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(i,t){this.client.core.storage.setItem(`${El}/${i}`,t)}async getFromStore(i){return await this.client.core.storage.getItem(`${El}/${i}`)}}const ex=Ac,tx="wc",rx="ethereum_provider",ix=`${tx}@2:${rx}:`,nx="https://rpc.walletconnect.com/v1/",gc=["eth_sendTransaction","personal_sign"],sx=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],yc=["chainChanged","accountsChanged"],ax=["message","disconnect","connect"];var ox=Object.defineProperty,cx=Object.defineProperties,ux=Object.getOwnPropertyDescriptors,Cl=Object.getOwnPropertySymbols,hx=Object.prototype.hasOwnProperty,lx=Object.prototype.propertyIsEnumerable,Al=(o,i,t)=>i in o?ox(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,Un=(o,i)=>{for(var t in i||(i={}))hx.call(i,t)&&Al(o,t,i[t]);if(Cl)for(var t of Cl(i))lx.call(i,t)&&Al(o,t,i[t]);return o},Tl=(o,i)=>cx(o,ux(i));function aa(o){return Number(o[0].split(":")[1])}function Xo(o){return`0x${o.toString(16)}`}function fx(o){const{chains:i,optionalChains:t,methods:n,optionalMethods:a,events:u,optionalEvents:f,rpcMap:g}=o;if(!un(i))throw new Error("Invalid chains");const m={chains:i,methods:n||gc,events:u||yc,rpcMap:Un({},i.length?{[aa(i)]:g[aa(i)]}:{})},v=u==null?void 0:u.filter(U=>!yc.includes(U)),P=n==null?void 0:n.filter(U=>!gc.includes(U));if(!t&&!f&&!a&&!(v!=null&&v.length)&&!(P!=null&&P.length))return{required:i.length?m:void 0};const H=(v==null?void 0:v.length)&&(P==null?void 0:P.length)||!t,N={chains:[...new Set(H?m.chains.concat(t||[]):t)],methods:[...new Set(m.methods.concat(a!=null&&a.length?a:sx))],events:[...new Set(m.events.concat(f||ax))],rpcMap:g};return{required:i.length?m:void 0,optional:t.length?N:void 0}}class Tc{constructor(){this.events=new kr.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=ix,this.on=(i,t)=>(this.events.on(i,t),this),this.once=(i,t)=>(this.events.once(i,t),this),this.removeListener=(i,t)=>(this.events.removeListener(i,t),this),this.off=(i,t)=>(this.events.off(i,t),this),this.parseAccount=i=>this.isCompatibleChainId(i)?this.parseAccountId(i).address:i,this.signer={},this.rpc={}}static async init(i){const t=new Tc;return await t.initialize(i),t}async request(i){return await this.signer.request(i,this.formatChainId(this.chainId))}sendAsync(i,t){this.signer.sendAsync(i,t,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(i){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(i);const{required:t,optional:n}=fx(this.rpc);try{const a=await new Promise(async(f,g)=>{var m;this.rpc.showQrModal&&((m=this.modal)==null||m.subscribeModal(v=>{!v.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),g(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Tl(Un({namespaces:Un({},t&&{[this.namespace]:t})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:i==null?void 0:i.pairingTopic})).then(v=>{f(v)}).catch(v=>{g(new Error(v.message))})});if(!a)return;this.setChainIds(this.rpc.chains);const u=j1(a.namespaces,[this.namespace]);this.setAccounts(u),this.events.emit("connect",{chainId:Xo(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",i=>{const{params:t}=i,{event:n}=t;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",i)}),this.signer.on("chainChanged",i=>{const t=parseInt(i);this.chainId=t,this.events.emit("chainChanged",Xo(this.chainId)),this.persist()}),this.signer.on("session_update",i=>{this.events.emit("session_update",i)}),this.signer.on("session_delete",i=>{this.reset(),this.events.emit("session_delete",i),this.events.emit("disconnect",Tl(Un({},er("USER_DISCONNECTED")),{data:i.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",i=>{var t,n;this.rpc.showQrModal&&((t=this.modal)==null||t.closeModal(),(n=this.modal)==null||n.openModal({uri:i})),this.events.emit("display_uri",i)})}switchEthereumChain(i){this.request({method:"wallet_switchEthereumChain",params:[{chainId:i.toString(16)}]})}isCompatibleChainId(i){return typeof i=="string"?i.startsWith(`${this.namespace}:`):!1}formatChainId(i){return`${this.namespace}:${i}`}parseChainId(i){return Number(i.split(":")[1])}setChainIds(i){const t=i.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));t.length&&(this.chainId=t[0],this.events.emit("chainChanged",Xo(this.chainId)),this.persist())}setChainId(i){if(this.isCompatibleChainId(i)){const t=this.parseChainId(i);this.chainId=t,this.switchEthereumChain(t)}}parseAccountId(i){const[t,n,a]=i.split(":");return{chainId:`${t}:${n}`,address:a}}setAccounts(i){this.accounts=i.filter(t=>this.parseChainId(this.parseAccountId(t).chainId)===this.chainId).map(t=>this.parseAccountId(t).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(i){var t,n;const a=(t=i==null?void 0:i.chains)!=null?t:[],u=(n=i==null?void 0:i.optionalChains)!=null?n:[],f=a.concat(u);if(!f.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const g=a.length?(i==null?void 0:i.methods)||gc:[],m=a.length?(i==null?void 0:i.events)||yc:[],v=(i==null?void 0:i.optionalMethods)||[],P=(i==null?void 0:i.optionalEvents)||[],H=(i==null?void 0:i.rpcMap)||this.buildRpcMap(f,i.projectId),N=(i==null?void 0:i.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(U=>this.formatChainId(U)),optionalChains:u.map(U=>this.formatChainId(U)),methods:g,events:m,optionalMethods:v,optionalEvents:P,rpcMap:H,showQrModal:!!(i!=null&&i.showQrModal),qrModalOptions:N,projectId:i.projectId,metadata:i.metadata}}buildRpcMap(i,t){const n={};return i.forEach(a=>{n[a]=this.getRpcUrl(a,t)}),n}async initialize(i){if(this.rpc=this.getRpcConfig(i),this.chainId=this.rpc.chains.length?aa(this.rpc.chains):aa(this.rpc.optionalChains),this.signer=await ex.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:i.disableProviderPing,relayUrl:i.relayUrl,storageOptions:i.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let t;try{const{WalletConnectModal:n}=await L1(()=>import("./index-c72a0139.js").then(a=>a.i),["assets/index-c72a0139.js","assets/index-a2db3dd5.js","assets/index-699ea3af.css"]);t=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(t)try{this.modal=new t(Un({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(i){if(!i)return;const{chains:t,optionalChains:n,rpcMap:a}=i;t&&un(t)&&(this.rpc.chains=t.map(u=>this.formatChainId(u)),t.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)})),n&&un(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(u=>this.formatChainId(u)),n.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)}))}getRpcUrl(i,t){var n;return((n=this.rpc.rpcMap)==null?void 0:n[i])||`${nx}?chainId=eip155:${i}&projectId=${t||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const i=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),t=this.session.namespaces[`${this.namespace}:${i}`]?this.session.namespaces[`${this.namespace}:${i}`]:this.session.namespaces[this.namespace];this.setChainIds(i?[this.formatChainId(i)]:t==null?void 0:t.accounts),this.setAccounts(t==null?void 0:t.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(i){return typeof i=="string"||i instanceof String?[this.parseAccount(i)]:i.map(t=>this.parseAccount(t))}}const bx=Tc;export{bx as EthereumProvider,ax as OPTIONAL_EVENTS,sx as OPTIONAL_METHODS,yc as REQUIRED_EVENTS,gc as REQUIRED_METHODS,Tc as default};
